(()=>{var f,e,m,b,o;"object"!=typeof Breinify||Breinify.plugins._isAdded("alertMe")||(f=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),m=Breinify.UTL.constants.errors.prefix.validation,b=Breinify.UTL.constants.errors.prefix.api,Breinify.plugins._add("alertMe",{pages:{setAlert:{init:function(e,t,n){var i=this,n=(this.settings=f.isPlainObject(n)?n:{},"object"==typeof this.settings.validator?this.validator=this.settings.validator:"object"==typeof Breinify.plugins.uiValidator?this.validator=Breinify.plugins.uiValidator:this.validator=null,t.find("#"+o+"-mobile-number")),a=t.find("#"+o+"-alert-time"),r=t.find("#"+o+"-confirm");("function"==typeof f().mask?n.mask("(999) 999-9999"):n).on("propertychange change keyup input paste",function(){i.validate(e,t)}),a.change(function(){i.validate(e,t)}),r.click(function(){i.setAlert(e,t)}),this.validate(e,t)},validate:function(e,t){var n=t.find("#"+o+"-mobile-number"),i=t.find("#"+o+"-alert-time"),t=t.find("#"+o+"-confirm"),n="function"==typeof f().mask?n.data().mask.getCleanVal():n.val(),a=null!==this.validator&&this.validator.usMobile(n),i=i.val(),r=null!==this.validator&&this.validator.mandatory(i);a&&r?(e.extendBindings({alert:{time:Breinify.plugins.alertMe.parseTime(i),mobileNr:n,e164MobileNr:"+1"+n}}),t.prop("disabled",!1)):t.prop("disabled",!0)},setAlert:function(n,i,e){var t,a=f.extend(!0,{time:null,mobileNr:null,e164MobileNr:null},n.getBinding("alert")),r=n.getBinding("location"),o=n.getBinding("product"),l=(f.isFunction(this.settings.onPreSet)&&(t=this.settings.onPreSet(n,i,{alert:a,location:r,product:o}),f.isPlainObject(t))&&(a=t.alert,r=t.location,o=t.product),this);Breinify.plugins.alertMe.set(a.e164MobileNr,o,r,a.time,function(e,t){null===e&&f.isFunction(l.settings.onSuccess)?l.settings.onSuccess(n,i,t):f.isFunction(l.settings.onError)&&l.settings.onError(n,i,e)})},style:'<style id="'+(o="breinify-alert-me-page-set")+'-style">.'+o+"-container { color:#000;font-size:13px;line-height:17px; }."+o+"-container .paragraph { padding:10px 0 0 0; }."+o+"-container .labeled { margin-bottom:5px;font-weight:bold; }."+o+"-container .centered { text-align:center; }."+o+"-container .small-print { font-size:10px;line-height:13px;font-weight:400;color:#222222; }."+o+"-container input, ."+o+"-container select { font-size:inherit;font-family:inherit;color:#000;box-sizing:border-box;max-width:450px;width:100%;height:40px;padding: 0 8px;background-color:#fff;border-radius:5px;border:1px solid #999999; }."+o+"-container select { -moz-appearance:none;-webkit-appearance:none; }."+o+"-container button { min-width:150px;width:50%;white-space:nowrap;cursor:pointer;line-height:25px;font-size:14px;border-radius:4px;border-color:#de0000;background:#de0000;color:#fff; }."+o+"-container button:disabled { cursor:not-allowed;border-color:#eeeeee;background:#cccccc; }</style>",html:'<div class="'+o+'-container">   <div>You are about to set an alert to be informed via text message when <b data-breinify-placeholder="product.name"></b> will be available at <span data-breinify-placeholder="company.name"></span> within the next <span data-breinify-placeholder="settings.alertExpiresInDays"></span> days. Setting an alert does not reserve the product, it notifies you when it is available.</div>   <div class="paragraph">Please provide the following information:</div>   <div class="paragraph">       <div class="labeled"><label style="" for="'+o+'-mobile-number">Mobile Number:</label></div>         <div><input id="'+o+'-mobile-number" type="text" placeholder="(xxx) xxx-xxxx" autocomplete="off" maxlength="14" data-breinify-reset="true"></div>   </div>   <div class="paragraph">       <div class="labeled"><label for="'+o+'-alert-time">Alert-Time (when available):</label></div>         <div><select id="'+o+'-alert-time" data-breinify-reset="true">           <option value="0|24|-1">anytime, as soon as available</option>           <option value="9|18|-1">between 9:00am - 6:00pm</option>           <option value="9|12|-1">between 9:00am - noon</option>           <option value="12|18|-1">between noon - 6:00pm</option>           <option value="9|18|0">between 9:00am - 6:00pm (weekdays only)</option>           <option value="9|18|1">between 9:00am - 6:00pm (weekends only)</option>           <option value="9|12|0">between 9:00am - noon (weekdays only)</option>           <option value="9|12|1">between 9:00am - noon (weekends only)</option>           <option value="12|18|0">between noon - 6:00pm (weekdays only)</option>           <option value="12|18|1">between noon - 6:00pm (weekends only)</option>       </select></div>   </div>   <div class="paragraph small-print">By setting this alert, you confirm that the entered mobile number is yours and that you consent to receive text messages to inform you about the alert. By providing your mobile number and signing up for alerts you agree to receive text messages that may be deemed marketing under applicable law, and that these messages may be sent using an autodialer. Your consent is not a condition of any purchase. Setting an alert is not a reservation of a product.</div>   <div class="paragraph centered">       <button id="'+o+'-confirm" type="submit" title="Set Alert"><span>Set Alert</span></button>   </div></div>'}},parseTime:function(e){var t,n;return f.isPlainObject(e)?e:"string"==typeof e?(n=0<(e=e.split("|")).length?parseInt(e[0]):9,t=1<e.length?parseInt(e[1]):18,2<e.length&&parseInt(e[2]),{start:60*n*60,end:60*t*60,weekdays:-1===(n=2<e.length?parseInt(e[2]):0)||0===n,weekends:-1===n||1===n}):{start:32400,end:64800,weekdays:!0,weekends:!1}},set:function(){var o=this;e.overload({"String,Object,Object,Object,Function":function(e,t,n,i,a){o._set(e,{},t,n,i,a)},"String,Object,Array,Object,Function":function(e,t,n,i,a){o._set(e,{},t,n,i,a)},"String,String,Object,Object,Function":function(e,t,n,i,a){o._set(e,{},{sku:t},n,i,a)},"String,String,Array,Object,Function":function(e,t,n,i,a){o._set(e,{},{sku:t},n,i,a)},"String,Object,Object,Object,Object,Function":function(e,t,n,i,a,r){o._set(e,t,n,i,a,r)},"String,Object,Object,Array,Object,Function":function(e,t,n,i,a,r){o._set(e,t,n,i,a,r)},"String,Object,String,Object,Object,Function":function(e,t,n,i,a,r){o._set(e,t,{sku:n},i,a,r)},"String,Object,String,Array,Object,Function":function(e,t,n,i,a,r){o._set(e,t,{sku:n},i,a,r)}},arguments,this)},_validateLocation:function(e,t){if(null==e)t(null,null);else if(f.isPlainObject(e)){var n=!Breinify.UTL.isEmpty(e.id),i=!Breinify.UTL.isEmpty(e.name);if(n||i){n?i||(e.name=null):e.id=null;var a=this.getConfig("locationTypes",[/.*/]);if(!Breinify.UTL.isEmpty(e.type))if(f.isArray(a)){for(var r=!1,o=0;o<a.length;o++){var l=a[o];if("string"==typeof l&&l===e.type){r=!0;break}if(l instanceof RegExp&&l.test(e.type)){r=!0;break}}r?t(null,e):t(new Error(m+"Invalid location-type specified: "+e.type))}else t(new Error(m+"Invalid locationTypes configuration: "+JSON.stringify(a)));else t(new Error(m+"Must specify a location's type."))}else t(new Error(m+"Must specify a location's id or name."))}else t(new Error(m+"Location must be a plain-object."))},_validateLocations:function(n,i){if(null==n)return null;if(f.isArray(n))for(var a=[],r=[],e=0;e<n.length;e++)this._validateLocation(n[e],function(e,t){null===e?a.push(t):r.push(e),r.length+a.length===n.length&&(0<r.length?i(r[0]):i(null,a))});else f.isPlainObject(n)?this._validateLocation(n,function(e,t){i(e,t?[t]:null)}):i(new Error(m+"The specified locations cannot be validated."))},_validateTime:function(e,t){var n,i;null==e?t(null,null):f.isPlainObject(e)?(n=!Breinify.UTL.isEmpty(e.start)&&"number"==typeof e.start,i=!Breinify.UTL.isEmpty(e.end)&&"number"==typeof e.end,n&&i?e.start>=e.end?t(new Error(m+"The start must be smaller than the end.")):e.start<0||e.end<0?t(new Error(m+"The start and end must be larger than 0.")):(86400<e.start||86400<e.end)&&t(new Error(m+"The start and end must be smaller than 86400 (max. seconds until midnight).")):t(new Error(m+"Time must have a start and end defined.")),e.weekdays="boolean"!=typeof e.weekdays||e.weekdays,e.weekends="boolean"==typeof e.weekends&&e.weekends,!1===e.weekdays&&!1===e.weekends&&t(new Error(m+"The time must be specified for at least one type of days (i.e., weekdays or weekends).")),t(null,e)):t(new Error(m+"Time must be a plain-object."))},_validateProduct:function(e,t){var n,i;null==e?t(null,null):f.isPlainObject(e)?(n=!Breinify.UTL.isEmpty(e.sku),i=!Breinify.UTL.isEmpty(e.name),n||i?(n?i||(e.name=null):e.sku=null,t(null,e)):t(new Error(m+"Must specify a product's sku or name."))):t(new Error(m+"Product must be a plain-object."))},_validatePhoneNumber:function(e,t,n){null===e?n(null,null):"string"==typeof(e="number"==typeof e?""+e:e)&&(e=e.trim(),/\+?\d+/.test(e))?t||0===e.indexOf("+")?n(null,e):n(new Error(m+"Phone-number must include the country-code (e.g., +1): "+e)):n(new Error(m+"Invalid phone-number defined: "+e))},_set:function(e,i,t,n,a,r){var o=this,l=Breinify.UTL.internal.cbCollector({_callback:function(e,t){if(null===e)o._setValidated(t.from,t.to,i,t.product,t.locations,t.time,r);else for(var n in e)if(e.hasOwnProperty(n)){n=e[n];r(n);break}},locations:function(e,t){l._set("locations",e,t)},from:function(e,t){l._set("from",e,t)},to:function(e,t){l._set("to",e,t)},product:function(e,t){l._set("product",e,t)},time:function(e,t){l._set("time",e,t)}});this._validateLocations(n,l.locations),this._validatePhoneNumber(this.getConfig("from",null),!0,l.from),this._validatePhoneNumber(e,!1,l.to),this._validateProduct(t,l.product),this._validateTime(a,l.time)},_setValidated:function(e,t,n,i,a,r,o){if(null===e)o(new Error(m+"The alert's from-number must be configured (see configuration)."));else if(null===t)o(new Error(m+"The alert's to-number must be set."));else if(null===i)o(new Error(m+"The alert's product must be set."));else if(null===a)o(new Error(m+"The alert's location(s) must be set."));else if(null===r)o(new Error(m+"The alert's time must be set."));else{var l,s;if(n=Breinify.UTL.user.create(n),f.isArray(a))l=a[0],s=1<a.length?a.slice(1):[];else{if(!f.isPlainObject(a))return void o(new Error(m+"The alert's location(s) must be set."));l=a,s=[]}for(var d=[],c=0;c<s.length;c++){var u=s[c],u={alertMeLocation:u.name,alertMeLocationId:u.id,alertMeLocationType:u.type};d.push(u)}var p={alertMeMessage:"SetAlert",alertMeAlternativeLocations:d,alertMeLocation:l.name,alertMeLocationId:l.id,alertMeLocationType:l.type,alertMeProduct:i.name,alertMeProductSku:i.sku,alertMeStart:{secondsSinceMidnight:r.start},alertMeEnd:{secondsSinceMidnight:r.end},alertMeWeekdays:r.weekdays,alertMeWeekends:r.weekends},a={messageServiceIdentifier:e,messageServiceUserIdentifier:t,gameKeyword:"alertme",gameInputText:JSON.stringify(p),messageText:"SET ALERT FOR "+p.alertMeProduct+" AT "+p.alertMeLocation+" BETWEEN "+p.alertMeStart.secondsSinceMidnight+" AND "+p.alertMeEnd.secondsSinceMidnight+(p.alertMeWeekdays?"":" NO WEEKDAYS")+(p.alertMeWeekends?"":" NO WEEKENDS")};Breinify.activity(n,"gameSms",null,null,a,function(e,t){"string"==typeof t?o(new Error(b+t)):o(null,p)})}}}))})();
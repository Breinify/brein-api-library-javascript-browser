"use strict";!function(){if("object"==typeof Breinify){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=Breinify.UTL.constants.errors.prefix.validation,d=Breinify.UTL.constants.errors.prefix.api,e={set:function(){var a=this;b.overload({"String,Object,Object,Object,Function":function(b,c,d,e,f){a._set(b,{},c,d,e,f)},"String,Object,Array,Object,Function":function(b,c,d,e,f){a._set(b,{},c,d,e,f)},"String,String,Object,Object,Function":function(b,c,d,e,f){a._set(b,{},{sku:c},d,e,f)},"String,String,Array,Object,Function":function(b,c,d,e,f){a._set(b,{},{sku:c},d,e,f)},"String,Object,Object,Object,Object,Function":function(b,c,d,e,f,g){a._set(b,c,d,e,f,g)},"String,Object,Object,Array,Object,Function":function(b,c,d,e,f,g){a._set(b,c,d,e,f,g)},"String,Object,String,Object,Object,Function":function(b,c,d,e,f,g){a._set(b,c,{sku:d},e,f,g)},"String,Object,String,Array,Object,Function":function(b,c,d,e,f,g){a._set(b,c,{sku:d},e,f,g)}},arguments,this)},_validateLocation:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(!a.isPlainObject(b))return void d(new Error(c+"Location must be a plain-object."));var e=!Breinify.UTL.isEmpty(b.id),f=!Breinify.UTL.isEmpty(b.name);if(!e&&!f)return void d(new Error(c+"Must specify a location's id or name."));e?f||(b.name=null):b.id=null;var g=this.getConfig("locationTypes",[/.*/]),h=!Breinify.UTL.isEmpty(b.type);if(!h)return void d(new Error(c+"Must specify a location's type."));if(!a.isArray(g))return void d(new Error(c+"Invalid locationTypes configuration: "+JSON.stringify(g)));for(var i=!1,j=0;j<g.length;j++){var k=g[j];if("string"==typeof k&&k===b.type){i=!0;break}if(k instanceof RegExp&&k.test(b.type)){i=!0;break}}return i?void d(null,b):void d(new Error(c+"Invalid location-type specified: "+b.type))},_validateLocations:function(b,d){if("undefined"==typeof b||null===b)return null;if(a.isArray(b))for(var e=[],f=[],g=0;g<b.length;g++)this._validateLocation(b[g],function(a,c){null===a?e.push(c):f.push(a),f.length+e.length===b.length&&(f.length>0?d(f[0]):d(null,e))});else a.isPlainObject(b)?this._validateLocation(b,function(a,b){d(a,b?[b]:null)}):d(new Error(c+"The specified locations cannot be validated."))},_validateTime:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(!a.isPlainObject(b))return void d(new Error(c+"Time must be a plain-object."));var e=!Breinify.UTL.isEmpty(b.start)&&"number"==typeof b.start,f=!Breinify.UTL.isEmpty(b.end)&&"number"==typeof b.end;e&&f?b.start>=b.end?d(new Error(c+"The start must be smaller than the end.")):b.start<0||b.end<0?d(new Error(c+"The start and end must be larger than 0.")):(b.start>86400||b.end>86400)&&d(new Error(c+"The start and end must be smaller than 86400 (max. seconds until midnight).")):d(new Error(c+"Time must have a start and end defined.")),b.weekdays="boolean"!=typeof b.weekdays||b.weekdays,b.weekends="boolean"==typeof b.weekends&&b.weekends,b.weekdays===!1&&b.weekends===!1&&d(new Error(c+"The time must be specified for at least one type of days (i.e., weekdays or weekends).")),d(null,b)},_validateProduct:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(!a.isPlainObject(b))return void d(new Error(c+"Product must be a plain-object."));var e=!Breinify.UTL.isEmpty(b.sku),f=!Breinify.UTL.isEmpty(b.name);return e||f?(e?f||(b.name=null):b.sku=null,void d(null,b)):void d(new Error(c+"Must specify a product's sku or name."))},_validatePhoneNumber:function(a,b,d){return null===a?void d(null,null):("number"==typeof a&&(a=""+a),"string"!=typeof a?void d(new Error(c+"Invalid phone-number defined: "+a)):(a=a.trim(),/\+?\d+/.test(a)?b||0===a.indexOf("+")?void d(null,a):void d(new Error(c+"Phone-number must include the country-code (e.g., +1): "+a)):void d(new Error(c+"Invalid phone-number defined: "+a))))},_set:function(a,b,c,d,e,f){var g=this,h=Breinify.UTL.internal.cbCollector({_callback:function(a,c){if(null===a)g._setValidated(c.from,c.to,b,c.product,c.locations,c.time,f);else for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];f(e);break}},locations:function(a,b){h._set("locations",a,b)},from:function(a,b){h._set("from",a,b)},to:function(a,b){h._set("to",a,b)},product:function(a,b){h._set("product",a,b)},time:function(a,b){h._set("time",a,b)}});this._validateLocations(d,h.locations),this._validatePhoneNumber(this.getConfig("from",null),!0,h.from),this._validatePhoneNumber(a,!1,h.to),this._validateProduct(c,h.product),this._validateTime(e,h.time)},_setValidated:function(b,e,f,g,h,i,j){if(null===b)return void j(new Error(c+"The alert's from-number must be configured (see configuration)."));if(null===e)return void j(new Error(c+"The alert's to-number must be set."));if(null===g)return void j(new Error(c+"The alert's product must be set."));if(null===h)return void j(new Error(c+"The alert's location(s) must be set."));if(null===i)return void j(new Error(c+"The alert's time must be set."));f=Breinify.UTL.user.create(f);var k,l;if(a.isArray(h))k=h[0],l=h.length>1?h.slice(1):[];else{if(!a.isPlainObject(h))return void j(new Error(c+"The alert's location(s) must be set."));k=h,l=[]}for(var m=[],n=0;n<l.length;n++){var o=l[n],p={alertMeLocation:o.name,alertMeLocationId:o.id,alertMeLocationType:o.type};m.push(p)}var q={alertMeMessage:"SetAlert",alertMeAlternativeLocations:m,alertMeLocation:k.name,alertMeLocationId:k.id,alertMeLocationType:k.type,alertMeProduct:g.name,alertMeProductSku:g.sku,alertMeStart:{secondsSinceMidnight:i.start},alertMeEnd:{secondsSinceMidnight:i.end},alertMeWeekdays:i.weekdays,alertMeWeekends:i.weekends},r={messageServiceIdentifier:b,messageServiceUserIdentifier:e,gameKeyword:"alertme",gameInputText:JSON.stringify(q),messageText:"SET ALERT FOR "+q.alertMeProduct+" AT "+q.alertMeLocation+" BETWEEN "+q.alertMeStart.secondsSinceMidnight+" AND "+q.alertMeEnd.secondsSinceMidnight+(q.alertMeWeekdays?"":" NO WEEKDAYS")+(q.alertMeWeekends?"":" NO WEEKENDS")};Breinify.activity(f,"gameSms",null,null,r,function(a,b){"string"==typeof b?j(new Error(d+b)):j(null,q)})}};Breinify.plugins._add("alertMe",e)}}();
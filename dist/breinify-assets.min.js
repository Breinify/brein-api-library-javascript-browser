"use strict";!function(){if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=Breinify.plugins.journey,d=Breinify.UTL.constants.errors.prefix.assets,e={resultCache:{},textResource:function(b,c){a.getJSON("https://assets.breinify.com/frame/"+b,function(a){c(null,a)}).fail(function(a,e,f){c({error:d+' Unable to retrieve resource from "'+b+'"',textStatus:e,responseText:a.responseText})})},determineDataTagsResourceValue:function(b,c,d,e){var f=this;"string"!=typeof c||""===c.trim()||"string"!=typeof d||""===d.trim()?e(null,null):a.isPlainObject(this.resultCache[b])?this.extractDataTagsSettings(c,d,this.resultCache[b],e):"boolean"==typeof this.resultCache[b]?this.resultCache[b]===!0?setTimeout(function(){f.determineDataTagsResourceValue(b,c,d,e)},10):e(null,null):(this.resultCache[b]=!0,this.textResource(b,function(a,g){null===a?(f.resultCache[b]=g,f.extractDataTagsSettings(c,d,g,e)):(f.resultCache[b]=!1,e(null,null))}))},determineTextResourceValue:function(b,c,d,e,f){var g=this;"string"!=typeof d||""===d.trim()?e(null,null):a.isPlainObject(this.resultCache[b])?this.extractResource(f,c,d,this.resultCache[b],e):"boolean"==typeof this.resultCache[b]?this.resultCache[b]===!0?setTimeout(function(){g.determineTextResourceValue(b,c,d,e,f)},10):e(null,null):(this.resultCache[b]=!0,this.textResource(b,function(a,h){null===a?(g.resultCache[b]=h,g.extractResource(f,c,d,h,e)):(g.resultCache[b]=!1,e(null,null))}))},registerNamedResourcesDataTagsObserver:function(){var b=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(c){c.each(function(){var c=a(this),d=c.attr("data-frameId"),e=c.attr("data-personalize-group"),f=c.attr("data-personalize-item"),g=c.attr("data-personalize-value"),h=g.split(/\s*,\s*/);b.determineDataTagsResourceValue(d,e,f,function(a,d){null===a&&b.applyDataTagsModifications(c,d,h),c.attr("data-personalize-loaded","true"),"true"===c.attr("data-personalize-show")&&c.show()})})}})},applyDataTagsModifications:function(b,d,e){if(a.isArray(e)&&0!==e.length&&a.isArray(d))for(var f=0;f<d.length;f++){var g=d[f];if(a.isPlainObject(g)){var h=a.isArray(g.journey)?g.journey:null;if(null===h||c.is(h))for(var i=0;i<e.length;i++){var j=e[i],k="undefined"==typeof g[j]?null:g[j];this.applyDataTagsModification(b,j,k)}}}},applyDataTagsModification:function(a,b,c){null!==c&&("text"===b?a.text(c):"html"===b?a.html(c):"font-color"===b?a.css("color",c):"background-color"===b?a.css("background-color",c):"style"===b?a.attr("style",c):"href"===b?a.attr("href",c):"alt"===b?a.attr("alt",c):"source"===b?a.attr("src",c):console.log("Unknown modification: "+b))},registerNamedResourcesImgObserver:function(){var b=this;Breinify.UTL.dom.addModification("assets::namedResourcesImgObserver",{selector:'img[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(c){c.each(function(){var c=a(this),d=c.attr("data-frameId"),e=c.attr("data-resourceType"),f=c.attr("data-resourceId"),g=c.attr("data-fallbackSrc");b.determineTextResourceValue(d,e,f,function(a,b){"string"==typeof a&&""!==a.trim()?c.attr("src",a):"string"==typeof g&&""!==g.trim()?c.attr("src",g):c.attr("src",""),""!==c.attr("src").trim()&&c.attr("data-resourceLoaded","true").show()})})}})},extractDataTagsSettings:function(b,c,d,e){d=a.isPlainObject(d)?d:{};var f,g=a.isPlainObject(d["data-tags"])?d["data-tags"]:{};if(b.indexOf(".")>0){f=g;for(var h=b.split("."),i=0;i<h.length;i++){var j=h[i];if(!a.isPlainObject(f[j])){f={};break}f=f[j]}}else f=a.isPlainObject(g[b])?g[b]:{};var k=a.isArray(f[c])?f[c]:[];e(null,k)},parseDate:function(a){var b=a.split("/"),c=parseInt(b[0]),d=parseInt(b[1]),e=parseInt(b[2]),f=new Date;return f.setFullYear(c),f.setMonth(d-1),f.setDate(e),f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0),Math.floor(f.getTime()/1e3)},parseDateTime:function(a,b){var c=this.parseDate(a),d=new Date(1e3*c),e=b.split(":"),f=parseInt(e[0]),g=parseInt(e[1]),h=parseInt(e[2]);return d.setHours(f),d.setMinutes(g),d.setSeconds(h),d.setMilliseconds(0),Math.floor(d.getTime()/1e3)},extractResource:function(b,c,d,e,f){var g;if("number"==typeof b)g=Math.floor(b/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var h=Breinify.UTL.loc.param("assetTimestamp");if(/^[0-9]+$/.test(h))g=parseInt(h);else if(/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(h))g=this.parseDate(h);else if(/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(h)){var i=h.split(/[_\- ]/);g=this.parseDateTime(i[0],i[1])}}catch(j){console.log("Failed to parse: "+h),g=null}g="number"==typeof g?g:Math.floor((new Date).getTime()/1e3);var k;if(a.isPlainObject(e.themes)){for(var l=null,m=Object.keys(e.themes),n=0,o=m.length;n<o;n++){var p=e.themes[m[n]],q="number"==typeof p.start?p.start:null,r="number"==typeof p.end?p.end:null;if(null===q);else if(g>=q&&(null===r||g<r)){l=m[n];break}}if(k=e.fallbackThemes,k=a.isArray(k)?k:[],null!==l)k=[l].concat(k);else if(0===k.length)return void f(null,null)}else k=[null];for(var s=0,t=k.length;s<t;s++){var u=k[s],v=null===u?e:e.themes[u];if(a.isPlainObject(v)){var w=v[c];if(a.isPlainObject(w)){var x=w[d];if("string"==typeof x&&""!==x.trim())return void f(x,u)}}}f(null,null)}},f={observeNamedResourceDomElements:function(b){b=a.extend({imgObserver:this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},b),b.imgObserver===!0&&e.registerNamedResourcesImgObserver(),b.dataTagsObserver===!0&&e.registerNamedResourcesDataTagsObserver()},textResource:function(){b.overload({"String,Function":function(a,b){e.textResource(a,b)},"String,String,String,Function,Number":function(a,b,c,d,f){e.determineTextResourceValue(a,b,c,d,f)}},arguments,this)}},g=Breinify.plugins._add("assets",f);Breinify.onReady(function(){g.observeNamedResourceDomElements()})}}();
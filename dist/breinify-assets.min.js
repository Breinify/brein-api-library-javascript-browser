(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){let y=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),u=Breinify.plugins.journey,n=Breinify.UTL.constants.errors.prefix.assets,i={resultCache:{},_textResource:function(r,e,s){let t="https://assets.breinify.com/frame/"+r;"number"==typeof e&&/^\d{10}$/.test(e.toString())&&(t+="/"+e),y.getJSON(t,function(e){s(null,e)}).fail(function(e,t,a){s({error:n+' Unable to retrieve resource from "'+r+'"',textStatus:t,responseText:e.responseText})})},textResource:function(e,t,a){let r=this,s=("number"==typeof t&&10===t.toString().length||(t=null),e+(null===t?"":"/"+t));y.isPlainObject(this.resultCache[s])?a(null,this.resultCache[s]):"boolean"==typeof this.resultCache[s]?!0===this.resultCache[s]?setTimeout(function(){r.textResource(e,t,a)},10):a(null,null):(this.resultCache[s]=!0,this._textResource(e,t,function(e,t){null===e?(r.resultCache[s]=t,a(null,t)):(r.resultCache[s]=!1,a(null,null))}))},determineDataTagsResourceValue:function(e,a,r,s){let n=this;"string"!=typeof a||""===a.trim()||"string"!=typeof r||""===r.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?n.extractDataTagsSettings(a,r,t,s):s(null,null)})},determineTextResourceValues:function(e,t,r,s,a){let n={},i=0;for(var o=0;o<r.length;o++)this._bindTextResourceValue(e,t,r[o],function(e,t,a){n[e]={value:t,themeId:a},++i===r.length&&s(n)},a)},_bindTextResourceValue:function(e,t,a,r,s){this.determineTextResourceValue(e,t,a,function(e,t){r(a,e,t)},s)},determineTextResourceValue:function(e,a,r,s,n){let i=this;"string"!=typeof r||""===r.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?i.extractResource(n,a,r,t,s):s(null,null)})},registerNamedResourcesDataTagsObserver:function(){let n=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){let a=y(this);var e=a.attr("data-frameId"),t=a.attr("data-personalize-group"),r=a.attr("data-personalize-item");let s=a.attr("data-personalize-value").split(/\s*,\s*/);n.determineDataTagsResourceValue(e,t,r,function(e,t){null===e&&(n.applyDataTagsModifications(a,t,s),"true"===a.attr("data-personalize-show"))&&a.show(),a.attr("data-personalize-loaded","true")})})}})},registerMapResourcesDataTagsObserver:function(){let t=this;Breinify.UTL.dom.addModification("assets::mapResourcesDataTagsObserver",{selector:'[data-mapId][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){var e=y(this);t._renderMappedResource(e),e.attr("data-personalize-loaded","true")})}})},_renderMappedResource:function(t){var a=t.attr("data-mapId");let e=t.attr("data-type");if("string"==typeof a&&""!==a.trim()){if("string"!=typeof e||""===e.trim())if(t.is("a"))e="link";else{if(!t.is("img"))return;e="image"}a="https://assets.breinify.com/mappedResource/"+a;if("image"===e){let e;t.is("img")?(e=t).attr("src",a):((e=y('<img src="" alt=""/>')).attr("class",t.attr("class")).attr("style",t.attr("style")).attr("src",a),t.replaceWith(e))}}},areDataTagsEnabled:function(e,t,a){if(!y.isPlainObject(e))return!1;for(var r=this.extractDataTagsSettings(t,a,e),s=0;s<r.length;s++){var n=r[s];if(y.isPlainObject(n)){var i=y.isArray(n.journey)?n.journey:null;if((null===i||u.is(i))&&!1===this.isDataTagEnabled(n,["enabled"]))return!1}}return!0},isDataTagEnabled:function(e,t){return-1===y.inArray("enabled",t)||"boolean"==typeof e.enabled&&e.enabled},applyDataTagsModifications:function(e,t,a){if(y.isArray(a)&&0!==a.length&&y.isArray(t))for(var r=0;r<t.length;r++){var s=t[r];if(y.isPlainObject(s)){var n=y.isArray(s.journey)?s.journey:null;if((null===n||u.is(n))&&!1!==this.isDataTagEnabled(s,a))for(var i=0;i<a.length;i++){var o=a[i],l=void 0===s[o]?null:s[o];this.applyDataTagsModification(e,o,l)}}}},applyDataTagsModification:function(e,t,a){null!==a&&("text"===t?e.text(a):"html"===t?e.html(a):"font-color"===t?e.css("color",a):"background-color"===t?e.css("background-color",a):"style"===t?e.attr("style",a):"link"===t||"href"===t?e.attr("href",a):"image"===t||"src"===t?e.attr("src",a):"alt"===t?e.attr("alt",a):"title"===t?e.attr("title",a):"source"===t?e.attr("src",a):"enabled"!==t&&console.log("Unknown modification: "+t))},registerNamedResourcesResourceObserver:function(){let s=this;Breinify.UTL.dom.addModification("assets::namedResourcesResourceObserver",{selector:'[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(e){e.each(function(){let a=y(this);var e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");s.determineTextResourceValue(e,t,r,function(e,t){s.applyResourceModification(a,e)})})}})},applyResourceModification:function(e,t){let a="string"==typeof t&&""!==t.trim()?t:null;e.is("img")?(a=null===a?e.attr("data-fallbackSrc"):a,this.applyDataTagsModification(e,"src",a)):e.is("a")&&(a=null===a?e.attr("data-fallbackHref"):a,this.applyDataTagsModification(e,"link",a)),null!==a&&""!==a&&e.attr("data-resourceLoaded","true").show()},extractDataTagsSettings:function(e,t,a,r){a=y.isPlainObject(a)?a:{};a=y.isPlainObject(a["data-tags"])?a["data-tags"]:{};let s;if(0<e.indexOf(".")){s=a;for(var n=e.split("."),i=0;i<n.length;i++){var o=n[i];if(!y.isPlainObject(s[o])){s={};break}s=s[o]}}else s=y.isPlainObject(a[e])?a[e]:{};let l;return l=y.isArray(s[t])?s[t]:y.isPlainObject(s[t])?[s[t]]:[],y.isFunction(r)&&r(null,l),l},parseDate:function(e){var e=e.split("/"),t=parseInt(e[0]),a=parseInt(e[1]),e=parseInt(e[2]),r=new Date;return r.setFullYear(t),r.setMonth(a-1),r.setDate(e),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),Math.floor(r.getTime()/1e3)},parseDateTime:function(e,t){var e=this.parseDate(e),e=new Date(1e3*e),t=t.split(":"),a=parseInt(t[0]),r=parseInt(t[1]),t=parseInt(t[2]);return e.setHours(a),e.setMinutes(r),e.setSeconds(t),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)},extractResource:function(e,t,a,r,s){let n;if("number"==typeof e)n=Math.floor(e/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var i,o=Breinify.UTL.loc.param("assetTimestamp");/^[0-9]+$/.test(o)?n=parseInt(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(o)?n=this.parseDate(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(o)&&(i=o.split(/[_\- ]/),n=this.parseDateTime(i[0],i[1]))}catch(e){console.log("Failed to parse: "+assetTimestamp),n=null}n="number"==typeof n?n:Math.floor((new Date).getTime()/1e3);let l;if(y.isPlainObject(r.themes)){let e=null;for(var u=Object.keys(r.themes),c=0,f=u.length;c<f;c++){var d=r.themes[u[c]],p="number"==typeof d.start?d.start:null,d="number"==typeof d.end?d.end:null;if(null!==p&&n>=p&&(null===d||n<d)){e=u[c];break}}if(l=r.fallbackThemes,l=y.isArray(l)?l:[],null!==e)l=[e].concat(l);else if(0===l.length)return void s(null,null)}else l=[null];for(var g=0,m=l.length;g<m;g++){var h=l[g],b=null===h?r:r.themes[h];if(y.isPlainObject(b)){b=b[t];if(y.isPlainObject(b)){b=b[a];if(null!=b&&("string"!=typeof b||""!==b.trim()))return void s(b,h)}}}s(null,null)}};let t=Breinify.plugins._add("assets",{applyResourceModification:function(a){var e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");i.determineTextResourceValue(e,t,r,function(e,t){i.applyResourceModification(a,e)})},applyDataTagsModifications:function(e,t){var a=e.attr("data-personalize-group"),r=e.attr("data-personalize-item"),s=e.attr("data-personalize-value").split(/\s*,\s*/),a=i.extractDataTagsSettings(a,r,t);i.applyDataTagsModifications(e,a,s),"true"===e.attr("data-personalize-show")&&e.show(),e.attr("data-personalize-loaded","true")},observeNamedResourceDomElements:function(e){!0===(e=y.extend({resourceObserver:this.getConfig("observeResources",!1)||this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},e)).resourceObserver&&i.registerNamedResourcesResourceObserver(),!0===e.dataTagsObserver&&(i.registerNamedResourcesDataTagsObserver(),i.registerMapResourcesDataTagsObserver())},areDataTagsEnabled:function(){return e.overload({"Object,Object":function(e,t){return i.areDataTagsEnabled(e,t.group,t.item,cb)},"Object,String,String":function(e,t,a){return i.areDataTagsEnabled(e,t,a)}},arguments,this)},textResource:function(){e.overload({"Object,Function":function(e,t){i.textResource(e.frameId,null,t)},"String,Function":function(e,t){i.textResource(e,null,t)},"Object,Number,Function":function(e,t,a){i.textResource(e.frameId,t,a)},"String,Number,Function":function(e,t,a){i.textResource(e,t,a)},"String,String,String,Function,Number":function(e,t,a,r,s){i.determineTextResourceValue(e,t,a,r,s)},"String,String,Array,Function,Number":function(e,t,a,r,s){i.determineTextResourceValues(e,t,a,r,s)}},arguments,this)}});Breinify.onReady(function(){t.observeNamedResourceDomElements()})}})();
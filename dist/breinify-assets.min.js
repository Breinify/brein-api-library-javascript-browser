(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){let b=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),u=Breinify.plugins.journey,i=Breinify.UTL.constants.errors.prefix.assets,n={marker:{mappedResourceAutoDetectionType:"auto",mappedResourceType:{image:"image",url:"url",iframe:"iframe",html:"html",untouched:"untouched"},mappedResourceData:{settings:"br-mapped-resource-data"}},resultCache:{},resourceAutoRefresh:{handler:null,resources:[]},_textResource:function(a,e,s){let t="https://assets.breinify.com/frame/"+a;"number"==typeof e&&/^\d{10}$/.test(e.toString())&&(t+="/"+e),b.getJSON(t,function(e){s(null,e)}).fail(function(e,t,r){s({error:i+' Unable to retrieve resource from "'+a+'"',textStatus:t,responseText:e.responseText})})},textResource:function(e,t,r){let a=this,s=("number"==typeof t&&10===t.toString().length||(t=null),e+(null===t?"":"/"+t));b.isPlainObject(this.resultCache[s])?r(null,this.resultCache[s]):"boolean"==typeof this.resultCache[s]?!0===this.resultCache[s]?setTimeout(function(){a.textResource(e,t,r)},10):r(null,null):(this.resultCache[s]=!0,this._textResource(e,t,function(e,t){null===e?(a.resultCache[s]=t,r(null,t)):(a.resultCache[s]=!1,r(null,null))}))},determineDataTagsResourceValue:function(e,r,a,s){let i=this;"string"!=typeof r||""===r.trim()||"string"!=typeof a||""===a.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?i.extractDataTagsSettings(r,a,t,s):s(null,null)})},determineTextResourceValues:function(e,t,a,s,r){let i={},n=0;for(var o=0;o<a.length;o++)this._bindTextResourceValue(e,t,a[o],function(e,t,r){i[e]={value:t,themeId:r},++n===a.length&&s(i)},r)},_bindTextResourceValue:function(e,t,r,a,s){this.determineTextResourceValue(e,t,r,function(e,t){a(r,e,t)},s)},determineTextResourceValue:function(e,r,a,s,i){let n=this;"string"!=typeof a||""===a.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?n.extractResource(i,r,a,t,s):s(null,null)})},registerNamedResourcesDataTagsObserver:function(){let i=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){let r=b(this);var e=r.attr("data-frameId"),t=r.attr("data-personalize-group"),a=r.attr("data-personalize-item");let s=r.attr("data-personalize-value").split(/\s*,\s*/);i.determineDataTagsResourceValue(e,t,a,function(e,t){null===e&&(i.applyDataTagsModifications(r,t,s),"true"===r.attr("data-personalize-show"))&&r.show(),r.attr("data-personalize-loaded","true")})})}})},registerMapResourcesDataTagsObserver:function(){let t=this;Breinify.UTL.dom.addModification("assets::mapResourcesDataTagsObserver",{selector:'[data-mapId][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){var e=b(this);t._handleMappedResource(e),e.attr("data-personalize-loaded","true")})}})},refreshMappedResource:function(e,t){var r=e.data(this.marker.mappedResourceData.settings);b.isPlainObject(r)&&"string"==typeof r.mapId&&""!==r.mapId&&(r.source=this._createSource(r.mapId,t),this._renderMappedResource(e,r.type,r.mapId))},_handleMappedResource:function(i,n){let o=this,l=(n=b.isFunction(n)?n:this._createCallback(),i.attr("data-mapId"));if("string"!=typeof l||""===l.trim())n(new Error("missing mapId"));else{var e,t=i.attr("data-type");if("string"!=typeof t||""===t.trim())n(new Error("missing type"));else{let s=function(e,t,r,a){"string"!=typeof t||""===t.trim()?a(new Error("invalid type: "+t)):o._renderMappedResource(e,t,r,a)};t===this.marker.mappedResourceAutoDetectionType?(e=this._createUrl(l,{}),b.ajax({url:e,type:"HEAD",success:function(e,t,r){r=r.getResponseHeader("x-mapped-resource-content-type");let a;switch("string"==typeof r?r:"UNDEFINED"){case"IMAGE":a=o.marker.mappedResourceType.image;break;case"HTML":a=o.marker.mappedResourceType.html;break;case"URL":a=o.marker.mappedResourceType.iframe;break;default:a=o.marker.mappedResourceType.untouched}s(i,a,l,n)},error:function(e,t,r){n(new Error("failed to determine type: "+t+" ("+r+")"))}})):s(i,t,l,n)}}},_renderMappedResource:function(s,i,n,o){let l=this;if(o=b.isFunction(o)?o:this._createCallback(),"string"!=typeof i||""===i.trim())o(new Error("invalid type: "+i));else{let a=null;if(b.each(this.marker.mappedResourceType,function(e,t){t===i.toLowerCase()&&(a=t)}),null===a)o(new Error("invalid type: "+i));else{var u=this._createSource(n);let t=s.attr("id"),r=(t="string"==typeof t&&""!==t.trim()?t:Breinify.UTL.uuid(),{type:a,resourceId:t,mapId:n,source:u});if(a===this.marker.mappedResourceType.image){let e;s.is("img")?(e=s).attr("src",u):((e=b('<img src="" alt="" />')).attr("class",s.attr("class")).attr("style",s.attr("style")).attr("alt",s.attr("data-alt")).attr("src",u),s.replaceWith(e)),this._setUpElement(s,e,t,r,o)}else if(a===this.marker.mappedResourceType.html)b.ajax({url:u,type:"GET",dataType:"html",success:function(e){e=b(e);e.attr("class",s.attr("class")).attr("style",s.attr("style")),s.replaceWith(e),l._setUpElement(s,e,t,r,o)},error:function(e,t,r){o(new Error("failed to retrieve data: "+t+" ("+r+")"))}});else if(a===this.marker.mappedResourceType.url){let e;s.is("a")?(e=s).attr("href",u):((e=b('<a href=""></a>')).attr("class",s.attr("class")).attr("style",s.attr("style")).attr("target",s.attr("data-target")).attr("href",u),"string"==typeof(n=s.attr("data-link-text"))&&""!==n.trim()?e.text(n):e.text(u),s.replaceWith(e)),this._setUpElement(s,e,t,r,o)}else if(a===this.marker.mappedResourceType.iframe){let e;s.is("iframe")?(e=s).attr("src",u):((e=b('<iframe src=""></iframe>')).attr("class",s.attr("class")).attr("style",s.attr("style")).attr("src",u),s.replaceWith(e)),this._setUpElement(s,e,t,r,o)}else a===this.marker.mappedResourceType.iframe?this._setUpElement(s,s,t,r,o):o(new Error("unsupported type: "+i))}}},_setUpElement:function(e,t,r,a,s){let i=this;t.attr("id",r).data(this.marker.mappedResourceData.settings,a).show(),!0==("true"===e.attr("data-auto-refresh"))&&(null===this.resourceAutoRefresh.handler&&(this.resourceAutoRefresh.handler=window.setInterval(function(){i._checkAutoRefresh()},1e3)),this.resourceAutoRefresh.resources.push(r),this._checkAutoRefresh()),s(null,{$el:t,data:a})},_createSource:function(e,t){var r=new Date,a=r.getFullYear(),s=("0"+(r.getMonth()+1)).slice(-2),i=("0"+r.getDate()).slice(-2),r=("0"+r.getHours()).slice(-2),n=Breinify.UTL.user.create(),a=(delete n.additional,a+s+i+" "+r+"0000"),s=Breinify.UTL.user.getBrowserId(),i=b.extend(!0,{date:a,additional:{identifiers:{browserId:s}}},n,b.isPlainObject(t)?t:{});return this._createUrl(e,i)},_createUrl:function(e,t){let r="/J/";try{r+=this._encodeData(t)}catch(e){r=""}return"https://assets.breinify.com/mappedResource/"+e+r},_encodeData:function(e){e=JSON.stringify(e);return btoa(e).replaceAll("+","~").replaceAll("/","-").replaceAll("=","_")},_checkAutoRefresh:function(){for(let e=this.resourceAutoRefresh.resources.length-1;0<=e;e--){var t=this.resourceAutoRefresh.resources[e],t=b("#"+t);!1===this._checkElementAutoRefresh(t)&&this.resourceAutoRefresh.resources.splice(e,1)}},_checkElementAutoRefresh:function(e){var t,r;return 0!==e.length&&(t=e.data(this.marker.mappedResourceData.settings),!(!b.isPlainObject(t)||"string"!=typeof t.mapId))&&(r=this._createSource(t.mapId),t.source===r||t.type===this.marker.mappedResourceType.image&&(e.attr("src",r),t.source=r,!0))},_createCallback:function(){return function(e,t){Breinify.UTL.internal.isDevMode()&&(null===e?console.log("[Breinify] utilizing following data to render mapped resource",t):console.error("[Breinify] failed to utilize mapped resource",e))}},areDataTagsEnabled:function(e,t,r){if(!b.isPlainObject(e))return!1;for(var a=this.extractDataTagsSettings(t,r,e),s=0;s<a.length;s++){var i=a[s];if(b.isPlainObject(i)){var n=b.isArray(i.journey)?i.journey:null;if((null===n||u.is(n))&&!1===this.isDataTagEnabled(i,["enabled"]))return!1}}return!0},isDataTagEnabled:function(e,t){return-1===b.inArray("enabled",t)||"boolean"==typeof e.enabled&&e.enabled},applyDataTagsModifications:function(e,t,r){if(b.isArray(r)&&0!==r.length&&b.isArray(t))for(var a=0;a<t.length;a++){var s=t[a];if(b.isPlainObject(s)){var i=b.isArray(s.journey)?s.journey:null;if((null===i||u.is(i))&&!1!==this.isDataTagEnabled(s,r))for(var n=0;n<r.length;n++){var o=r[n],l=void 0===s[o]?null:s[o];this.applyDataTagsModification(e,o,l)}}}},applyDataTagsModification:function(e,t,r){null!==r&&("text"===t?e.text(r):"html"===t?e.html(r):"font-color"===t?e.css("color",r):"background-color"===t?e.css("background-color",r):"style"===t?e.attr("style",r):"link"===t||"href"===t?e.attr("href",r):"image"===t||"src"===t?e.attr("src",r):"alt"===t?e.attr("alt",r):"title"===t?e.attr("title",r):"source"===t?e.attr("src",r):"enabled"!==t&&console.log("Unknown modification: "+t))},registerNamedResourcesResourceObserver:function(){let s=this;Breinify.UTL.dom.addModification("assets::namedResourcesResourceObserver",{selector:'[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(e){e.each(function(){let r=b(this);var e=r.attr("data-frameId"),t=r.attr("data-resourceType"),a=r.attr("data-resourceId");s.determineTextResourceValue(e,t,a,function(e,t){s.applyResourceModification(r,e)})})}})},applyResourceModification:function(e,t){let r="string"==typeof t&&""!==t.trim()?t:null;e.is("img")?(r=null===r?e.attr("data-fallbackSrc"):r,this.applyDataTagsModification(e,"src",r)):e.is("a")&&(r=null===r?e.attr("data-fallbackHref"):r,this.applyDataTagsModification(e,"link",r)),null!==r&&""!==r&&e.attr("data-resourceLoaded","true").show()},extractDataTagsSettings:function(e,t,r,a){r=b.isPlainObject(r)?r:{};r=b.isPlainObject(r["data-tags"])?r["data-tags"]:{};let s;if(0<e.indexOf(".")){s=r;for(var i=e.split("."),n=0;n<i.length;n++){var o=i[n];if(!b.isPlainObject(s[o])){s={};break}s=s[o]}}else s=b.isPlainObject(r[e])?r[e]:{};let l;return l=b.isArray(s[t])?s[t]:b.isPlainObject(s[t])?[s[t]]:[],b.isFunction(a)&&a(null,l),l},parseDate:function(e){var e=e.split("/"),t=parseInt(e[0]),r=parseInt(e[1]),e=parseInt(e[2]),a=new Date;return a.setFullYear(t),a.setMonth(r-1),a.setDate(e),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),Math.floor(a.getTime()/1e3)},parseDateTime:function(e,t){var e=this.parseDate(e),e=new Date(1e3*e),t=t.split(":"),r=parseInt(t[0]),a=parseInt(t[1]),t=parseInt(t[2]);return e.setHours(r),e.setMinutes(a),e.setSeconds(t),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)},extractResource:function(e,t,r,a,s){let i;if("number"==typeof e)i=Math.floor(e/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var n,o=Breinify.UTL.loc.param("assetTimestamp");/^[0-9]+$/.test(o)?i=parseInt(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(o)?i=this.parseDate(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(o)&&(n=o.split(/[_\- ]/),i=this.parseDateTime(n[0],n[1]))}catch(e){console.log("Failed to parse: "+assetTimestamp),i=null}i="number"==typeof i?i:Math.floor((new Date).getTime()/1e3);let l;if(b.isPlainObject(a.themes)){let e=null;for(var u=Object.keys(a.themes),c=0,d=u.length;c<d;c++){var f=a.themes[u[c]],p="number"==typeof f.start?f.start:null,f="number"==typeof f.end?f.end:null;if(null!==p&&i>=p&&(null===f||i<f)){e=u[c];break}}if(l=a.fallbackThemes,l=b.isArray(l)?l:[],null!==e)l=[e].concat(l);else if(0===l.length)return void s(null,null)}else l=[null];for(var m=0,h=l.length;m<h;m++){var g=l[m],y=null===g?a:a.themes[g];if(b.isPlainObject(y)){y=y[t];if(b.isPlainObject(y)){y=y[r];if(null!=y&&("string"!=typeof y||""!==y.trim()))return void s(y,g)}}}s(null,null)}};let t=Breinify.plugins._add("assets",{applyResourceModification:function(r){var e=r.attr("data-frameId"),t=r.attr("data-resourceType"),a=r.attr("data-resourceId");n.determineTextResourceValue(e,t,a,function(e,t){n.applyResourceModification(r,e)})},applyDataTagsModifications:function(e,t){var r=e.attr("data-personalize-group"),a=e.attr("data-personalize-item"),s=e.attr("data-personalize-value").split(/\s*,\s*/),r=n.extractDataTagsSettings(r,a,t);n.applyDataTagsModifications(e,r,s),"true"===e.attr("data-personalize-show")&&e.show(),e.attr("data-personalize-loaded","true")},observeNamedResourceDomElements:function(e){!0===(e=b.extend({resourceObserver:this.getConfig("observeResources",!1)||this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},e)).resourceObserver&&n.registerNamedResourcesResourceObserver(),!0===e.dataTagsObserver&&(n.registerNamedResourcesDataTagsObserver(),n.registerMapResourcesDataTagsObserver())},refreshMapResource:function(e,t){n.refreshMappedResource(e,t)},areDataTagsEnabled:function(){return e.overload({"Object,Object":function(e,t){return n.areDataTagsEnabled(e,t.group,t.item,cb)},"Object,String,String":function(e,t,r){return n.areDataTagsEnabled(e,t,r)}},arguments,this)},textResource:function(){e.overload({"Object,Function":function(e,t){n.textResource(e.frameId,null,t)},"String,Function":function(e,t){n.textResource(e,null,t)},"Object,Number,Function":function(e,t,r){n.textResource(e.frameId,t,r)},"String,Number,Function":function(e,t,r){n.textResource(e,t,r)},"String,String,String,Function,Number":function(e,t,r,a,s){n.determineTextResourceValue(e,t,r,a,s)},"String,String,Array,Function,Number":function(e,t,r,a,s){n.determineTextResourceValues(e,t,r,a,s)}},arguments,this)}});Breinify.onReady(function(){t.observeNamedResourceDomElements()})}})();
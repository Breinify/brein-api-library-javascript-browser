"use strict";!function(){if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=Breinify.plugins.journey,d=Breinify.UTL.constants.errors.prefix.assets,e={resultCache:{},textResource:function(b,c){a.getJSON("https://assets.breinify.com/frame/"+b,function(a){c(null,a)}).fail(function(a,e,f){c({error:d+' Unable to retrieve resource from "'+b+'"',textStatus:e,responseText:a.responseText})})},determineDataTagsResourceValue:function(b,c,d,e){var f=this;"string"!=typeof c||""===c.trim()||"string"!=typeof d||""===d.trim()?e(null,null):a.isPlainObject(this.resultCache[b])?this.extractDataTagsSettings(c,d,this.resultCache[b],e):"boolean"==typeof this.resultCache[b]?this.resultCache[b]===!0?setTimeout(function(){f.determineDataTagsResourceValue(b,c,d,e)},10):e(null,null):(this.resultCache[b]=!0,this.textResource(b,function(a,g){null===a?(f.resultCache[b]=g,f.extractDataTagsSettings(c,d,g,e)):(f.resultCache[b]=!1,e(null,null))}))},determineTextResourceValue:function(b,c,d,e,f){var g=this;"string"!=typeof d||""===d.trim()?e(null,null):a.isPlainObject(this.resultCache[b])?this.extractResource(f,c,d,this.resultCache[b],e):"boolean"==typeof this.resultCache[b]?this.resultCache[b]===!0?setTimeout(function(){g.determineTextResourceValue(b,c,d,e,f)},10):e(null,null):(this.resultCache[b]=!0,this.textResource(b,function(a,h){null===a?(g.resultCache[b]=h,g.extractResource(f,c,d,h,e)):(g.resultCache[b]=!1,e(null,null))}))},registerNamedResourcesDataTagsObserver:function(){var b=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(c){c.each(function(){var c=a(this),d=c.attr("data-frameId"),e=c.attr("data-personalize-group"),f=c.attr("data-personalize-item"),g=c.attr("data-personalize-value"),h=g.split(/\s*,\s*/);b.determineDataTagsResourceValue(d,e,f,function(a,d){null===a&&b.applyDataTagsModifications(c,d,h),c.attr("data-personalize-loaded","true")})})}})},applyDataTagsModifications:function(b,d,e){if(a.isArray(e)&&0!==e.length&&a.isArray(d))for(var f=0;f<d.length;f++){var g=d[f];if(a.isPlainObject(g)){var h=a.isArray(g.journey)?g.journey:null;if(null===h||c.is(h))for(var i=0;i<e.length;i++){var j=e[i],k="undefined"==typeof g[j]?null:g[j];this.applyDataTagsModification(b,j,k)}}}},applyDataTagsModification:function(a,b,c){null!==c&&("text"===b?a.text(c):"html"===b?a.html(c):a.css("color",c))},registerNamedResourcesImgObserver:function(){var b=this;Breinify.UTL.dom.addModification("assets::namedResourcesImgObserver",{selector:'img[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(c){c.each(function(){var c=a(this),d=c.attr("data-frameId"),e=c.attr("data-resourceType"),f=c.attr("data-resourceId"),g=c.attr("data-fallbackSrc");b.determineTextResourceValue(d,e,f,function(a,b){"string"==typeof a&&""!==a.trim()?c.attr("src",a):"string"==typeof g&&""!==g.trim()?c.attr("src",g):c.attr("src",""),""!==c.attr("src").trim()&&c.attr("data-resourceLoaded","true").show()})})}})},extractDataTagsSettings:function(b,c,d,e){d=a.isPlainObject(d)?d:{};var f=a.isPlainObject(d["data-tags"])?d["data-tags"]:{},g=a.isPlainObject(f[b])?f[b]:{},h=a.isArray(g[c])?g[c]:[];e(null,h)},extractResource:function(b,c,d,e,f){var g;if("number"==typeof b)g=Math.floor(b/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp")){var h=Breinify.UTL.loc.param("assetTimestamp");/[0-9]+/.test(h)&&(g=parseInt(h))}g="number"==typeof g?g:Math.floor((new Date).getTime()/1e3);var i;if(a.isPlainObject(e.themes)){for(var j=null,k=Object.keys(e.themes),l=0,m=k.length;l<m;l++){var n=e.themes[k[l]],o="number"==typeof n.start?n.start:null,p="number"==typeof n.end?n.end:null;if(null===o);else if(g>=o&&(null===p||g<p)){j=k[l];break}}if(i=e.fallbackThemes,i=a.isArray(i)?i:[],null!==j)i=[j].concat(i);else if(0===i.length)return void f(null,null)}else i=[null];for(var q=0,r=i.length;q<r;q++){var s=i[q],t=null===s?e:e.themes[s];if(a.isPlainObject(t)){var u=t[c];if(a.isPlainObject(u)){var v=u[d];if("string"==typeof v&&""!==v.trim())return void f(v,s)}}}f(null,null)}},f={observeNamedResourceDomElements:function(b){b=a.extend({imgObserver:this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},b),b.imgObserver===!0&&e.registerNamedResourcesImgObserver(),b.dataTagsObserver===!0&&e.registerNamedResourcesDataTagsObserver()},textResource:function(){b.overload({"String,Function":function(a,b){e.textResource(a,b)},"String,String,String,Function,Number":function(a,b,c,d,f){e.determineTextResourceValue(a,b,c,d,f)}},arguments,this)}},g=Breinify.plugins._add("assets",f);Breinify.onReady(function(){g.observeNamedResourceDomElements()})}}();
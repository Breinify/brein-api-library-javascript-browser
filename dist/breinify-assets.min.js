(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){let b=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),u=Breinify.plugins.journey,n=Breinify.UTL.constants.errors.prefix.assets,i={marker:{mappedResourceAutoDetectionType:"auto",mappedResourceType:{image:"image",url:"url",html:"html"},mappedResourceData:{settings:"br-mapped-resource-data"}},resultCache:{},resourceAutoRefresh:{handler:null,resources:[]},_textResource:function(a,e,s){let t="https://assets.breinify.com/frame/"+a;"number"==typeof e&&/^\d{10}$/.test(e.toString())&&(t+="/"+e),b.getJSON(t,function(e){s(null,e)}).fail(function(e,t,r){s({error:n+' Unable to retrieve resource from "'+a+'"',textStatus:t,responseText:e.responseText})})},textResource:function(e,t,r){let a=this,s=("number"==typeof t&&10===t.toString().length||(t=null),e+(null===t?"":"/"+t));b.isPlainObject(this.resultCache[s])?r(null,this.resultCache[s]):"boolean"==typeof this.resultCache[s]?!0===this.resultCache[s]?setTimeout(function(){a.textResource(e,t,r)},10):r(null,null):(this.resultCache[s]=!0,this._textResource(e,t,function(e,t){null===e?(a.resultCache[s]=t,r(null,t)):(a.resultCache[s]=!1,r(null,null))}))},determineDataTagsResourceValue:function(e,r,a,s){let n=this;"string"!=typeof r||""===r.trim()||"string"!=typeof a||""===a.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?n.extractDataTagsSettings(r,a,t,s):s(null,null)})},determineTextResourceValues:function(e,t,a,s,r){let n={},i=0;for(var o=0;o<a.length;o++)this._bindTextResourceValue(e,t,a[o],function(e,t,r){n[e]={value:t,themeId:r},++i===a.length&&s(n)},r)},_bindTextResourceValue:function(e,t,r,a,s){this.determineTextResourceValue(e,t,r,function(e,t){a(r,e,t)},s)},determineTextResourceValue:function(e,r,a,s,n){let i=this;"string"!=typeof a||""===a.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?i.extractResource(n,r,a,t,s):s(null,null)})},registerNamedResourcesDataTagsObserver:function(){let n=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){let r=b(this);var e=r.attr("data-frameId"),t=r.attr("data-personalize-group"),a=r.attr("data-personalize-item");let s=r.attr("data-personalize-value").split(/\s*,\s*/);n.determineDataTagsResourceValue(e,t,a,function(e,t){null===e&&(n.applyDataTagsModifications(r,t,s),"true"===r.attr("data-personalize-show"))&&r.show(),r.attr("data-personalize-loaded","true")})})}})},registerMapResourcesDataTagsObserver:function(){let t=this;Breinify.UTL.dom.addModification("assets::mapResourcesDataTagsObserver",{selector:'[data-mapId][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){var e=b(this);t._handleMappedResource(e),e.attr("data-personalize-loaded","true")})}})},refreshMappedResource:function(e,t){var r=e.data(this.marker.mappedResourceData.settings);b.isPlainObject(r)&&"string"==typeof r.mapId&&""!==r.mapId&&(t=this._createSource(r.mapId,t),e.removeAttr("src"),e.attr("src",t),r.source=t)},_handleMappedResource:function(n,i){let o=this,l=(i=b.isFunction(i)?i:function(){},n.attr("data-mapId"));if("string"!=typeof l||""===l.trim())i(new Error("missing mapId"));else{var e,t=n.attr("data-type");if("string"!=typeof t||""!==t.trim())i(new Error("missing type"));else{let s=function(e,t,r,a){t?a(new Error("invalid type: "+t)):o._renderMappedResource(e,t,r,a)};t===this.marker.mappedResourceAutoDetectionType?(e=this._createUrl(l,{}),b.ajax({url:e,type:"HEAD",success:function(e,t,r){let a=r.getResponseHeader("x-mapped-resource-content-type");a="string"==typeof a?a.toLowerCase():"undefined",s(n,a,l,i)},error:function(e,t,r){i(new Error("failed to determine type: "+t+" ("+r+")"))}})):s(n,t,l,i)}}},_renderMappedResource:function(s,n,t,i){let o=this;if(i=b.isFunction(i)?i:function(){},"string"!=typeof n||""===n.trim())i(new Error("invalid type: "+n));else{let a=null;if(b.each(this.marker.mappedResourceType,function(e,t){t===n.toLowerCase()&&(a=t)}),null===a)i(new Error("invalid type: "+n));else{var l=this._createSource(t);let r=s.attr("id");r="string"==typeof r&&""!==r.trim()?r:Breinify.UTL.uuid();var u,t={type:a,resourceId:r,mapId:t,source:l};if(a===this.marker.mappedResourceType.image){let e;s.is("img")?(e=s).attr("src",l):((u=b('<img src="" alt="" />')).attr("class",s.attr("class")).attr("style",s.attr("style")).attr("alt",s.attr("data-alt")).attr("src",l),s.replaceWith(u)),this._setUpElement(s,e,r,t,i)}else if(a===this.marker.mappedResourceType.html)b.ajax({url:l,type:"GET",dataType:"html",success:function(e){var t=b(e);t.attr("class",s.attr("class")).attr("style",s.attr("style")),s.replaceWith(t),o._setUpElement(s,t,r,e,i)},error:function(e,t,r){i(new Error("failed to retrieve data: "+t+" ("+r+")"))}});else if(a===this.marker.mappedResourceType.url){let e;s.is("a")?(e=s).attr("href",l):((e=b('<a href="" />')).attr("class",s.attr("class")).attr("style",s.attr("style")).attr("target",s.attr("data-target")).attr("href",l),s.replaceWith(e)),this._setUpElement(s,e,r,t,i)}else i(new Error("unsupported type: "+n))}}},_setUpElement:function(e,t,r,a,s){let n=this;t.attr("id",r).data(this.marker.mappedResourceData.settings,a).show(),!0==("true"===e.attr("data-auto-refresh"))&&(null===this.resourceAutoRefresh.handler&&(this.resourceAutoRefresh.handler=window.setInterval(function(){n._checkAutoRefresh()},1e3)),this.resourceAutoRefresh.resources.push(r),this._checkAutoRefresh()),s(null,{$el:t,data:a})},_createSource:function(e,t){var r=new Date,a=r.getFullYear(),s=("0"+(r.getMonth()+1)).slice(-2),n=("0"+r.getDate()).slice(-2),r=("0"+r.getHours()).slice(-2),i=Breinify.UTL.user.create(),a=(delete i.additional,a+s+n+" "+r+"0000"),s=Breinify.UTL.user.getBrowserId(),n=b.extend(!0,{date:a,additional:{identifiers:{browserId:s}}},i,b.isPlainObject(t)?t:{});return this._createUrl(e,n)},_createUrl:function(e,t){let r="/J/";try{r+=this._encodeData(t)}catch(e){r=""}return"https://assets.breinify.com/mappedResource/"+e+r},_encodeData:function(e){e=JSON.stringify(e);return btoa(e).replaceAll("+","~").replaceAll("/","-").replaceAll("=","_")},_checkAutoRefresh:function(){for(let e=this.resourceAutoRefresh.resources.length-1;0<=e;e--){var t=this.resourceAutoRefresh.resources[e],t=b("#"+t);!1===this._checkElementAutoRefresh(t)&&this.resourceAutoRefresh.resources.splice(e,1)}},_checkElementAutoRefresh:function(e){var t,r;return 0!==e.length&&(t=e.data(this.marker.mappedResourceData.settings),!(!b.isPlainObject(t)||"string"!=typeof t.mapId))&&(r=this._createSource(t.mapId),t.source===r||t.type===this.marker.mappedResourceType.image&&(e.attr("src",r),t.source=r,!0))},areDataTagsEnabled:function(e,t,r){if(!b.isPlainObject(e))return!1;for(var a=this.extractDataTagsSettings(t,r,e),s=0;s<a.length;s++){var n=a[s];if(b.isPlainObject(n)){var i=b.isArray(n.journey)?n.journey:null;if((null===i||u.is(i))&&!1===this.isDataTagEnabled(n,["enabled"]))return!1}}return!0},isDataTagEnabled:function(e,t){return-1===b.inArray("enabled",t)||"boolean"==typeof e.enabled&&e.enabled},applyDataTagsModifications:function(e,t,r){if(b.isArray(r)&&0!==r.length&&b.isArray(t))for(var a=0;a<t.length;a++){var s=t[a];if(b.isPlainObject(s)){var n=b.isArray(s.journey)?s.journey:null;if((null===n||u.is(n))&&!1!==this.isDataTagEnabled(s,r))for(var i=0;i<r.length;i++){var o=r[i],l=void 0===s[o]?null:s[o];this.applyDataTagsModification(e,o,l)}}}},applyDataTagsModification:function(e,t,r){null!==r&&("text"===t?e.text(r):"html"===t?e.html(r):"font-color"===t?e.css("color",r):"background-color"===t?e.css("background-color",r):"style"===t?e.attr("style",r):"link"===t||"href"===t?e.attr("href",r):"image"===t||"src"===t?e.attr("src",r):"alt"===t?e.attr("alt",r):"title"===t?e.attr("title",r):"source"===t?e.attr("src",r):"enabled"!==t&&console.log("Unknown modification: "+t))},registerNamedResourcesResourceObserver:function(){let s=this;Breinify.UTL.dom.addModification("assets::namedResourcesResourceObserver",{selector:'[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(e){e.each(function(){let r=b(this);var e=r.attr("data-frameId"),t=r.attr("data-resourceType"),a=r.attr("data-resourceId");s.determineTextResourceValue(e,t,a,function(e,t){s.applyResourceModification(r,e)})})}})},applyResourceModification:function(e,t){let r="string"==typeof t&&""!==t.trim()?t:null;e.is("img")?(r=null===r?e.attr("data-fallbackSrc"):r,this.applyDataTagsModification(e,"src",r)):e.is("a")&&(r=null===r?e.attr("data-fallbackHref"):r,this.applyDataTagsModification(e,"link",r)),null!==r&&""!==r&&e.attr("data-resourceLoaded","true").show()},extractDataTagsSettings:function(e,t,r,a){r=b.isPlainObject(r)?r:{};r=b.isPlainObject(r["data-tags"])?r["data-tags"]:{};let s;if(0<e.indexOf(".")){s=r;for(var n=e.split("."),i=0;i<n.length;i++){var o=n[i];if(!b.isPlainObject(s[o])){s={};break}s=s[o]}}else s=b.isPlainObject(r[e])?r[e]:{};let l;return l=b.isArray(s[t])?s[t]:b.isPlainObject(s[t])?[s[t]]:[],b.isFunction(a)&&a(null,l),l},parseDate:function(e){var e=e.split("/"),t=parseInt(e[0]),r=parseInt(e[1]),e=parseInt(e[2]),a=new Date;return a.setFullYear(t),a.setMonth(r-1),a.setDate(e),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),Math.floor(a.getTime()/1e3)},parseDateTime:function(e,t){var e=this.parseDate(e),e=new Date(1e3*e),t=t.split(":"),r=parseInt(t[0]),a=parseInt(t[1]),t=parseInt(t[2]);return e.setHours(r),e.setMinutes(a),e.setSeconds(t),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)},extractResource:function(e,t,r,a,s){let n;if("number"==typeof e)n=Math.floor(e/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var i,o=Breinify.UTL.loc.param("assetTimestamp");/^[0-9]+$/.test(o)?n=parseInt(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(o)?n=this.parseDate(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(o)&&(i=o.split(/[_\- ]/),n=this.parseDateTime(i[0],i[1]))}catch(e){console.log("Failed to parse: "+assetTimestamp),n=null}n="number"==typeof n?n:Math.floor((new Date).getTime()/1e3);let l;if(b.isPlainObject(a.themes)){let e=null;for(var u=Object.keys(a.themes),c=0,d=u.length;c<d;c++){var f=a.themes[u[c]],p="number"==typeof f.start?f.start:null,f="number"==typeof f.end?f.end:null;if(null!==p&&n>=p&&(null===f||n<f)){e=u[c];break}}if(l=a.fallbackThemes,l=b.isArray(l)?l:[],null!==e)l=[e].concat(l);else if(0===l.length)return void s(null,null)}else l=[null];for(var h=0,m=l.length;h<m;h++){var g=l[h],y=null===g?a:a.themes[g];if(b.isPlainObject(y)){y=y[t];if(b.isPlainObject(y)){y=y[r];if(null!=y&&("string"!=typeof y||""!==y.trim()))return void s(y,g)}}}s(null,null)}};let t=Breinify.plugins._add("assets",{applyResourceModification:function(r){var e=r.attr("data-frameId"),t=r.attr("data-resourceType"),a=r.attr("data-resourceId");i.determineTextResourceValue(e,t,a,function(e,t){i.applyResourceModification(r,e)})},applyDataTagsModifications:function(e,t){var r=e.attr("data-personalize-group"),a=e.attr("data-personalize-item"),s=e.attr("data-personalize-value").split(/\s*,\s*/),r=i.extractDataTagsSettings(r,a,t);i.applyDataTagsModifications(e,r,s),"true"===e.attr("data-personalize-show")&&e.show(),e.attr("data-personalize-loaded","true")},observeNamedResourceDomElements:function(e){!0===(e=b.extend({resourceObserver:this.getConfig("observeResources",!1)||this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},e)).resourceObserver&&i.registerNamedResourcesResourceObserver(),!0===e.dataTagsObserver&&(i.registerNamedResourcesDataTagsObserver(),i.registerMapResourcesDataTagsObserver())},refreshMapResource:function(e,t){i.refreshMappedResource(e,t)},areDataTagsEnabled:function(){return e.overload({"Object,Object":function(e,t){return i.areDataTagsEnabled(e,t.group,t.item,cb)},"Object,String,String":function(e,t,r){return i.areDataTagsEnabled(e,t,r)}},arguments,this)},textResource:function(){e.overload({"Object,Function":function(e,t){i.textResource(e.frameId,null,t)},"String,Function":function(e,t){i.textResource(e,null,t)},"Object,Number,Function":function(e,t,r){i.textResource(e.frameId,t,r)},"String,Number,Function":function(e,t,r){i.textResource(e,t,r)},"String,String,String,Function,Number":function(e,t,r,a,s){i.determineTextResourceValue(e,t,r,a,s)},"String,String,Array,Function,Number":function(e,t,r,a,s){i.determineTextResourceValues(e,t,r,a,s)}},arguments,this)}});Breinify.onReady(function(){t.observeNamedResourceDomElements()})}})();
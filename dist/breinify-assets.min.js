"use strict";!function(){var v,e,u,s,i,t;"object"!=typeof Breinify||Breinify.plugins._isAdded("assets")||(v=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),u=Breinify.plugins.journey,s=Breinify.UTL.constants.errors.prefix.assets,i={resultCache:{},_textResource:function(r,e,n){var t="https://assets.breinify.com/frame/"+r;"number"==typeof e&&/^\d{10}$/.test(e.toString())&&(t+="/"+e),v.getJSON(t,function(e){n(null,e)}).fail(function(e,t,a){n({error:s+' Unable to retrieve resource from "'+r+'"',textStatus:t,responseText:e.responseText})})},textResource:function(e,t,a){var r=this,n=("number"==typeof t&&10===t.toString().length||(t=null),e+(null===t?"":"/"+t));v.isPlainObject(this.resultCache[n])?a(null,this.resultCache[n]):"boolean"==typeof this.resultCache[n]?!0===this.resultCache[n]?setTimeout(function(){r.textResource(e,t,a)},10):a(null,null):(this.resultCache[n]=!0,this._textResource(e,t,function(e,t){null===e?(r.resultCache[n]=t,a(null,t)):(r.resultCache[n]=!1,a(null,null))}))},determineDataTagsResourceValue:function(e,a,r,n){var s=this;"string"!=typeof a||""===a.trim()||"string"!=typeof r||""===r.trim()?n(null,null):this.textResource(e,null,function(e,t){null===e?s.extractDataTagsSettings(a,r,t,n):n(null,null)})},determineTextResourceValues:function(e,t,r,n,a){for(var s={},i=0,o=0;o<r.length;o++)this._bindTextResourceValue(e,t,r[o],function(e,t,a){s[e]={value:t,themeId:a},++i===r.length&&n(s)},a)},_bindTextResourceValue:function(e,t,a,r,n){this.determineTextResourceValue(e,t,a,function(e,t){r(a,e,t)},n)},determineTextResourceValue:function(e,a,r,n,s){var i=this;"string"!=typeof r||""===r.trim()?n(null,null):this.textResource(e,null,function(e,t){null===e?i.extractResource(s,a,r,t,n):n(null,null)})},registerNamedResourcesDataTagsObserver:function(){var s=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){var a=v(this),e=a.attr("data-frameId"),t=a.attr("data-personalize-group"),r=a.attr("data-personalize-item"),n=a.attr("data-personalize-value").split(/\s*,\s*/);s.determineDataTagsResourceValue(e,t,r,function(e,t){null===e&&(s.applyDataTagsModifications(a,t,n),"true"===a.attr("data-personalize-show"))&&a.show(),a.attr("data-personalize-loaded","true")})})}})},areDataTagsEnabled:function(e,t,a){if(!v.isPlainObject(e))return!1;for(var r=this.extractDataTagsSettings(t,a,e),n=0;n<r.length;n++){var s=r[n];if(v.isPlainObject(s)){var i=v.isArray(s.journey)?s.journey:null;if((null===i||u.is(i))&&!1===this.isDataTagEnabled(s,["enabled"]))return!1}}return!0},isDataTagEnabled:function(e,t){return-1===v.inArray("enabled",t)||"boolean"==typeof e.enabled&&e.enabled},applyDataTagsModifications:function(e,t,a){if(v.isArray(a)&&0!==a.length&&v.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];if(v.isPlainObject(n)){var s=v.isArray(n.journey)?n.journey:null;if((null===s||u.is(s))&&!1!==this.isDataTagEnabled(n,a))for(var i=0;i<a.length;i++){var o=a[i],l=void 0===n[o]?null:n[o];this.applyDataTagsModification(e,o,l)}}}},applyDataTagsModification:function(e,t,a){null!==a&&("text"===t?e.text(a):"html"===t?e.html(a):"font-color"===t?e.css("color",a):"background-color"===t?e.css("background-color",a):"style"===t?e.attr("style",a):"link"===t||"href"===t?e.attr("href",a):"image"===t||"src"===t?e.attr("src",a):"alt"===t?e.attr("alt",a):"title"===t?e.attr("title",a):"source"===t?e.attr("src",a):"enabled"!==t&&console.log("Unknown modification: "+t))},registerNamedResourcesResourceObserver:function(){var n=this;Breinify.UTL.dom.addModification("assets::namedResourcesResourceObserver",{selector:'[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(e){e.each(function(){var a=v(this),e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");n.determineTextResourceValue(e,t,r,function(e,t){n.applyResourceModification(a,e)})})}})},applyResourceModification:function(e,t){t="string"==typeof t&&""!==t.trim()?t:null;e.is("img")?(t=null===t?e.attr("data-fallbackSrc"):t,this.applyDataTagsModification(e,"src",t)):e.is("a")&&(t=null===t?e.attr("data-fallbackHref"):t,this.applyDataTagsModification(e,"link",t)),null!==t&&""!==t&&e.attr("data-resourceLoaded","true").show()},extractDataTagsSettings:function(e,t,a,r){a=v.isPlainObject(a)?a:{};var a=v.isPlainObject(a["data-tags"])?a["data-tags"]:{};if(0<e.indexOf("."))for(var n=a,s=e.split("."),i=0;i<s.length;i++){var o=s[i];if(!v.isPlainObject(n[o])){n={};break}n=n[o]}else n=v.isPlainObject(a[e])?a[e]:{};return a=v.isArray(n[t])?n[t]:v.isPlainObject(n[t])?[n[t]]:[],v.isFunction(r)&&r(null,a),a},parseDate:function(e){var e=e.split("/"),t=parseInt(e[0]),a=parseInt(e[1]),e=parseInt(e[2]),r=new Date;return r.setFullYear(t),r.setMonth(a-1),r.setDate(e),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),Math.floor(r.getTime()/1e3)},parseDateTime:function(e,t){var e=this.parseDate(e),e=new Date(1e3*e),t=t.split(":"),a=parseInt(t[0]),r=parseInt(t[1]),t=parseInt(t[2]);return e.setHours(a),e.setMinutes(r),e.setSeconds(t),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)},extractResource:function(e,t,a,r,n){var s;if("number"==typeof e)o=Math.floor(e/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var i,o,l=Breinify.UTL.loc.param("assetTimestamp");/^[0-9]+$/.test(l)?o=parseInt(l):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(l)?o=this.parseDate(l):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(l)&&(i=l.split(/[_\- ]/),o=this.parseDateTime(i[0],i[1]))}catch(e){console.log("Failed to parse: "+l),o=null}if(o="number"==typeof o?o:Math.floor((new Date).getTime()/1e3),v.isPlainObject(r.themes)){for(var u=null,c=Object.keys(r.themes),f=0,d=c.length;f<d;f++){var g=r.themes[c[f]],p="number"==typeof g.start?g.start:null,g="number"==typeof g.end?g.end:null;if(null!==p&&p<=o&&(null===g||o<g)){u=c[f];break}}if(s=r.fallbackThemes,s=v.isArray(s)?s:[],null!==u)s=[u].concat(s);else if(0===s.length)return void n(null,null)}else s=[null];for(var m=0,h=s.length;m<h;m++){var b=s[m],y=null===b?r:r.themes[b];if(v.isPlainObject(y)){y=y[t];if(v.isPlainObject(y)){y=y[a];if(null!=y&&("string"!=typeof y||""!==y.trim()))return void n(y,b)}}}n(null,null)}},t=Breinify.plugins._add("assets",{applyResourceModification:function(a){var e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");i.determineTextResourceValue(e,t,r,function(e,t){i.applyResourceModification(a,e)})},applyDataTagsModifications:function(e,t){var a=e.attr("data-personalize-group"),r=e.attr("data-personalize-item"),n=e.attr("data-personalize-value").split(/\s*,\s*/),a=i.extractDataTagsSettings(a,r,t);i.applyDataTagsModifications(e,a,n),"true"===e.attr("data-personalize-show")&&e.show(),e.attr("data-personalize-loaded","true")},observeNamedResourceDomElements:function(e){!0===(e=v.extend({resourceObserver:this.getConfig("observeResources",!1)||this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},e)).resourceObserver&&i.registerNamedResourcesResourceObserver(),!0===e.dataTagsObserver&&i.registerNamedResourcesDataTagsObserver()},areDataTagsEnabled:function(){return e.overload({"Object,Object":function(e,t){return i.areDataTagsEnabled(e,t.group,t.item,cb)},"Object,String,String":function(e,t,a){return i.areDataTagsEnabled(e,t,a)}},arguments,this)},textResource:function(){e.overload({"Object,Function":function(e,t){i.textResource(e.frameId,null,t)},"String,Function":function(e,t){i.textResource(e,null,t)},"Object,Number,Function":function(e,t,a){i.textResource(e.frameId,t,a)},"String,Number,Function":function(e,t,a){i.textResource(e,t,a)},"String,String,String,Function,Number":function(e,t,a,r,n){i.determineTextResourceValue(e,t,a,r,n)},"String,String,Array,Function,Number":function(e,t,a,r,n){i.determineTextResourceValues(e,t,a,r,n)}},arguments,this)}}),Breinify.onReady(function(){t.observeNamedResourceDomElements()}))}();
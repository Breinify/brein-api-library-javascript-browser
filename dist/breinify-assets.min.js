(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("assets")){let b=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),u=Breinify.plugins.journey,i=Breinify.UTL.constants.errors.prefix.assets,n={marker:{mappedResourceType:{image:"image"},mappedResourceData:{settings:"br-mapped-resource-data"}},resultCache:{},resourceAutoRefresh:{handler:null,resources:[]},_textResource:function(r,e,s){let t="https://assets.breinify.com/frame/"+r;"number"==typeof e&&/^\d{10}$/.test(e.toString())&&(t+="/"+e),b.getJSON(t,function(e){s(null,e)}).fail(function(e,t,a){s({error:i+' Unable to retrieve resource from "'+r+'"',textStatus:t,responseText:e.responseText})})},textResource:function(e,t,a){let r=this,s=("number"==typeof t&&10===t.toString().length||(t=null),e+(null===t?"":"/"+t));b.isPlainObject(this.resultCache[s])?a(null,this.resultCache[s]):"boolean"==typeof this.resultCache[s]?!0===this.resultCache[s]?setTimeout(function(){r.textResource(e,t,a)},10):a(null,null):(this.resultCache[s]=!0,this._textResource(e,t,function(e,t){null===e?(r.resultCache[s]=t,a(null,t)):(r.resultCache[s]=!1,a(null,null))}))},determineDataTagsResourceValue:function(e,a,r,s){let i=this;"string"!=typeof a||""===a.trim()||"string"!=typeof r||""===r.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?i.extractDataTagsSettings(a,r,t,s):s(null,null)})},determineTextResourceValues:function(e,t,r,s,a){let i={},n=0;for(var o=0;o<r.length;o++)this._bindTextResourceValue(e,t,r[o],function(e,t,a){i[e]={value:t,themeId:a},++n===r.length&&s(i)},a)},_bindTextResourceValue:function(e,t,a,r,s){this.determineTextResourceValue(e,t,a,function(e,t){r(a,e,t)},s)},determineTextResourceValue:function(e,a,r,s,i){let n=this;"string"!=typeof r||""===r.trim()?s(null,null):this.textResource(e,null,function(e,t){null===e?n.extractResource(i,a,r,t,s):s(null,null)})},registerNamedResourcesDataTagsObserver:function(){let i=this;Breinify.UTL.dom.addModification("assets::namedResourcesDataTagsObserver",{selector:'[data-frameId][data-personalize-group][data-personalize-item][data-personalize-value][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){let a=b(this);var e=a.attr("data-frameId"),t=a.attr("data-personalize-group"),r=a.attr("data-personalize-item");let s=a.attr("data-personalize-value").split(/\s*,\s*/);i.determineDataTagsResourceValue(e,t,r,function(e,t){null===e&&(i.applyDataTagsModifications(a,t,s),"true"===a.attr("data-personalize-show"))&&a.show(),a.attr("data-personalize-loaded","true")})})}})},registerMapResourcesDataTagsObserver:function(){let t=this;Breinify.UTL.dom.addModification("assets::mapResourcesDataTagsObserver",{selector:'[data-mapId][data-personalize-loaded!="true"]',modifier:function(e){e.each(function(){var e=b(this);t._renderMappedResource(e),e.attr("data-personalize-loaded","true")})}})},_renderMappedResource:function(r){let s=this;var i=r.attr("data-mapId");if("string"==typeof i&&""!==i.trim()){let e=r.attr("data-type");if("string"!=typeof e||""===e.trim())if(r.is("a"))e="link";else{if(!r.is("img"))return;e="image"}var n=this._createSource(i);let t=r.attr("id");t="string"==typeof t&&""!==t.trim()?t:Breinify.UTL.uuid();i={type:e,resourceId:t,mapId:i,source:n};let a=null;e===this.marker.mappedResourceType.image&&(r.is("img")?(a=r).attr("src",n):((a=b('<img src="" alt="" />')).attr("class",r.attr("class")).attr("style",r.attr("style")).attr("alt",r.attr("data-alt")).attr("src",n),r.replaceWith(a))),null!==a&&(a.attr("id",t),a.data(this.marker.mappedResourceData.settings,i),a.show()),!0==("true"===r.attr("data-auto-refresh"))&&(null===this.resourceAutoRefresh.handler&&(this.resourceAutoRefresh.handler=window.setInterval(function(){s._checkAutoRefresh()},1e3)),this.resourceAutoRefresh.resources.push(t),this._checkAutoRefresh())}},_createSource:function(e){var t=new Date,a=t.getFullYear(),r=("0"+(t.getMonth()+1)).slice(-2),s=("0"+t.getDate()).slice(-2),i=("0"+t.getHours()).slice(-2),n=("0"+t.getMinutes()).slice(-2),t=("0"+t.getSeconds()).slice(-2),o=Breinify.UTL.user.create(),a=(delete o.additional,a+r+s+" "+i+n+t),r=Breinify.UTL.user.getBrowserId(),s=b.extend(!0,{date:a,additional:{identifiers:{browserId:r}}},o);return console.log(s),"https://assets.breinify.com/mappedResource/"+e},_checkAutoRefresh:function(){for(let e=this.resourceAutoRefresh.resources.length-1;0<=e;e--){var t=this.resourceAutoRefresh.resources[e],t=b("#"+t);!1===this._checkElementAutoRefresh(t)&&this.resourceAutoRefresh.resources.splice(e,1)}},_checkElementAutoRefresh:function(e){var t,a;return 0!==e.length&&(t=e.data(this.marker.mappedResourceData.settings),!(!b.isPlainObject(t)||"string"!=typeof t.mapId))&&(a=this._createSource(t.mapId),t.source===a||t.type===this.marker.mappedResourceType.image&&(e.attr("src",a),!0))},areDataTagsEnabled:function(e,t,a){if(!b.isPlainObject(e))return!1;for(var r=this.extractDataTagsSettings(t,a,e),s=0;s<r.length;s++){var i=r[s];if(b.isPlainObject(i)){var n=b.isArray(i.journey)?i.journey:null;if((null===n||u.is(n))&&!1===this.isDataTagEnabled(i,["enabled"]))return!1}}return!0},isDataTagEnabled:function(e,t){return-1===b.inArray("enabled",t)||"boolean"==typeof e.enabled&&e.enabled},applyDataTagsModifications:function(e,t,a){if(b.isArray(a)&&0!==a.length&&b.isArray(t))for(var r=0;r<t.length;r++){var s=t[r];if(b.isPlainObject(s)){var i=b.isArray(s.journey)?s.journey:null;if((null===i||u.is(i))&&!1!==this.isDataTagEnabled(s,a))for(var n=0;n<a.length;n++){var o=a[n],l=void 0===s[o]?null:s[o];this.applyDataTagsModification(e,o,l)}}}},applyDataTagsModification:function(e,t,a){null!==a&&("text"===t?e.text(a):"html"===t?e.html(a):"font-color"===t?e.css("color",a):"background-color"===t?e.css("background-color",a):"style"===t?e.attr("style",a):"link"===t||"href"===t?e.attr("href",a):"image"===t||"src"===t?e.attr("src",a):"alt"===t?e.attr("alt",a):"title"===t?e.attr("title",a):"source"===t?e.attr("src",a):"enabled"!==t&&console.log("Unknown modification: "+t))},registerNamedResourcesResourceObserver:function(){let s=this;Breinify.UTL.dom.addModification("assets::namedResourcesResourceObserver",{selector:'[data-frameId][data-resourceType][data-resourceId][data-resourceLoaded!="true"]',modifier:function(e){e.each(function(){let a=b(this);var e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");s.determineTextResourceValue(e,t,r,function(e,t){s.applyResourceModification(a,e)})})}})},applyResourceModification:function(e,t){let a="string"==typeof t&&""!==t.trim()?t:null;e.is("img")?(a=null===a?e.attr("data-fallbackSrc"):a,this.applyDataTagsModification(e,"src",a)):e.is("a")&&(a=null===a?e.attr("data-fallbackHref"):a,this.applyDataTagsModification(e,"link",a)),null!==a&&""!==a&&e.attr("data-resourceLoaded","true").show()},extractDataTagsSettings:function(e,t,a,r){a=b.isPlainObject(a)?a:{};a=b.isPlainObject(a["data-tags"])?a["data-tags"]:{};let s;if(0<e.indexOf(".")){s=a;for(var i=e.split("."),n=0;n<i.length;n++){var o=i[n];if(!b.isPlainObject(s[o])){s={};break}s=s[o]}}else s=b.isPlainObject(a[e])?a[e]:{};let l;return l=b.isArray(s[t])?s[t]:b.isPlainObject(s[t])?[s[t]]:[],b.isFunction(r)&&r(null,l),l},parseDate:function(e){var e=e.split("/"),t=parseInt(e[0]),a=parseInt(e[1]),e=parseInt(e[2]),r=new Date;return r.setFullYear(t),r.setMonth(a-1),r.setDate(e),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),Math.floor(r.getTime()/1e3)},parseDateTime:function(e,t){var e=this.parseDate(e),e=new Date(1e3*e),t=t.split(":"),a=parseInt(t[0]),r=parseInt(t[1]),t=parseInt(t[2]);return e.setHours(a),e.setMinutes(r),e.setSeconds(t),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)},extractResource:function(e,t,a,r,s){let i;if("number"==typeof e)i=Math.floor(e/1e3);else if(Breinify.UTL.loc.hasParam("assetTimestamp"))try{var n,o=Breinify.UTL.loc.param("assetTimestamp");/^[0-9]+$/.test(o)?i=parseInt(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/.test(o)?i=this.parseDate(o):/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}[_\- ][0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}$/.test(o)&&(n=o.split(/[_\- ]/),i=this.parseDateTime(n[0],n[1]))}catch(e){console.log("Failed to parse: "+assetTimestamp),i=null}i="number"==typeof i?i:Math.floor((new Date).getTime()/1e3);let l;if(b.isPlainObject(r.themes)){let e=null;for(var u=Object.keys(r.themes),c=0,d=u.length;c<d;c++){var f=r.themes[u[c]],p="number"==typeof f.start?f.start:null,f="number"==typeof f.end?f.end:null;if(null!==p&&i>=p&&(null===f||i<f)){e=u[c];break}}if(l=r.fallbackThemes,l=b.isArray(l)?l:[],null!==e)l=[e].concat(l);else if(0===l.length)return void s(null,null)}else l=[null];for(var h=0,g=l.length;h<g;h++){var m=l[h],y=null===m?r:r.themes[m];if(b.isPlainObject(y)){y=y[t];if(b.isPlainObject(y)){y=y[a];if(null!=y&&("string"!=typeof y||""!==y.trim()))return void s(y,m)}}}s(null,null)}};let t=Breinify.plugins._add("assets",{applyResourceModification:function(a){var e=a.attr("data-frameId"),t=a.attr("data-resourceType"),r=a.attr("data-resourceId");n.determineTextResourceValue(e,t,r,function(e,t){n.applyResourceModification(a,e)})},applyDataTagsModifications:function(e,t){var a=e.attr("data-personalize-group"),r=e.attr("data-personalize-item"),s=e.attr("data-personalize-value").split(/\s*,\s*/),a=n.extractDataTagsSettings(a,r,t);n.applyDataTagsModifications(e,a,s),"true"===e.attr("data-personalize-show")&&e.show(),e.attr("data-personalize-loaded","true")},observeNamedResourceDomElements:function(e){!0===(e=b.extend({resourceObserver:this.getConfig("observeResources",!1)||this.getConfig("observeImages",!1),dataTagsObserver:this.getConfig("observeDataTags",!1)},e)).resourceObserver&&n.registerNamedResourcesResourceObserver(),!0===e.dataTagsObserver&&(n.registerNamedResourcesDataTagsObserver(),n.registerMapResourcesDataTagsObserver())},areDataTagsEnabled:function(){return e.overload({"Object,Object":function(e,t){return n.areDataTagsEnabled(e,t.group,t.item,cb)},"Object,String,String":function(e,t,a){return n.areDataTagsEnabled(e,t,a)}},arguments,this)},textResource:function(){e.overload({"Object,Function":function(e,t){n.textResource(e.frameId,null,t)},"String,Function":function(e,t){n.textResource(e,null,t)},"Object,Number,Function":function(e,t,a){n.textResource(e.frameId,t,a)},"String,Number,Function":function(e,t,a){n.textResource(e,t,a)},"String,String,String,Function,Number":function(e,t,a,r,s){n.determineTextResourceValue(e,t,a,r,s)},"String,String,Array,Function,Number":function(e,t,a,r,s){n.determineTextResourceValues(e,t,a,r,s)}},arguments,this)}});Breinify.onReady(function(){t.observeNamedResourceDomElements()})}})();
(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiCountdown")){let o="br-ui-countdown",c=Breinify.UTL._jquery(),n={countdownById:{},update:function(t,e,i,s){if(null!==Breinify.UTL.isNonEmptyString(t.uuid)){var n=this.countdownById[t.uuid];if((n=c.isPlainObject(n)?n:{}).status===e&&n.value===i)n.settings=s;else{this.countdownById[t.uuid]={el:t,status:e,value:i,settings:c.isPlainObject(s)?s:{}};var o,r={noShow:[],renderVisible:[],renderHidden:[]};for(o of Object.values(this.countdownById)){if("initializing"===o.status)return;("rendering"!==o.status?r.noShow:"visible"===o.value?r.renderVisible:"hidden"===o.value?r.renderHidden:r.noShow).push(o.el.uuid)}var a,l={show:[],noShow:[],weighted:{}};for(a of Object.values(this.countdownById))a.el.evaluateResolutionStrategy(r,l,a.settings);var d=this._evaluateContext(l);let n=[];var u=[];for(let[e,i]of Object.entries(this.countdownById))if("rendering"===i.status){let t=i.el.$shadowRoot.find(".countdown-banner");-1<c.inArray(e,d)?!0===i.settings.fadeIn?n.push(()=>t.stop(!0,!0).css("display","block").fadeIn().promise().then(()=>{i.el._sendActivity("renderedElement")})):(t.stop(!0,!0).css("display","block").show(),i.el._sendActivity("renderedElement")):!0===i.settings.fadeOut?u.push(()=>t.stop(!0,!0).fadeOut().promise()):t.stop(!0,!0).hide()}c.when(...u.map(t=>t())).then(()=>c.when(...n.map(t=>t())))}}},_evaluateContext:function(t){return 0<t.show.length?t.show:0<Object.values(t.weighted).length?this._evaluateWeightedContext(t.weighted):[]},_evaluateWeightedContext:function(t){t=Object.entries(t);let e=Math.min(...t.map(([,t])=>t));var t=t.filter(([,t])=>t===e),[t]=(t.sort(([t],[e])=>t.localeCompare(e)),t[0]);return[t]}};class e{constructor(t){this.callback=c.isFunction(t)?t:()=>null,this.timerId=null,this.stopped=!0}start(){if(!1!==this.stopped){this.stopped=!1;let t=()=>{!0!==this.stopped&&(this.timerId=window.setTimeout(()=>{!0!==this.stopped&&(this.callback(),t())},1e3-Date.now()%1e3))};t()}return this}stop(){this.stopped=!0,null!==this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)}}class t extends HTMLElement{$shadowRoot=null;settings=null;uuid=null;constructor(){super(),this.uuid=Breinify.UTL.uuid(),this.attachShadow({mode:"open"}),this.$shadowRoot=c(this.shadowRoot),this.settings={},this._updateStatus("initializing","constructed")}config(t,r){let a=this;var e,i;r=c.isFunction(r)?r:()=>null,c.isPlainObject(t)?null===(e=Breinify.UTL.isNonEmptyString(t.type))?r(new Error('the specified type "'+t.type+'" is invalid'),null):(i=function(t){let i=()=>{null===t?r(null,a.settings):(a._updateStatus("failed","configuration"),r(t,null))};var e,n,s=a.settings.splitTest,o=c.isPlainObject(s)?Breinify.UTL.isNonEmptyString(s.token):null,s=c.isPlainObject(s)?Breinify.UTL.isNonEmptyString(s.splitTestName):null;null!==o&&null!==s?(e=Breinify.UTL.user,n="br-ctd-"+s,Breinify.plugins.splitTests.retrieveSplitTest(s,o,{sessionId:e.getSessionId(),browserId:e.getBrowserId(),splitTestName:s},n,function(t,e){null===t&&c.isPlainObject(e)?null===Breinify.UTL.isNonEmptyString(e.group)?a._updateStatus("ignored","no-group"):!0===(t=c.isPlainObject(e.splitTestData)?e.splitTestData:{}).isControlGroup?a._updateStatus("ignored","control-group"):(a.settings.splitTestData=t,window.queueMicrotask(i)):a._updateStatus("failed","split-test")})):window.queueMicrotask(i)},this._updateStatus("initializing","configuration"),"CAMPAIGN_BASED"===e?this._applyCampaignBasedSettings(t,i):"ONE_TIME"===e?this._applyOneTimeSettings(t,i):this._applyUnknownSettings(t,i)):r(new Error("settings must be a valid object"),null)}_updateStatus(t,e,i){n.update(this,t,e,i)}evaluateResolutionStrategy(t,e){-1!==c.inArray(this.uuid,t.renderVisible)&&(t.renderVisible.length<=1?e.show.push(this.uuid):"DO_NOT_SHOW"===(t=c.isPlainObject(this.settings)&&c.isPlainObject(this.settings.experience)?Breinify.UTL.isNonEmptyString(this.settings.experience.resolutionStrategyMultiple):null)?e.noShow.push(this.uuid):"FIRST_EXPIRING_ONLY"===t?null===(t=(t=this.getEndTime())<=this.now()?null:t)?e.noShow.push(this.uuid):e.weighted[this.uuid]=t:e.show.push(this.uuid))}render(){!1!==this._ensureConnected()&&(this._applyStyle(),this._applyHtml(),this._applyContent(),"CAMPAIGN_BASED"===this.settings.type||"ONE_TIME"===this.settings.type?this.startCounter():this._hideCountdown())}startCounter(){let t=this;!1===this._updateCountdown(!0)?t._hideCountdown(!1):this.interval=new e(()=>{t._updateCountdown(!1)||(t.interval.stop(),t._hideCountdown(!0))}).start()}getStartTime(){return Breinify.UTL.toInteger(this.settings.experience.startTime)}getEndTime(){return Breinify.UTL.toInteger(this.settings.experience.endTime)}now(){return Math.floor(Date.now()/1e3)}_showCountdown(t){this._updateStatus("rendering","visible",{fadeIn:!0===t})}_hideCountdown(t){this._updateStatus("rendering","hidden",{fadeOut:!0===t})}_updateCountdown(t){var e=this.$shadowRoot.find(".countdown-banner"),i=this.now(),n=this.getStartTime();if(null===n||i<n)this._hideCountdown();else{var n=Math.max(0,this.settings.experience.endTime-i),i=Math.floor(n)%60,s=Math.floor(n/60)%60,o=Math.floor(n/3600)%24,n=Math.floor(n/86400);if(this.$shadowRoot.find(".time-days").text(this._pad(n)),this.$shadowRoot.find(".time-hours").text(this._pad(o)),this.$shadowRoot.find(".time-minutes").text(this._pad(s)),this.$shadowRoot.find(".time-seconds").text(this._pad(i)),i<=0&&s<=0&&o<=0&&n<=0)return!1;e.is(":visible")||(!0===t?this._showCountdown(!1):this._showCountdown(!0))}return!0}_applyStyle(){0===this.$shadowRoot.find("#br-style-countdown-default").length&&this.$shadowRoot.prepend('<style id="br-style-countdown-default">:host { --unit-height: 60px; --color-background: #1d273b; --color-foreground: #f2f2f2; --color-separator: rgba(255, 255, 255, 0.3); }.countdown-banner { display: none; text-decoration: none; user-select: none; background-color: var(--color-background); color: var(--color-foreground); text-align: center; padding: 10px 0; }.countdown-title { font-size: calc(var(--unit-height) * 0.25); letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase }.countdown-timer { display: flex; justify-content: center; align-items: stretch; gap: 12px; height: var(--unit-height); }.countdown-disclaimer { padding: calc(var(--unit-height) * 0.1) 0 0 0; font-size: calc(var(--unit-height) * 0.18); }.time-block { position: relative; flex: 0 0 auto; aspect-ratio: 1.5 / 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: transparent; }.time-value { font-size: calc(var(--unit-height) * 0.6); font-weight: bold; line-height: 1; }.time-label { font-size: calc(var(--unit-height) * 0.18); margin-top: 3px; text-transform: uppercase; }.separator { width: 1px; background-color: var(--color-separator); height: 70%; align-self: center; }@media (max-width: 500px) { :host { --unit-height: 40px !important; } }</style>'),this.$shadowRoot.find("#br-style-countdown-configured").remove();var t=c.isPlainObject(this.settings.style)&&c.isArray(this.settings.style.selectors)?this.settings.style.selectors:[],t=Breinify.UTL.isNonEmptyString(t.filter(t=>c.isPlainObject(t)).map(t=>Object.entries(t).map(([t,e])=>t+` { ${e} }`).join("")).join(""));let e="#br-style-countdown-default";null!==t&&(this.$shadowRoot.find("#br-style-countdown-default").after('<style id="br-style-countdown-configured">'+t+"</style>"),e="#br-style-countdown-configured");t=c.isPlainObject(this.settings.style)?Breinify.UTL.isNonEmptyString(this.settings.style.snippet):null;if(null!==t&&Breinify.plugins._isAdded("snippetManager")){t=Breinify.UTL.isNonEmptyString(Breinify.plugins.snippetManager.getSnippet(t));if(null!==t)try{this.$shadowRoot.find(e).after(c(t))}catch(t){}}}_applyHtml(){this.$shadowRoot.find(".countdown-banner").remove();var t,e=Breinify.UTL.isNonEmptyString(this.settings.experience.url),i='<a-or-div style="display:none" class="countdown-banner">  <div class="countdown-title"></div>  <div class="countdown-timer">    <div class="time-block">      <div class="time-value time-days">00</div><div class="time-label">Days</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-hours">00</div><div class="time-label">Hours</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-minutes">00</div><div class="time-label">Minutes</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-seconds">00</div><div class="time-label">Seconds</div>    </div>  </div>  <div class="countdown-disclaimer"></div></a-or-div>'.replaceAll("a-or-div",null===e?"div":"a");this.$shadowRoot.append(i),null!==e&&((i=this.$shadowRoot.find(".countdown-banner")).attr("href",e),t=null===(e=Breinify.UTL.isNonEmptyString(i.attr("href")))?null:new URL(e,window.location.href),e=null!==e&&t.hostname!==window.location.hostname,t=window.self!==window.top,(e||t)&&i.attr("target","_blank"),i.click(t=>this._sendActivity("clickedElement",t)))}_applyContent(){var t=Breinify.UTL.isNonEmptyString(this.settings.experience.message),e=this.$shadowRoot.find(".countdown-title"),e=(null===t?e.hide():e.text(t).show(),Breinify.UTL.isNonEmptyString(this.settings.experience.disclaimer)),t=this.$shadowRoot.find(".countdown-disclaimer");null==e?t.hide():t.text(e).show()}_applyCampaignBasedSettings(t,i){let n=this;this.settings=c.extend(!0,{experience:{}},t);var e,t=Breinify.UTL.loc.param("br-msid");null===t?!1===this._retrieveCampaignBasedSettings(i)&&this._updateStatus("ignored","missing-msid"):null===(e=Breinify.UTL.isNonEmptyString(this.settings.experience.accessToken))?i(new Error("the needed accessToken is missing"),null):Breinify.UTL.internal.token(e,{msid:t},function(t,e){null!==t?i(t,!1):n._checkCampaignBasedResponse(e)?i(null,n.settings):!0!==n._retrieveCampaignBasedSettings(i)&&n._updateStatus("ignored","invalid-msid")},3e4)}_retrieveCampaignBasedSettings(e){var i=this._getStorageKey();try{let t=null;var n=Breinify.UTL.isNonEmptyString(window.sessionStorage.getItem(i)),s=(null!==n&&(t=JSON.parse(n)),Breinify.UTL.isNonEmptyString(window.localStorage.getItem(i)));return null!==s&&(t=JSON.parse(s),t=(t=c.isPlainObject(t)?t:{}).time+t.ttl<Date.now()?(window.localStorage.removeItem(i),null):(!0===t.renew&&window.localStorage.setItem(i,JSON.stringify({time:Date.now(),ttl:t.ttl,renew:!0,response:t.response})),t.response)),!!this._checkCampaignBasedResponse(t)&&(e(null,this.settings),!0)}catch(t){return!1}}_storeCampaignBasedSettings(t){var e,i=this._getStorageKey(),n=Breinify.UTL.isNonEmptyString(this.settings.experience.displayWindowDuration);("ONE_TIME_VISIBILITY"===n?(window.sessionStorage.removeItem(i),window.localStorage):"TIME_LIMITED_VISIBILITY"===n?(e=Breinify.UTL.toInteger(this.settings.experience.displayWindowValue),window.localStorage.setItem(i,JSON.stringify({time:Date.now(),ttl:1e3*e,renew:!1,response:t})),window.sessionStorage):"PER_TAB_SESSION_VISIBILITY"===n?(window.sessionStorage.setItem(i,JSON.stringify(t)),window.localStorage):(window.localStorage.setItem(i,JSON.stringify({time:Date.now(),ttl:18e5,renew:!1,response:t})),window.sessionStorage)).removeItem(i)}_getStorageKey(){return"br-wed-"+this.settings.webExId}_applyOneTimeSettings(t,e){this.settings=c.extend(!0,{experience:{}},t),e(null,this.settings)}_applyUnknownSettings(t,e){this.settings=c.extend(!0,{experience:{}},t,{type:"UNKNOWN"}),e(null,this.settings)}_pad(t){return String(t).padStart(2,"0")}_ensureConnected(){return!0===this.isConnected||Breinify.plugins.webExperiences.attach(this.settings,c(this))}_checkCampaignBasedResponse(t){if(!c.isPlainObject(t))return!1;var e=t["com.brein.common.microservice.data.CampaignData"],e=c.isArray(e)&&0<e.length?e[0]:null,i=t["com.brein.common.microservice.data.PromotionsData"],i=c.isArray(i)&&0<i.length?i[0]:null,n=t["com.brein.common.microservice.data.WebExperienceData"],n=c.isArray(n)&&0<n.length?n[0]:{};if(!c.isPlainObject(e)||!c.isPlainObject(i))return!1;var e=Breinify.UTL.isNonEmptyString(e.campaignType),s=c.isArray(this.settings.experience.campaignTypes)?this.settings.experience.campaignTypes:null;if(null!==s&&-1===c.inArray(e,s))return!1;e=Breinify.UTL.isNonEmptyString(n.webExperienceId);if(null!==e&&this.settings.webExId!==e)return!1;this.settings.experience=c.extend(!0,{},this.settings.experience,i,n.experience);s=c.isPlainObject(this.settings.style)&&c.isArray(this.settings.style.selectors),e=c.isPlainObject(n.style)&&c.isArray(n.style.selectors);return s&&e?this.settings.style.selectors=this.settings.style.selectors.concat(n.style.selectors):e?(c.isPlainObject(this.settings.style)?delete this.settings.style.selectors:this.settings.style={},this.settings.style=c.extend(!0,{},this.settings.style,n.style)):s||(this.settings.style=null),this._storeCampaignBasedSettings(t),!0}_sendActivity(t,e){var i,n={widgetType:"countdown"};n.widget=Breinify.UTL.isNonEmptyString(this.settings.campaignName);let s;"clickedElement"===t?(n.actionType="link",n.action="open url",i=this.$shadowRoot.find("a"),n.elementType=o+" (a)",n.description=Breinify.UTL.isNonEmptyString(i.attr("href")),i=Breinify.UTL.isNonEmptyString(i.attr("target")),s=!("_blank"===i||"new"===i)&&!(e.metaKey||e.ctrlKey||2===e.which)):"renderedElement"===t&&(n.actionType="rendered",n.action="show countdown",n.elementType=o,s=!1),n.campaignWebExId=Breinify.UTL.isNonEmptyString(this.settings.webExVersionId),n.message=Breinify.UTL.isNonEmptyString(this.settings.experience.message),c.isPlainObject(this.settings.splitTestData)&&(n.groupType=!0===this.settings.splitTestData.isControl?"control":"test",n.group=Breinify.UTL.isNonEmptyString(this.settings.splitTestData.groupDecision),i=Breinify.UTL.isNonEmptyString(this.settings.splitTestData.testName),e=Breinify.UTL.isNonEmptyString(this.settings.splitTestData.selectedInstance),n.splitTest=null===i?null:i+(null===e?"":" ("+e+")")),!0===s?Breinify.plugins.activities.scheduleDelayedActivity({},t,n,6e4):Breinify.plugins.activities.generic(t,{},n)}}Breinify.plugins._add("uiCountdown",{register:function(){window.customElements.get(o)||window.customElements.define(o,t)}})}})();
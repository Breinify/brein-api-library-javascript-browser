(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiCountdown")){let d=Breinify.UTL._jquery(),n={countdownById:{},update:function(t,i,e,n){if(null!==Breinify.UTL.isNonEmptyString(t.uuid)){var s=this.countdownById[t.uuid],s=d.isPlainObject(s)?s:{};if(s.status!==i||s.value!==e){this.countdownById[t.uuid]={el:t,status:i,value:e,settings:d.isPlainObject(n)?n:{}};var o,a={noShow:[],renderVisible:[],renderHidden:[]};for(o of Object.values(this.countdownById)){if("initializing"===o.status)return;("rendering"!==o.status?a.noShow:"visible"===o.value?a.renderVisible:"hidden"===o.value?a.renderHidden:a.noShow).push(o.uuid)}var r,l={};for(r of Object.values(this.countdownById))r.el.evaluateResolutionStrategy(a,l,r.settings)}}}};class i{constructor(t){this.callback=d.isFunction(t)?t:()=>null,this.timerId=null,this.stopped=!0}start(){if(!1!==this.stopped){this.stopped=!1;let t=()=>{!0!==this.stopped&&(this.timerId=window.setTimeout(()=>{!0!==this.stopped&&(this.callback(),t())},1e3-Date.now()%1e3))};t()}return this}stop(){this.stopped=!0,null!==this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)}}class t extends HTMLElement{$shadowRoot=null;settings=null;uuid=null;constructor(){super(),this.uuid=Breinify.UTL.uuid(),this.attachShadow({mode:"open"}),this.$shadowRoot=d(this.shadowRoot),this.settings={},this._updateStatus("initializing","constructed")}config(t,i,e){let n=this;e=d.isFunction(e)?e:()=>null;var s=Breinify.UTL.isNonEmptyString(t);null===s?e(new Error('the specified type "'+t+'" is invalid'),null):d.isPlainObject(i)?(t=function(t){window.queueMicrotask(()=>{null===t?e(null,n.settings):(n._updateStatus("failed","configuration"),e(t,null))})},this._updateStatus("initializing","configuration"),"CAMPAIGN_BASED"===s?this._applyCampaignBasedSettings(i,t):"ONE_TIME"===s?this._applyOneTimeSettings(i,t):this._applyUnknownSettings(i,t)):e(new Error("settings must be a valid object"),null)}_updateStatus(t,i,e){n.update(this,t,i,e)}evaluateResolutionStrategy(t,i,e){console.log("settings",this.settings),console.log("status-overall-info",t),console.log("status-settings",e),console.log("context",i);d.isPlainObject(this.settings)&&d.isPlainObject(this.settings.experience)&&Breinify.UTL.isNonEmptyString(this.settings.experience.resolutionStrategyMultiple)}render(){!1!==this._ensureConnected()&&(this._applyStyle(),this._applyHtml(),this._applyContent(),"CAMPAIGN_BASED"===this.settings.type||"ONE_TIME"===this.settings.type?this.startCounter():this._hideCountdown())}startCounter(){let t=this;!1!==this._updateCountdown(!0)&&(this.interval=new i(()=>{t._updateCountdown(!1)||(t.interval.stop(),t.$shadowRoot.find(".countdown-banner").fadeOut())}).start())}getStartTime(){return Breinify.UTL.toInteger(this.settings.experience.startTime)}getEndTime(){return Breinify.UTL.toInteger(this.settings.experience.endTime)}now(){return Math.floor(Date.now()/1e3)}_showCountdown(t){this._updateStatus("rendering","visible",{fadeIn:!0===t})}_hideCountdown(){this._updateStatus("rendering","hidden")}_updateCountdown(t){var i=this.$shadowRoot.find(".countdown-banner"),e=this.now(),n=this.getStartTime();if(null===n||e<n)this._hideCountdown();else{var n=Math.max(0,this.settings.experience.endTime-e),e=Math.floor(n)%60,s=Math.floor(n/60)%60,o=Math.floor(n/3600)%24,n=Math.floor(n/86400);if(this.$shadowRoot.find(".time-days").text(this._pad(n)),this.$shadowRoot.find(".time-hours").text(this._pad(o)),this.$shadowRoot.find(".time-minutes").text(this._pad(s)),this.$shadowRoot.find(".time-seconds").text(this._pad(e)),e<=0&&s<=0&&o<=0&&n<=0)return!1;i.is(":visible")||(!0===t?this._showCountdown(!1):this._showCountdown(!0))}return!0}_applyStyle(){0===this.$shadowRoot.find("#br-style-countdown-default").length&&this.$shadowRoot.prepend('<style id="br-style-countdown-default">:host { --unit-height: 60px; --color-background: #1d273b; --color-foreground: #f2f2f2; --color-separator: rgba(255, 255, 255, 0.3); }.countdown-banner { display: none; text-decoration: none; user-select: none; background-color: var(--color-background); color: var(--color-foreground); text-align: center; padding: 10px 0; }.countdown-title { font-size: calc(var(--unit-height) * 0.25); letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase }.countdown-timer { display: flex; justify-content: center; align-items: stretch; gap: 12px; height: var(--unit-height); }.countdown-disclaimer { padding: calc(var(--unit-height) * 0.1) 0; font-size: calc(var(--unit-height) * 0.18); }.time-block { position: relative; flex: 0 0 auto; aspect-ratio: 1.5 / 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: transparent; }.time-value { font-size: calc(var(--unit-height) * 0.6); font-weight: bold; line-height: 1; }.time-label { font-size: calc(var(--unit-height) * 0.18); margin-top: 3px; text-transform: uppercase; }.separator { width: 1px; background-color: var(--color-separator); height: 70%; align-self: center; }@media (max-width: 500px) { :host { --unit-height: 40px !important; } }</style>'),this.$shadowRoot.find("#br-style-countdown-configured").remove();var t=d.isPlainObject(this.settings.style)&&d.isArray(this.settings.style.selectors)?this.settings.style.selectors:[],t=Breinify.UTL.isNonEmptyString(t.filter(t=>d.isPlainObject(t)).map(t=>Object.entries(t).map(([t,i])=>t+` { ${i} }`).join("")).join(""));null!==t&&this.$shadowRoot.find("#br-style-countdown-default").after('<style id="br-style-countdown-configured">'+t+"</style>")}_applyHtml(){this.$shadowRoot.find(".countdown-banner").remove();var t=Breinify.UTL.isNonEmptyString(this.settings.experience.url),i='<a-or-div style="display:none" class="countdown-banner">  <div class="countdown-title"></div>  <div class="countdown-timer">    <div class="time-block">      <div class="time-value time-days">00</div><div class="time-label">Days</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-hours">00</div><div class="time-label">Hours</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-minutes">00</div><div class="time-label">Minutes</div>    </div>    <div class="separator"></div>    <div class="time-block">      <div class="time-value time-seconds">00</div><div class="time-label">Seconds</div>    </div>  </div>  <div class="countdown-disclaimer"></div></a-or-div>'.replaceAll("a-or-div",null===t?"div":"a");this.$shadowRoot.append(i),null!==t&&this.$shadowRoot.find(".countdown-banner").attr("href",t)}_applyContent(){var t=Breinify.UTL.isNonEmptyString(this.settings.experience.message),i=this.$shadowRoot.find(".countdown-title"),i=(null===t?i.hide():i.text(t).show(),Breinify.UTL.isNonEmptyString(this.settings.experience.disclaimer)),t=this.$shadowRoot.find(".countdown-disclaimer");null==i?t.hide():t.text(i).show()}_applyCampaignBasedSettings(t,e){let n=this;var i=Breinify.UTL.loc.param("br-msid");null===i?this._updateStatus("ignored","missing-msid"):(this.settings=d.extend(!0,{experience:{},type:"CAMPAIGN_BASED"},t),null===(t=Breinify.UTL.isNonEmptyString(this.settings.experience.accessToken))?e(new Error("the needed accessToken is missing"),null):Breinify.UTL.internal.token(t,{msid:i},function(t,i){null!==t?e(t,!1):n._checkCampaignBasedResponse(i)?e(null,n.settings):n._updateStatus("ignored","invalid-msid")},3e4))}_applyOneTimeSettings(t,i){this.settings=d.extend(!0,{experience:{},type:"ONE_TIME"},t),i(null,this.settings)}_applyUnknownSettings(t,i){this.settings=d.extend(!0,{experience:{},type:"UNKNOWN"},t),i(null,this.settings)}_pad(t){return String(t).padStart(2,"0")}_ensureConnected(){if(!0===this.isConnected)return!0;var t=d.isPlainObject(this.settings.position)?this.settings.position:null;if(null==t)return!1;var i=Breinify.UTL.isNonEmptyString(t.operation);if(null===i)return!1;let e;var n=Breinify.UTL.isNonEmptyString(t.selector),t=Breinify.UTL.isNonEmptyString(t.snippet);return null===t&&null===n?e=null:null!==n?e=d(n):null!==t&&(e=null),Breinify.UTL.dom.attachByOperation(i,e,d(this))}_checkCampaignBasedResponse(t){var i,e;return!(!d.isPlainObject(t)||(i=t["com.brein.common.microservice.data.CampaignData"],i=d.isArray(i)&&0<i.length?i[0]:null,t=t["com.brein.common.microservice.data.PromotionsData"],t=d.isArray(t)&&0<t.length?t[0]:null,!d.isPlainObject(i))||!d.isPlainObject(t)||(i=Breinify.UTL.isNonEmptyString(i.campaignType),null!==(e=d.isArray(this.settings.experience.campaignTypes)?this.settings.experience.campaignTypes:null)&&-1===d.inArray(i,e))||(this.settings.experience=d.extend(!0,{},this.settings.experience,t),0))}}Breinify.plugins._add("uiCountdown",{register:function(){window.customElements.get("br-ui-countdown")||window.customElements.define("br-ui-countdown",t)}})}})();
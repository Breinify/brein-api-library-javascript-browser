(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("youtube")){let a=Breinify.UTL._jquery(),r={frequencyInMs:1e3,initialized:!1,type:null,videoIdToElementIdMapper:{},videoIdHandler:{},startedVideoIds:{},playTimelines:{},playObserver:{},init:function(){if(!0!==this.initialized){if("object"!=typeof YT||"function"!=typeof window.YT.Player)return!1;this.initialized=!0}return!0},resetVideoId:function(e){delete this.videoIdToElementIdMapper[e],delete this.videoIdHandler[e],delete this.startedVideoIds[e],delete this.playTimelines[e],delete this.playObserver[e]},stopTimelineRecording:function(e,t){var i=a.isArray(e)?e:[e],n={};for(let e=0;e<i.length;e++){var r=i[e],d=this.playObserver[r],d=(window.clearInterval(d),!0===t&&this.checkVideoStatus(r),this.getTimelineRecording(r));delete this.playTimelines[r],delete this.playObserver[r],a.isPlainObject(d)&&(n[r]=d)}return n},isTimelineRecorded:function(e){return a.isPlainObject(this.playTimelines[e])},startTimelineRecording:function(e){let i=this;var n=a.isArray(e)?e:[e],r=[];for(let t=0;t<n.length;t++){let e=n[t];a.isPlainObject(this.playTimelines[e])||(this.playTimelines[e]={timeline:[]},this.checkVideoStatus(e),this.playObserver[e]=setInterval(function(){i.checkVideoStatus(e)},this.frequencyInMs),r.push(e))}return r},getTimelineRecording:function(e){e=this.playTimelines[e];return a.isPlainObject(e)?e:null},checkVideoStatus:function(e){var t,i,n,r=this.getPlayerByVideoId(e);a.isFunction(r.getPlayerState)&&(i=r.getPlayerState())!==window.YT.PlayerState.UNSTARTED&&(t=(new Date).getTime(),n=this.playTimelines[e].video,n=a.isPlainObject(n)?n:{start:t,currentState:window.YT.PlayerState.UNSTARTED},i!==window.YT.PlayerState.ENDED||n.currentState!==window.YT.PlayerState.ENDED)&&(i=this.getVideoStats(r),this.playTimelines[e].timeline.push(i.percentage),this.playTimelines[e].video=a.extend(i,{start:n.start,lastUpdate:t}))},getVideoStats:function(e){var t=e.getPlayerState();let i=e.getCurrentTime(),n=e.getDuration();n="number"==typeof n?n.toFixed(2):0,i="number"==typeof i?i.toFixed(2):0;var r=0===n?0:Math.min(1,(i/n).toFixed(4));return{videoId:this.getVideoIdByPlayer(e),currentState:t,currentDuration:i,totalDuration:n,frequencyInMs:this.frequencyInMs,percentage:r,finished:1===r}},youTubeEventHandler:function(t){var i=this.getVideoIdByPlayer(t.target);if(null!==i){var n=this.getElementByVideoId(i);if(null!==n){var r=this.videoIdHandler[i];if(a.isArray(r)){let e=this.startedVideoIds[i];"boolean"!=typeof e&&(e=t.data===window.YT.PlayerState.PLAYING&&!(this.startedVideoIds[i]=!1));var d=a.extend(this.getVideoStats(t.target),{firstStart:e});for(let e=0;e<r.length;e++)r[e](i,n,t,d)}}}},bindYouTubeObserver:function(e,t){let i=this;var n,r;return!a.isFunction(t)||"string"!=typeof(e=e.attr("id"))||""===e.trim()||(n=window.YT.get(e),null===(r=this.getVideoIdByPlayer(n)))?null:("string"==typeof this.videoIdToElementIdMapper[r]?this.videoIdHandler[r].push(t):(this.videoIdHandler[r]=[t],this.videoIdToElementIdMapper[r]=e,n.addEventListener("onStateChange",function(e){i.youTubeEventHandler(e)})),r)},getElementByVideoId:function(e){return"string"==typeof e&&(e=this.videoIdToElementIdMapper[e],1===(e=a("#"+e)).length)?e:null},getPlayerByVideoId:function(e){var e=this.getElementByVideoId(e).attr("id");return"string"==typeof e&&""!==e.trim()&&"object"==typeof(e=window.YT.get(e))?e:null},getVideoIdByElement:function(e){var e=e.attr("id");return"string"==typeof e&&""!==e.trim()&&"object"==typeof(e=window.YT.get(e))?this.getVideoIdByPlayer(e):null},getVideoIdByPlayer:function(e){return"object"==typeof e&&a.isFunction(e.getVideoData)&&(e=e.getVideoData(),"string"==typeof(e=a.isPlainObject(e)?e.video_id:null))?e:null}};Breinify.plugins._add("youtube",{init:function(){return r.init()},resetVideoId:function(e){r.resetVideoId(e)},isTimelineRecorded:function(e){return r.isTimelineRecorded(e)},isPlaying:function(e){return e.data===window.YT.PlayerState.PLAYING},isHalted:function(e){return e.data===window.YT.PlayerState.BUFFERING||e.data===window.YT.PlayerState.CUED||e.data===window.YT.PlayerState.PAUSED||e.data===window.YT.PlayerState.UNSTARTED},isEnded:function(e){return e.data===window.YT.PlayerState.ENDED},isInitialized:function(){return r.initialized},startTimelineRecording:function(e){return r.startTimelineRecording(e)},stopTimelineRecording:function(e,t){return r.stopTimelineRecording(e,t)},getTimelineRecording:function(e){return r.getTimelineRecording(e)},getVideoIdByElement:function(e){return r.getVideoIdByElement(e)},isObservable:function(e,n){let r=this;e.each(function(e){let t=a(this);var i=r.getVideoIdByElement(t);null===i?setTimeout(function(){r.isObservable(t,n)},50):n(t,i)})},observeElements:function(e,i){let n=[];return this.init()&&e.each(function(e){var t=r.bindYouTubeObserver(a(this),i);null!==t&&n.push(t)}),n}})}})();
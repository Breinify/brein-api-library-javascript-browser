(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiSurvey")){let n="br-ui-survey",o="br-ui-survey-popup",c=Breinify.UTL._jquery();class a extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._renderBase()}_renderBase(){0<this.shadowRoot.childNodes.length||(this.shadowRoot.innerHTML=`
                <style>
                    /* -------------------------------------------------- */
                    /* Popup chrome (backdrop, dialog)                    */
                    /* -------------------------------------------------- */
                    :host {
                        display: none;
                        position: fixed;
                        inset: 0;
                        z-index: 2147483647; /* very high to be above most things */
                        font-family: inherit;
                    }

                    :host([open]) { display: block; }

                    .br-popup-backdrop {
                        position: fixed;
                        inset: 0;
                        background: rgba(0, 0, 0, 0.45);
                    }

                    .br-popup-outer {
                        position: fixed;
                        inset: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        pointer-events: none;
                    }

                    .br-popup-dialog {
                        pointer-events: auto;
                        max-width: 520px;
                        width: calc(100% - 2rem);
                        max-height: calc(100% - 4rem);
                        background: #fff;
                        border-radius: 12px;
                        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    }

                    .br-popup-header {
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        padding: 0.5rem 0.75rem;
                        border-bottom: 1px solid #eee;
                    }
                    
                    .br-popup-footer {
                        padding: 0.75rem 1rem;
                        border-top: 1px solid #eee;
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        gap: 0.5rem;
                    }

                    .br-popup-close {
                        border: none;
                        background: transparent;
                        cursor: pointer;
                        font-size: 1.25rem;
                        line-height: 1;
                        padding: 0.25rem 0.5rem;
                    }

                    .br-popup-body {
                        padding: 1rem 1.25rem 1.25rem;
                        overflow: auto;
                    }

                    .br-popup-placeholder {
                        font-size: 0.95rem;
                        color: #666;
                        text-align: center;
                    }
                    
                    @media (max-width: 640px) {
                        .br-popup-outer { align-items: stretch; }
                    
                        .br-popup-dialog {
                            width: 100%;
                            max-width: 100%;
                            height: 100%;
                            max-height: 100%;
                            border-radius: 0;
                            box-shadow: none;
                        }
                    
                        .br-popup-body { flex: 1 1 auto; overflow: auto; }
                    }

                    ${this._ensurePageStyle()}
                </style>

                <div class="br-popup-backdrop" part="backdrop"></div>
                <div class="br-popup-outer">
                    <div class="br-popup-dialog" role="dialog" aria-modal="true">
                        <div class="br-popup-header">
                            <button type="button" class="br-popup-close" aria-label="Close survey">
                                &times;
                            </button>
                        </div>
                        <div class="br-popup-body">
                            <div class="br-popup-placeholder">
                                Survey content will appear hereâ€¦
                            </div>
                        </div>
                        <div class="br-popup-footer">
                            <!-- Navigation and CTA controls will go here -->
                        </div>
                    </div>
                </div>
            `,this._bindBaseEvents())}_ensurePageStyle(){return`
                :host { --br-survey-answer-aspect-ratio: 1 / 1; }

                /* -------------------------------------------------- */
                /* Question page + answers                            */
                /* -------------------------------------------------- */
                .br-survey-page--question {
                    display: flex;
                    flex-direction: column;
                    gap: 1rem;
                }

                .br-survey-question-title {
                    font-size: 1.15rem;
                    font-weight: 600;
                    margin: 0 0 0.5rem;
                }

                .br-survey-answers {
                    display: flex;
                    flex-direction: column;
                    gap: 0.75rem;
                    margin-top: 0.25rem;
                }

                .br-survey-answer {
                    text-align: left;
                    width: 100%;
                    border-radius: 0.9rem;
                    border: 1px solid #e1e1e1;
                    padding: 0.85rem 1rem;
                    background: #ffffff;
                    cursor: pointer;
                    font: inherit;
                    display: flex;
                    align-items: flex-start;
                    gap: 1rem;
                    min-height: 80px;
                    appearance: none;
                    -webkit-appearance: none;
                    transition:
                        background 0.15s ease,
                        border-color 0.15s ease,
                        box-shadow 0.15s ease,
                        transform 0.15s ease;
                }

                .br-survey-answer:hover {
                    border-color: #d0d0d0;
                    background: #fdfdfd;
                    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
                    transform: translateY(-1px);
                }

                .br-survey-answer--selected {
                    border-color: #333;
                    background: #f5f5f5;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                }

                .br-survey-answer:focus-visible {
                    outline: 2px solid #333;
                    outline-offset: 2px;
                }

                .br-survey-answer__title {
                    font-weight: 600;
                    font-size: 1rem;
                    margin: 0;
                    line-height: 1.25;
                }

                /* add spacing only when a description exists */
                .br-survey-answer--has-description .br-survey-answer__title {
                    margin-bottom: 0.2rem;
                }

                .br-survey-answer__description {
                    font-size: 0.85em;
                    color: #666;
                }

                .br-survey-answer__media {
                    flex: 0 0 80px;
                    max-width: 80px;
                    border-radius: 0.7rem;
                    overflow: hidden;
                    background: #f0f0f0;
                    aspect-ratio: var(--br-survey-answer-aspect-ratio, 1 / 1);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .br-survey-answer__media img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: block;
                }

                .br-survey-answer__content {
                    flex: 1 1 auto;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }

                /* title-only answers (no image, no description) */
                .br-survey-answer--simple {
                    align-items: center;
                    min-height: 56px;
                    padding-top: 0.7rem;
                    padding-bottom: 0.7rem;
                }
            `}_bindBaseEvents(){var e=this.shadowRoot.querySelector(".br-popup-backdrop"),t=this.shadowRoot.querySelector(".br-popup-close");e&&e.addEventListener("click",()=>this.close()),t&&t.addEventListener("click",()=>this.close())}open(){this.hasAttribute("open")||this.setAttribute("open","");var e=this.shadowRoot.querySelector(".br-popup-dialog");e&&"function"==typeof e.focus&&(e.setAttribute("tabindex","-1"),e.focus())}close(){this.hasAttribute("open")&&this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("br-ui-survey:popup-closed",{bubbles:!0,cancelable:!1}))}setBodyContent(e){var t=this.shadowRoot.querySelector(".br-popup-body");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}setFooterContent(e){var t=this.shadowRoot.querySelector(".br-popup-footer");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}}class d extends HTMLElement{$shadowRoot=null;settings=null;uuid=null;constructor(){super(),this.attachShadow({mode:"open"}),this.uuid=null,this.$shadowRoot=c(this.shadowRoot),this.settings={},this._selectedAnswers={},this._nodesById={},this._edges=[],this._currentNodeId=null}_ensureBaseStyle(){var e="br-ui-survey-style";0<this.$shadowRoot.find("#"+e).length||this.$shadowRoot.append(c(`<style id="${e}">
                :host {
                    display: block;
                    box-sizing: border-box;
                    font-family: inherit;
                    color: inherit;
                }

                *, *::before, *::after { box-sizing: border-box; }

                .br-survey-root { width: 100%; }
                .br-survey-container { width: 100%; }
                .br-survey-hidden { display: none !important; }

                /* -------------------------------------------------- */
                /* Trigger banner styling (desktop + mobile)          */
                /* -------------------------------------------------- */
                .br-survey-trigger {
                    display: inline-block;
                    cursor: pointer;
                    width: 100%;
                }

                .br-survey-trigger-image { width: 100%; height: auto; border: 0; }
                .br-survey-trigger-image.br-survey-trigger-desktop { display: block; }
                .br-survey-trigger-image.br-survey-trigger-mobile { display: none; }

                @media (max-width: 600px) {
                    .br-survey-trigger-image.br-survey-trigger-desktop { display: none; }
                    .br-survey-trigger-image.br-survey-trigger-mobile { display: block; }
                }
            </style>`))}_createTrigger(){var e=this.settings&&this.settings.trigger||{},t=e.bannerUrl,e=e.mobileBannerUrl||t,r=c("<div/>",{class:"br-survey-trigger",role:"button",tabindex:0,"aria-label":"Start survey"});return t&&r.append(c(`<img src="${t}" class="br-survey-trigger-image br-survey-trigger-desktop" alt="Start survey"/>`)),e&&r.append(c(`<img src="${e}" class="br-survey-trigger-image br-survey-trigger-mobile" alt="Start survey"/>`)),r.on("click",e=>{e.preventDefault(),this._openSurvey()}),r}_openSurvey(){let e=document.querySelector(o);e||(e=document.createElement(o),document.body.appendChild(e)),null===this._currentNodeId&&(this._currentNodeId=this._findFirstNodeId()),this._renderCurrentPage(e),e.open(),console.log("Survey trigger clicked:",this.uuid,"currentNodeId:",this._currentNodeId)}_renderCurrentPage(t){if(t&&"function"==typeof t.setBodyContent){var r=Breinify.UTL.isNonEmptyString(this._currentNodeId),r=null!==r&&this._nodesById?this._nodesById[r]:null;let e;e=c.isPlainObject(r)?"question"===r.type?this._createQuestionPage(r):((r=document.createElement("div")).className="br-survey-page br-survey-page--unsupported",r.textContent="This step type is not yet supported.",r):((r=document.createElement("div")).className="br-survey-page br-survey-page--error",r.textContent="The survey is not correctly configured.",r),t.setBodyContent(e),"function"==typeof t.setFooterContent&&t.setFooterContent(null)}}_createQuestionPage(e){var t=c.isPlainObject(e.data)?e.data:{},r=Breinify.UTL.isNonEmptyString(t.question)||"",t=Array.isArray(t.answers)?t.answers:[];let l=Breinify.UTL.isNonEmptyString(e.id),u=null!==l&&this._selectedAnswers?this._selectedAnswers[l]:null,p=document.createElement("div");p.className="br-survey-page br-survey-page--question";e=document.createElement("h2");if(e.className="br-survey-question-title",e.textContent=r,p.appendChild(e),0<t.length){let d=document.createElement("div");d.className="br-survey-answers",t.forEach(r=>{if(c.isPlainObject(r)){let e=Breinify.UTL.isNonEmptyString(r._id);var s=Breinify.UTL.isNonEmptyString(r.title)||"",i=Breinify.UTL.isNonEmptyString(r.description),r=Breinify.UTL.isNonEmptyString(r.resourceUrl),n=null!==r,o=null!==i;let t=document.createElement("button");t.type="button",t.className="br-survey-answer",n||o||t.classList.add("br-survey-answer--simple"),o&&t.classList.add("br-survey-answer--has-description"),null!==e&&null!==u&&e===u&&t.classList.add("br-survey-answer--selected"),n&&((n=document.createElement("div")).className="br-survey-answer__media",(a=document.createElement("img")).src=r,a.alt=s||"",n.appendChild(a),t.appendChild(n));var r=document.createElement("div"),a=(r.className="br-survey-answer__content",document.createElement("div"));a.className="br-survey-answer__title",a.textContent=s,r.appendChild(a),o&&((n=document.createElement("div")).className="br-survey-answer__description",n.textContent=i,r.appendChild(n)),t.appendChild(r),t.addEventListener("click",()=>{this._handleAnswerClick(l,e,p,t)}),d.appendChild(t)}}),p.appendChild(d)}return p}_handleAnswerClick(e,t,r,s){null!==e&&null!==t&&(c.isPlainObject(this._selectedAnswers)||(this._selectedAnswers={}),this._selectedAnswers[e]=t,r)&&r.querySelectorAll&&r.querySelectorAll(".br-survey-answer").forEach(e=>{e===s?e.classList.add("br-survey-answer--selected"):e.classList.remove("br-survey-answer--selected")})}_findFirstNodeId(){if(!(c.isPlainObject(this.settings)&&c.isPlainObject(this.settings.survey)&&Array.isArray(this.settings.survey.nodes)&&Array.isArray(this._edges)))return null;var e=this.settings.survey.nodes.find(e=>c.isPlainObject(e)&&"start"===e.type);if(!c.isPlainObject(e))return null;let t=Breinify.UTL.isNonEmptyString(e.id);return null!==t&&(e=this._edges.find(e=>c.isPlainObject(e)&&e.source===t),c.isPlainObject(e))?Breinify.UTL.isNonEmptyString(e.target):null}_loadStructureFromSettings(){this._nodesById={},this._edges=[],this._currentNodeId=null,this._selectedAnswers={},c.isPlainObject(this.settings)&&c.isPlainObject(this.settings.survey)&&(Array.isArray(this.settings.survey.nodes)&&this.settings.survey.nodes.forEach(e=>{e&&e.id&&(this._nodesById[e.id]=e)}),Array.isArray(this.settings.survey.edges))&&(this._edges=this.settings.survey.edges.slice())}render(e,t){this.settings=t,this.uuid=e,this.$shadowRoot.empty(),this._ensureBaseStyle(),this._loadStructureFromSettings(),Breinify.plugins.webExperiences.style(this.settings,this.$shadowRoot);var t=c('<div class="br-survey-root"></div>'),r=this._createTrigger();t.append(r),this.$shadowRoot.append(t),console.log(e),console.log(this.settings),console.log(JSON.stringify(this.settings))}}Breinify.plugins._add("uiSurvey",{register:function(e,t,r){window.customElements.get(o)||window.customElements.define(o,a),window.customElements.get(n)||window.customElements.define(n,d);var s="br-survey-"+t;let i=c("#"+s);0===i.length&&(i=c("<"+n+"/>").attr("id",s),!1===Breinify.plugins.webExperiences.attach(r,i))||i.get(0).render(t,r)}})}})();
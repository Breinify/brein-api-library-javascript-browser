(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiSurvey")){let o="br-ui-survey",a="br-ui-survey-popup",h=Breinify.UTL._jquery();class l extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.closeOnBackgroundClick=!1,this.resetOnClose=!0,this._renderBase()}_renderBase(){0<this.shadowRoot.childNodes.length||(this.shadowRoot.innerHTML=`
                <style>
                    /* -------------------------------------------------- */
                    /* Popup chrome (backdrop, dialog)                    */
                    /* -------------------------------------------------- */
                    :host {
                        display: none;
                        position: fixed;
                        inset: 0;
                        z-index: 2147483647; /* very high to be above most things */
                        font-family: inherit;
                        /* base font-size for everything inside the popup */
                        --br-ui-base-font-size: 20px;
                        font-size: var(--br-ui-base-font-size);
                    }

                    :host([open]) { display: block; }

                    .br-popup-backdrop {
                        position: fixed;
                        inset: 0;
                        background: rgba(0, 0, 0, 0.45);
                    }

                    .br-popup-outer {
                        position: fixed;
                        inset: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        pointer-events: none;
                    }

                    .br-popup-dialog {
                        position: relative;
                        pointer-events: auto;
                        max-width: 520px;
                        width: calc(100% - 2rem);
                        max-height: calc(100% - 4rem);
                        background: #fff;
                        border-radius: 12px;
                        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    }

                    .br-popup-close {
                        position: absolute;
                        top: 0.5em;
                        right: 0.5em;
                        border: none;
                        background: transparent;
                        cursor: pointer;
                        font-size: 1.25em;
                        line-height: 1;
                        padding: 0.25em 0.5em;
                    }

                    .br-popup-body {
                        padding: 1em 1.25em 1.25em;
                        overflow: auto;
                    }

                    .br-popup-placeholder {
                        font-size: 0.95em;
                        color: #666;
                        text-align: center;
                    }

                    .br-popup-footer {
                        padding: 0.5em 1em;
                        border-top: 1px solid #eee;
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        gap: 0.5em;
                    }

                    @media (max-width: 640px) {
                        .br-popup-outer { align-items: stretch; }

                        .br-popup-dialog {
                            width: 100%;
                            max-width: 100%;
                            height: 100%;
                            max-height: 100%;
                            border-radius: 0;
                            box-shadow: none;
                        }

                        .br-popup-body { flex: 1 1 auto; overflow: auto; }
                    }

                    ${this._ensurePageStyle()}
                </style>

                <div class="br-popup-backdrop" part="backdrop"></div>
                <div class="br-popup-outer">
                    <div class="br-popup-dialog" role="dialog" aria-modal="true">
                        <button type="button" class="br-popup-close" aria-label="Close survey">
                            &times;
                        </button>
                        <div class="br-popup-body">
                            <div class="br-popup-placeholder">
                                Survey content will appear hereâ€¦
                            </div>
                        </div>
                        <div class="br-popup-footer">
                            <!-- Navigation and CTA controls will go here -->
                        </div>
                    </div>
                </div>
            `,this._bindBaseEvents())}_ensurePageStyle(){return`
                :host {
                    --br-survey-answer-aspect-ratio: 1 / 1;
                    --br-survey-line-height-base: 1.4;
                    --br-survey-line-height-tight: 1.2;
                }

                /* -------------------------------------------------- */
                /* Question page + answers                            */
                /* -------------------------------------------------- */
                .br-survey-page--question {
                    display: flex;
                    flex-direction: column;
                    gap: 1em;
                    line-height: var(--br-survey-line-height-base);
                }

                .br-survey-question-title {
                    font-size: 1.15em;
                    font-weight: 600;
                    margin: 0.75em 0 0.5em;
                    line-height: var(--br-survey-line-height-tight);
                }

                .br-survey-answers {
                    display: flex;
                    flex-direction: column;
                    gap: 0.75em;
                    margin-top: 0.25em;
                }

                .br-survey-answer {
                    text-align: left;
                    width: 100%;
                    border-radius: 0.9em;
                    border: 1px solid #e1e1e1;
                    padding: 0.85em 1em;
                    background: #ffffff;
                    cursor: pointer;
                    font: inherit;
                    display: flex;
                    align-items: center;
                    gap: 1em;
                    min-height: 4em;
                    appearance: none;
                    -webkit-appearance: none;
                    line-height: var(--br-survey-line-height-base);
                    transition: background 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
                }

                .br-survey-answer:hover {
                    border-color: #d0d0d0;
                    background: #fdfdfd;
                    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
                    transform: translateY(-1px);
                }

                .br-survey-answer--selected,
                .br-survey-answer--selected:hover {
                    border-color: #333;
                    background: #f5f5f5;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                }

                .br-survey-answer:focus-visible {
                    outline: 2px solid #333;
                    outline-offset: 2px;
                }

                .br-survey-answer__title {
                    font-weight: 600;
                    font-size: .9em;
                    margin: 0;
                    line-height: var(--br-survey-line-height-tight);
                }

                /* add spacing only when a description exists */
                .br-survey-answer--has-description .br-survey-answer__title {
                    margin-bottom: 0.2em;
                }
                
                /* reduce padding if an image exists */
                .br-survey-answer--has-image {
                    padding: 0.5em 1em 0.5em 0.5em;
                }

                .br-survey-answer__description {
                    font-size: 0.7em;
                    color: #666;
                    line-height: var(--br-survey-line-height-base);
                }

                .br-survey-answer__media {
                    flex: 0 0 4em;
                    max-width: 4em;
                    border-radius: 0.7em;
                    overflow: hidden;
                    background: #f0f0f0;
                    aspect-ratio: var(--br-survey-answer-aspect-ratio, 1 / 1);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .br-survey-answer__media img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: block;
                }

                .br-survey-answer__content {
                    flex: 1 1 auto;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }

                /* title-only answers (no image, no description) */
                .br-survey-answer--simple {
                    align-items: center;
                    min-height: 2.8em;
                    padding-top: 0.7em;
                    padding-bottom: 0.7em;
                }

                /* -------------------------------------------------- */
                /* Footer controls                                    */
                /* -------------------------------------------------- */
                .br-survey-footer-controls {
                    display: flex;
                    justify-content: flex-end;
                    align-items: center;
                    gap: 0.5em;
                    width: 100%;
                }

                .br-survey-footer-controls--with-hint {
                    justify-content: flex-end;
                }

                .br-survey-footer-controls--with-hint .br-survey-hint {
                    margin-right: auto; /* push buttons to the right, keep their own gap */
                }

                .br-survey-hint {
                    font-size: 0.55em;
                    color: #999;
                    line-height: var(--br-survey-line-height-tight);
                    max-width: 60%;
                    white-space: pre-line;
                    text-align: left;
                }

                .br-survey-btn {
                    padding: 0.45em 1em;
                    border-radius: 0.45em;
                    border: 1px solid #ccc;
                    background: #f7f7f7;
                    cursor: pointer;
                    font: inherit;
                    font-size: 0.75em;
                    line-height: var(--br-survey-line-height-tight);
                    transition: background 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
                }

                .br-survey-btn:hover {
                    background: #ffffff;
                    border-color: #999;
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
                    transform: translateY(-0.5px);
                }

                .br-survey-btn:focus-visible {
                    outline: 2px solid #333;
                    outline-offset: 2px;
                }

                .br-survey-btn--next {
                    background: #333;
                    color: #fff;
                    border-color: #333;
                }

                .br-survey-btn--next:hover {
                    background: #000;
                    border-color: #000;
                }

                .br-survey-btn--back {
                    background: transparent;
                    border-color: #bbb;
                }

                .br-survey-btn--back:hover {
                    background: #eee;
                }
                
                /* ensure popup body scrolls smoothly */
                .br-popup-body {
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }
            `}_bindBaseEvents(){var e=this.shadowRoot.querySelector(".br-popup-backdrop"),t=this.shadowRoot.querySelector(".br-popup-close");e&&e.addEventListener("click",()=>{window.innerWidth&&window.innerWidth<=640||this._shouldCloseOnBackgroundClick()&&this.close()}),t&&t.addEventListener("click",()=>this.close())}_shouldCloseOnBackgroundClick(){return"boolean"==typeof this.closeOnBackgroundClick&&this.closeOnBackgroundClick}open(){this.hasAttribute("open")||this.setAttribute("open",""),document.body.classList.add("br-survey-scroll-lock");var e=this.shadowRoot.querySelector(".br-popup-dialog");e&&"function"==typeof e.focus&&(e.setAttribute("tabindex","-1"),e.focus())}close(){this.hasAttribute("open")&&this.removeAttribute("open"),document.body.classList.remove("br-survey-scroll-lock"),this.dispatchEvent(new CustomEvent("br-ui-survey:popup-closed",{bubbles:!0,cancelable:!1}))}setBodyContent(e){var t=this.shadowRoot.querySelector(".br-popup-body");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}setFooterContent(e){var t=this.shadowRoot.querySelector(".br-popup-footer");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}}class d extends HTMLElement{$shadowRoot=null;settings=null;uuid=null;constructor(){super(),this.attachShadow({mode:"open"}),this.uuid=null,this.$shadowRoot=h(this.shadowRoot),this.settings={},this._selectedAnswers={},this._nodesById={},this._edges=[],this._currentNodeId=null,this._history=[],this._resetOnClose=!0}_ensureBaseStyle(){var e="br-ui-survey-style";0<this.$shadowRoot.find("#"+e).length||this.$shadowRoot.append(h(`<style id="${e}">
                :host {
                    display: block;
                    box-sizing: border-box;
                    font-family: inherit;
                    color: inherit;
                    /* allow integrator to override if needed */
                    --br-ui-base-font-size: 20px;
                    font-size: var(--br-ui-base-font-size);
                }

                *, *::before, *::after { box-sizing: border-box; }

                .br-survey-root { width: 100%; }
                .br-survey-container { width: 100%; }
                .br-survey-hidden { display: none !important; }

                /* -------------------------------------------------- */
                /* Trigger banner styling (desktop + mobile)          */
                /* -------------------------------------------------- */
                .br-survey-trigger {
                    display: inline-block;
                    cursor: pointer;
                    width: 100%;
                }

                .br-survey-trigger-image { width: 100%; height: auto; border: 0; }
                .br-survey-trigger-image.br-survey-trigger-desktop { display: block; }
                .br-survey-trigger-image.br-survey-trigger-mobile { display: none; }

                @media (max-width: 600px) {
                    .br-survey-trigger-image.br-survey-trigger-desktop { display: none; }
                    .br-survey-trigger-image.br-survey-trigger-mobile { display: block; }
                }
            </style>`))}_getCloseOnBackgroundClickSetting(){return!(!h.isPlainObject(this.settings)||!h.isPlainObject(this.settings.popup)||"boolean"!=typeof this.settings.popup.closeOnBackgroundClick)&&this.settings.popup.closeOnBackgroundClick}_getResetOnCloseSetting(){return!h.isPlainObject(this.settings)||!h.isPlainObject(this.settings.popup)||"boolean"!=typeof this.settings.popup.resetOnClose||this.settings.popup.resetOnClose}_resetSurveyState(){this._currentNodeId=null,this._selectedAnswers={},this._history=[]}_getPageNodes(){return h.isPlainObject(this.settings)&&h.isPlainObject(this.settings.survey)&&Array.isArray(this.settings.survey.nodes)?this.settings.survey.nodes.filter(function(e){return h.isPlainObject(e)&&"question"===e.type}):[]}_getTotalPageCount(){return this._getPageNodes().length}_getPageIndex(t){if(t){var r=this._getPageNodes();for(let e=0;e<r.length;e++){var s=r[e];if(h.isPlainObject(s)&&s.id===t)return e}}return-1}_getAnswerFromNode(e,t){if(h.isPlainObject(e)&&h.isPlainObject(e.data)&&Array.isArray(e.data.answers)&&t){var r=e.data.answers;for(let e=0;e<r.length;e++){var s=r[e];if(h.isPlainObject(s)&&s._id===t)return s}}return null}_fireRenderedEvent(){this.dispatchEvent(new CustomEvent("br-ui-survey:rendered",{bubbles:!0,cancelable:!1,detail:{webExId:this.uuid}}))}_fireOpenedEvent(){var e=Breinify.UTL.isNonEmptyString(this._currentNodeId),t=null!==e&&this._nodesById?this._nodesById[e]:null;this.dispatchEvent(new CustomEvent("br-ui-survey:opened",{bubbles:!0,cancelable:!1,detail:{webExId:this.uuid,nodeId:e,pageType:t&&t.type?t.type:null,pageIndex:this._getPageIndex(e),totalPages:this._getTotalPageCount()}}))}_fireAnswerSelectedEvent(e,t){var e=Breinify.UTL.isNonEmptyString(e),r=null!==e&&this._nodesById?this._nodesById[e]:null,s=this._getAnswerFromNode(r,t);this.dispatchEvent(new CustomEvent("br-ui-survey:answer-selected",{bubbles:!0,cancelable:!1,detail:{webExId:this.uuid,nodeId:e,pageType:r&&r.type?r.type:null,pageIndex:this._getPageIndex(e),totalPages:this._getTotalPageCount(),answerId:t,answer:s||null}}))}_createTrigger(){var e=this.settings&&this.settings.trigger||{},t=e.bannerUrl,e=e.mobileBannerUrl||t,r=h("<div/>",{class:"br-survey-trigger",role:"button",tabindex:0,"aria-label":"Start survey"});return t&&r.append(h(`<img src="${t}" class="br-survey-trigger-image br-survey-trigger-desktop" alt="Start survey"/>`)),e&&r.append(h(`<img src="${e}" class="br-survey-trigger-image br-survey-trigger-mobile" alt="Start survey"/>`)),r.on("click",e=>{e.preventDefault(),this._openSurvey()}),r}_openSurvey(){let e=document.querySelector(a),t=(e||(e=document.createElement(a),document.body.appendChild(e)),e.closeOnBackgroundClick=this._getCloseOnBackgroundClickSetting(),this._resetOnClose=this._getResetOnCloseSetting(),()=>{this._resetOnClose&&this._resetSurveyState(),e.removeEventListener("br-ui-survey:popup-closed",t)});e.addEventListener("br-ui-survey:popup-closed",t),null===this._currentNodeId&&(this._currentNodeId=this._findFirstNodeId()),this._renderCurrentPage(e),e.open(),this._fireOpenedEvent(),console.log("Survey trigger clicked:",this.uuid,"currentNodeId:",this._currentNodeId)}_renderCurrentPage(t){if(t&&"function"==typeof t.setBodyContent){var r,s=Breinify.UTL.isNonEmptyString(this._currentNodeId),s=null!==s&&this._nodesById?this._nodesById[s]:null;let e;e=h.isPlainObject(s)?"question"===s.type?this._createQuestionPage(s):((r=document.createElement("div")).className="br-survey-page br-survey-page--unsupported",r.textContent="This step type is not yet supported.",r):((r=document.createElement("div")).className="br-survey-page br-survey-page--error",r.textContent="The survey is not correctly configured.",r),t.setBodyContent(e),"function"==typeof t.setFooterContent&&(r=this._createFooterControls(s),t.setFooterContent(r))}}_createQuestionPage(e){var t=h.isPlainObject(e.data)?e.data:{},r=Breinify.UTL.isNonEmptyString(t.question)||"",t=Array.isArray(t.answers)?t.answers:[];let d=Breinify.UTL.isNonEmptyString(e.id),u=null!==d&&this._selectedAnswers?this._selectedAnswers[d]:null,c=document.createElement("div");c.className="br-survey-page br-survey-page--question";e=document.createElement("h2");if(e.className="br-survey-question-title",e.textContent=r,c.appendChild(e),0<t.length){let l=document.createElement("div");l.className="br-survey-answers",t.forEach(r=>{if(h.isPlainObject(r)){let t=Breinify.UTL.isNonEmptyString(r._id);var s=Breinify.UTL.isNonEmptyString(r.title)||"",i=Breinify.UTL.isNonEmptyString(r.description),r=Breinify.UTL.isNonEmptyString(r.resourceUrl),n=null!==r,o=null!==i;let e=document.createElement("button");e.type="button",e.className="br-survey-answer",n||o||e.classList.add("br-survey-answer--simple"),o&&e.classList.add("br-survey-answer--has-description"),null!==t&&null!==u&&t===u&&e.classList.add("br-survey-answer--selected"),n&&(e.classList.add("br-survey-answer--has-image"),(n=document.createElement("div")).className="br-survey-answer__media",(a=document.createElement("img")).src=r,a.alt=s||"",n.appendChild(a),e.appendChild(n));var r=document.createElement("div"),a=(r.className="br-survey-answer__content",document.createElement("div"));a.className="br-survey-answer__title",a.textContent=s,r.appendChild(a),o&&((n=document.createElement("div")).className="br-survey-answer__description",n.textContent=i,r.appendChild(n)),e.appendChild(r),e.addEventListener("click",()=>{this._handleAnswerClick(d,t,c,e)}),e.addEventListener("dblclick",e=>{e.preventDefault(),this._handleAnswerDoubleClick(d,t)}),l.appendChild(e)}}),c.appendChild(l)}return c}_handleAnswerClick(e,t,r,s){var i;null!==e&&null!==t&&(h.isPlainObject(this._selectedAnswers)||(this._selectedAnswers={}),this._selectedAnswers[e]=t,r)&&r.querySelectorAll&&(r.querySelectorAll(".br-survey-answer").forEach(e=>{e===s?e.classList.add("br-survey-answer--selected"):e.classList.remove("br-survey-answer--selected")}),i=document.querySelector(a))&&"function"==typeof i.setFooterContent&&(t=this._nodesById[e],r=this._createFooterControls(t),i.setFooterContent(r))}_handleAnswerDoubleClick(e,t){null!==e&&null!==t&&this._goForward(e,t)}_createFooterControls(s){var i=document.createElement("div");if(i.className="br-survey-footer-controls",h.isPlainObject(s)){let e=Breinify.UTL.isNonEmptyString(s.id),t=null!==e&&this._selectedAnswers?this._selectedAnswers[e]:null,r=!1;null!==t&&((s=document.createElement("div")).className="br-survey-hint",s.textContent="Tips:\n- single tap to select answer\n- double tap to select & answer",i.appendChild(s),r=!0),Array.isArray(this._history)&&0<this._history.length&&((s=document.createElement("button")).type="button",s.className="br-survey-btn br-survey-btn--back",s.textContent="Back",s.addEventListener("click",()=>{this._goBack()}),i.appendChild(s)),null!==t&&((s=document.createElement("button")).type="button",s.className="br-survey-btn br-survey-btn--next",s.textContent="Next",s.addEventListener("click",()=>{this._goForward(e,t)}),i.appendChild(s)),r&&i.classList.add("br-survey-footer-controls--with-hint")}return i}_goForward(e,t){var r;e&&t&&(this._fireAnswerSelectedEvent(e,t),null!==(r=this._getNextNodeIdFromAnswer(e,t))?(this._history.push(e),this._currentNodeId=r,(r=document.querySelector(a))&&this._renderCurrentPage(r)):console.warn("No next edge found for",e,t))}_goBack(){var e;Array.isArray(this._history)&&0!==this._history.length&&(e=this._history.pop(),this._currentNodeId=e,e=document.querySelector(a))&&this._renderCurrentPage(e)}_getNextNodeIdFromAnswer(t,r){if(!t||!r||!Array.isArray(this._edges))return null;let e=this._edges.find(e=>{if(h.isPlainObject(e)&&e.source===t){if(e.answer===r)return!0;if(e.answerId===r)return!0;if(e.sourceHandle===r)return!0;if(h.isPlainObject(e.data)){if(e.data.answerId===r)return!0;if(e.data.sourceAnswerId===r)return!0}}return!1});return e=e||this._edges.find(e=>h.isPlainObject(e)&&e.source===t),h.isPlainObject(e)?Breinify.UTL.isNonEmptyString(e.target):null}_findFirstNodeId(){if(!(h.isPlainObject(this.settings)&&h.isPlainObject(this.settings.survey)&&Array.isArray(this.settings.survey.nodes)&&Array.isArray(this._edges)))return null;var e=this.settings.survey.nodes.find(e=>h.isPlainObject(e)&&"start"===e.type);if(!h.isPlainObject(e))return null;let t=Breinify.UTL.isNonEmptyString(e.id);return null!==t&&(e=this._edges.find(e=>h.isPlainObject(e)&&e.source===t),h.isPlainObject(e))?Breinify.UTL.isNonEmptyString(e.target):null}_loadStructureFromSettings(){this._nodesById={},this._edges=[],this._currentNodeId=null,this._selectedAnswers={},this._history=[],h.isPlainObject(this.settings)&&h.isPlainObject(this.settings.survey)&&(Array.isArray(this.settings.survey.nodes)&&this.settings.survey.nodes.forEach(e=>{e&&e.id&&(this._nodesById[e.id]=e)}),Array.isArray(this.settings.survey.edges))&&(this._edges=this.settings.survey.edges.slice())}render(e,t){this.settings=t,this.uuid=e,this.$shadowRoot.empty(),this._ensureBaseStyle(),this._loadStructureFromSettings(),Breinify.plugins.webExperiences.style(this.settings,this.$shadowRoot);var t=h('<div class="br-survey-root"></div>'),r=this._createTrigger();t.append(r),this.$shadowRoot.append(t),this._fireRenderedEvent(),console.log(e),console.log(this.settings),console.log(JSON.stringify(this.settings))}}Breinify.plugins._add("uiSurvey",{register:function(e,t,r){window.customElements.get(a)||window.customElements.define(a,l),window.customElements.get(o)||window.customElements.define(o,d);var s="br-survey-"+t,i="br-survey-global-style";0===h("#"+i).length&&h("body").prepend(`
                  <style id="${i}">
                    .br-survey-scroll-lock { overflow: hidden !important; touch-action: none !important; overscroll-behavior: none !important; }
                  </style>
                `);let n=h("#"+s);0===n.length&&(n=h("<"+o+"/>").attr("id",s),!1===Breinify.plugins.webExperiences.attach(r,n))||n.get(0).render(t,r)}})}})();
(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiSurvey")){let n="br-ui-survey",o="br-ui-survey-popup",p=Breinify.UTL._jquery();class u extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._renderBase()}_renderBase(){0<this.shadowRoot.childNodes.length||(this.shadowRoot.innerHTML=`
                <style>
                    :host {
                        display: none;
                        position: fixed;
                        inset: 0;
                        z-index: 2147483647; /* very high to be above most things */
                        font-family: inherit;
                    }

                    :host([open]) { display: block; }

                    .br-ui-survey-popup__backdrop {
                        position: fixed;
                        inset: 0;
                        background: rgba(0, 0, 0, 0.45);
                    }

                    .br-ui-survey-popup__outer {
                        position: fixed;
                        inset: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        pointer-events: none;
                    }

                    .br-ui-survey-popup__dialog {
                        pointer-events: auto;
                        max-width: 520px;
                        width: calc(100% - 2rem);
                        max-height: calc(100% - 4rem);
                        background: #fff;
                        border-radius: 12px;
                        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    }

                    .br-ui-survey-popup__header {
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        padding: 0.5rem 0.75rem;
                        border-bottom: 1px solid #eee;
                    }
                    
                    .br-ui-survey-popup__footer {
                        padding: 0.75rem 1rem;
                        border-top: 1px solid #eee;
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        gap: 0.5rem;
                    }

                    .br-ui-survey-popup__close-btn {
                        border: none;
                        background: transparent;
                        cursor: pointer;
                        font-size: 1.25rem;
                        line-height: 1;
                        padding: 0.25rem 0.5rem;
                    }

                    .br-ui-survey-popup__body { padding: 1rem 1.25rem 1.25rem; overflow: auto; }

                    .br-ui-survey-popup__placeholder {
                        font-size: 0.95rem;
                        color: #666;
                        text-align: center;
                    }
                    
                    @media (max-width: 640px) {
                        .br-ui-survey-popup__outer { align-items: stretch; }
                    
                        .br-ui-survey-popup__dialog {
                            width: 100%;
                            max-width: 100%;
                            height: 100%;
                            max-height: 100%;
                            border-radius: 0;
                            box-shadow: none;
                        }
                    
                        /* overflow: auto -> ensure it scrolls nicely if content is long */
                        .br-ui-survey-popup__body { flex: 1 1 auto; overflow: auto; }
                    }
                </style>

                <div class="br-ui-survey-popup__backdrop" part="backdrop"></div>
                <div class="br-ui-survey-popup__outer">
                    <div class="br-ui-survey-popup__dialog" role="dialog" aria-modal="true">
                        <div class="br-ui-survey-popup__header">
                            <button type="button" class="br-ui-survey-popup__close-btn" aria-label="Close survey">
                                &times;
                            </button>
                        </div>
                        <div class="br-ui-survey-popup__body">
                            <div class="br-ui-survey-popup__placeholder">
                                Survey content will appear hereâ€¦
                            </div>
                        </div>
                        <div class="br-ui-survey-popup__footer">
                            <!-- Navigation and CTA controls will go here -->
                        </div>
                    </div>
                </div>
            `,this._bindBaseEvents())}_bindBaseEvents(){var e=this.shadowRoot.querySelector(".br-ui-survey-popup__backdrop"),t=this.shadowRoot.querySelector(".br-ui-survey-popup__close-btn");e&&e.addEventListener("click",()=>this.close()),t&&t.addEventListener("click",()=>this.close())}open(){this.hasAttribute("open")||this.setAttribute("open","");var e=this.shadowRoot.querySelector(".br-ui-survey-popup__dialog");e&&"function"==typeof e.focus&&(e.setAttribute("tabindex","-1"),e.focus())}close(){this.hasAttribute("open")&&this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("br-ui-survey:popup-closed",{bubbles:!0,cancelable:!1}))}setBodyContent(e){var t=this.shadowRoot.querySelector(".br-ui-survey-popup__body");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}setFooterContent(e){var t=this.shadowRoot.querySelector(".br-ui-survey-popup__footer");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&t.appendChild(e)}}}class a extends HTMLElement{$shadowRoot=null;settings=null;uuid=null;constructor(){super(),this.attachShadow({mode:"open"}),this.uuid=null,this.$shadowRoot=p(this.shadowRoot),this.settings={},this._selectedAnswers={},this._nodesById={},this._edges=[],this._currentNodeId=null}_ensureBaseStyle(){var e="br-ui-survey-style";0<this.$shadowRoot.find("#"+e).length||this.$shadowRoot.append(p(`<style id="${e}">
                :host {
                    display: block;
                    box-sizing: border-box;
                    font-family: inherit;
                    color: inherit;
                    --br-ui-survey-answer-aspect-ratio: 1 / 1;
                }
            
                *, *::before, *::after { box-sizing: border-box; }
            
                .br-ui-survey-root { width: 100%; }
                .br-ui-survey-container { width: 100%; }
                .br-ui-survey-hidden { display: none !important; }
            
                /* -------------------------------------------------- */
                /* Trigger banner styling (desktop + mobile)          */
                /* -------------------------------------------------- */
                .br-ui-survey-trigger {
                    display: inline-block;
                    cursor: pointer;
                    width: 100%;
                }
            
                .br-ui-survey-trigger-image { width: 100%; height: auto; border: 0; }
                .br-ui-survey-trigger-image.br-ui-survey-desktop { display: block; }
                .br-ui-survey-trigger-image.br-ui-survey-mobile { display: none; }
            
                @media (max-width: 600px) {
                    .br-ui-survey-trigger-image.br-ui-survey-desktop { display: none; }
                    .br-ui-survey-trigger-image.br-ui-survey-mobile { display: block; }
                }
                
                .br-ui-survey-question__answer-description { font-size: 0.85em; color: #666; }
                .br-ui-survey-question__title { font-size: 1.1rem; margin: 0 0 0.5rem; }
                .br-ui-survey-question__answers { display: flex; flex-direction: column; gap: 0.5rem; }
                .br-ui-survey-page--question { display: flex; flex-direction: column; gap: 0.75rem; }
                .br-ui-survey-question__answer { 
                    text-align: left; 
                    width: 100%; 
                    border-radius: 0.5rem; 
                    border: 1px solid #ddd; 
                    padding: 0.5rem 0.75rem; 
                    background: #fff; 
                    cursor: pointer; 
                    font: inherit; 
                    display: flex;
                    align-items: flex-start;
                    gap: 0.75rem;
                }
                .br-ui-survey-question__answer:hover { border-color: #ccc; background: #fafafa; }
                .br-ui-survey-question__answer--selected { border-color: #333; background: #f0f0f0; }
                .br-ui-survey-question__answer-media {
                    flex: 0 0 72px;
                    border-radius: 0.45rem;
                    overflow: hidden;
                    background: #f2f2f2;
                    aspect-ratio: var(--br-ui-survey-answer-aspect-ratio, 1 / 1);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .br-ui-survey-question__answer-media img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: block;
                }
                .br-ui-survey-question__answer-content { flex: 1 1 auto; }
            </style>`))}_createTrigger(){var e=this.settings&&this.settings.trigger||{},t=e.bannerUrl,e=e.mobileBannerUrl||t,i=p("<div/>",{class:"br-ui-survey-trigger",role:"button",tabindex:0,"aria-label":"Start survey"});return t&&i.append(p('<img src="'+t+'" class="br-ui-survey-trigger-image" alt="Start survey"/>').addClass("br-ui-survey-desktop")),e&&i.append(p('<img src="'+e+'" class="br-ui-survey-trigger-image" alt="Start survey"/>').addClass("br-ui-survey-mobile")),i.on("click",e=>{e.preventDefault(),this._openSurvey()}),i}_openSurvey(){let e=document.querySelector(o);e||(e=document.createElement(o),document.body.appendChild(e)),null===this._currentNodeId&&(this._currentNodeId=this._findFirstNodeId()),this._renderCurrentPage(e),e.open(),console.log("Survey trigger clicked:",this.uuid,"currentNodeId:",this._currentNodeId)}_renderCurrentPage(t){if(t&&"function"==typeof t.setBodyContent){var i=Breinify.UTL.isNonEmptyString(this._currentNodeId),i=null!==i&&this._nodesById?this._nodesById[i]:null;let e;e=p.isPlainObject(i)?"question"===i.type?this._createQuestionPage(i):((i=document.createElement("div")).className="br-ui-survey-page br-ui-survey-page--unsupported",i.textContent="This step type is not yet supported.",i):((i=document.createElement("div")).className="br-ui-survey-page br-ui-survey-page--error",i.textContent="The survey is not correctly configured.",i),t.setBodyContent(e),"function"==typeof t.setFooterContent&&t.setFooterContent(null)}}_createQuestionPage(e){var t=p.isPlainObject(e.data)?e.data:{},i=Breinify.UTL.isNonEmptyString(t.question)||"",t=Array.isArray(t.answers)?t.answers:[];let a=Breinify.UTL.isNonEmptyString(e.id),d=null!==a&&this._selectedAnswers?this._selectedAnswers[a]:null,l=document.createElement("div");l.className="br-ui-survey-page br-ui-survey-page--question";e=document.createElement("h2");if(e.className="br-ui-survey-question__title",e.textContent=i,l.appendChild(e),0<t.length){let u=document.createElement("div");u.className="br-ui-survey-question__answers",t.forEach(i=>{if(p.isPlainObject(i)){let e=Breinify.UTL.isNonEmptyString(i._id);var r=Breinify.UTL.isNonEmptyString(i.title)||"",s=Breinify.UTL.isNonEmptyString(i.description),i=Breinify.UTL.isNonEmptyString(i.resourceUrl);let t=document.createElement("button");t.type="button",t.className="br-ui-survey-question__answer",null!==e&&null!==d&&e===d&&t.classList.add("br-ui-survey-question__answer--selected"),null!==i&&((n=document.createElement("div")).className="br-ui-survey-question__answer-media",(o=document.createElement("img")).src=i,o.alt=r||"",n.appendChild(o),t.appendChild(n));var n,i=document.createElement("div"),o=(i.className="br-ui-survey-question__answer-content",document.createElement("div"));o.className="br-ui-survey-question__answer-title",o.textContent=r,i.appendChild(o),null!==s&&((n=document.createElement("div")).className="br-ui-survey-question__answer-description",n.textContent=s,i.appendChild(n)),t.appendChild(i),t.addEventListener("click",()=>{this._handleAnswerClick(a,e,l,t)}),u.appendChild(t)}}),l.appendChild(u)}return l}_handleAnswerClick(e,t,i,r){null!==e&&null!==t&&(p.isPlainObject(this._selectedAnswers)||(this._selectedAnswers={}),this._selectedAnswers[e]=t,i)&&i.querySelectorAll&&i.querySelectorAll(".br-ui-survey-question__answer").forEach(e=>{e===r?e.classList.add("br-ui-survey-question__answer--selected"):e.classList.remove("br-ui-survey-question__answer--selected")})}_findFirstNodeId(){if(!(p.isPlainObject(this.settings)&&p.isPlainObject(this.settings.survey)&&Array.isArray(this.settings.survey.nodes)&&Array.isArray(this._edges)))return null;var e=this.settings.survey.nodes.find(e=>p.isPlainObject(e)&&"start"===e.type);if(!p.isPlainObject(e))return null;let t=Breinify.UTL.isNonEmptyString(e.id);return null!==t&&(e=this._edges.find(e=>p.isPlainObject(e)&&e.source===t),p.isPlainObject(e))?Breinify.UTL.isNonEmptyString(e.target):null}_loadStructureFromSettings(){this._nodesById={},this._edges=[],this._currentNodeId=null,this._selectedAnswers={},p.isPlainObject(this.settings)&&p.isPlainObject(this.settings.survey)&&(Array.isArray(this.settings.survey.nodes)&&this.settings.survey.nodes.forEach(e=>{e&&e.id&&(this._nodesById[e.id]=e)}),Array.isArray(this.settings.survey.edges))&&(this._edges=this.settings.survey.edges.slice())}render(e,t){this.settings=t,this.uuid=e,this.$shadowRoot.empty(),this._ensureBaseStyle(),this._loadStructureFromSettings(),Breinify.plugins.webExperiences.style(this.settings,this.$shadowRoot);var t=p('<div class="br-ui-survey-root"></div>'),i=this._createTrigger();t.append(i),this.$shadowRoot.append(t),console.log(e),console.log(this.settings),console.log(JSON.stringify(this.settings))}}Breinify.plugins._add("uiSurvey",{register:function(e,t,i){window.customElements.get(o)||window.customElements.define(o,u),window.customElements.get(n)||window.customElements.define(n,a);var r="br-survey-"+t;let s=p("#"+r);0===s.length&&(s=p("<"+n+"/>").attr("id",r),!1===Breinify.plugins.webExperiences.attach(i,s))||s.get(0).render(t,i)}})}})();
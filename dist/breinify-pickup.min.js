"use strict";!function(){if("object"==typeof Breinify&&!Breinify.plugins._isAdded("pickUp")){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=Breinify.UTL.constants.errors.prefix.validation,d=Breinify.UTL.constants.errors.prefix.api,e={addOrder:function(){var a=this;b.overload({"String,Object,Function":function(b,c,d){a._addOrder({},{},[b],c,d)},"Array,Object,Function":function(b,c,d){a._addOrder({},{},b,c,d)},"String,Object,Object,Function":function(b,c,d,e){a._addOrder(d,{},[b],c,e)},"Array,Object,Object,Function":function(b,c,d,e){a._addOrder(d,{},b,c,e)},"String,Object,Object,Object,Function":function(b,c,d,e,f){a._addOrder(e,c,[b],d,f)},"Array,Object,Object,Object,Function":function(b,c,d,e,f){a._addOrder(e,c,b,d,f)}},arguments,this)},_addOrder:function(a,b,c,d,e){var f=this,g=Breinify.UTL.internal.cbCollector({_callback:function(a,c){if(null===a)f._addOrderValidated(c.entity,b,c.externalIds,c.location,e);else for(var d in a)if(a.hasOwnProperty(d)){var g=a[d];e(g);break}},location:function(a,b){g._set("location",a,b)},entity:function(a,b){g._set("entity",a,b)},externalIds:function(a,b){g._set("externalIds",a,b)}});this._validateLocation(d,g.location),this._validateEntity(a,g.entity),this._validateExternalIds(c,g.externalIds)},_validateExternalIds:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(a.isArray(b)){for(var e=0;e<b.length;e++)if("string"!=typeof b[e])return void d(new Error(c+"ExternalIds "+b[e]+" must be a string."));d(null,b)}else"string"==typeof b&&""!==b.trim()&&d(null,[b])},_validateLocation:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(!a.isPlainObject(b))return void d(new Error(c+"Location must be a plain-object."));var e=!Breinify.UTL.isEmpty(b.id),f=!Breinify.UTL.isEmpty(b.name);return e||f?(e?f||(b.name=null):b.id=null,void d(null,b)):void d(new Error(c+"Must specify a location's id or name."))},_validateEntity:function(b,d){if("undefined"==typeof b||null===b)return void d(null,null);if(!a.isPlainObject(b))return void d(new Error(c+"Entity must be a plain-object."));if("undefined"==typeof b.type||null===b.type)b.type="sms";else{if("string"!=typeof b.type)return void d(new Error(c+"EntityType must be a string (or empty)."));if("sms"!==b.type)return void d(new Error(c+"EntityType "+b.type+" not supported."))}if("undefined"==typeof b.name||null===b.name)b.name=null;else if("string"!=typeof b.name)return void d(new Error(c+"EntityName must be a string (or empty)."));if("undefined"==typeof b.id||null===b.id)b.id=null;else if("string"!=typeof b.id)return void d(new Error(c+"EntityId must be a string (or empty)."));if(null===b.id);else if("sms"===b.type){if("string"!=typeof b.id)return void d(new Error(c+"Invalid phone-number (entityId) defined: "+b.id));if(b.id=b.id.trim(),!/\+?\d+/.test(b.id))return void d(new Error(c+"Invalid phone-number (entityId) defined: "+b.id));if(0!==b.id.indexOf("+"))return void d(new Error(c+"Phone-number (entityId) must include the country-code (e.g., +1): "+b.id))}else d(new Error(c+"EntityType "+entityType+" not supported."));d(null,b)},_addOrderValidated:function(b,e,f,g,h){if(null===f)return void h(new Error(c+"The pick-up's identifier(s) must be set."));if(null===g)return void h(new Error(c+"The pick-up's location must be set."));if(a.isPlainObject(b)&&null!==b.id&&null===b.type)return void h(new Error(c+"The pick-up's entity-type must be set (if the id is specified)."));e=Breinify.UTL.user.create(e);var i={pickUpMessage:"addPickUp",pickUpExternalIds:f,pickUpLocation:g.name,pickUpLocationId:g.id,pickUpEntities:[{pickUpEntityId:b.id,pickUpEntityType:b.type,pickUpEntityName:b.name}]},j={messageServiceUserIdentifier:null===b.id?"UNIDENTIFIED":b.id,gameKeyword:"pickup",gameInputText:JSON.stringify(i),messageText:"ADD PICKUP "+f[0]+" FOR "+b.id+" AT "+g.name};Breinify.activity(e,"gameSms",null,null,j,function(a,b){"string"==typeof b?h(new Error(d+b)):h(null,i)})}};Breinify.plugins._add("pickUp",e)}}();
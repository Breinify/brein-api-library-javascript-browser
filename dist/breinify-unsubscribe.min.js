"use strict";!function(){var o,r;"object"!=typeof Breinify||Breinify.plugins._isAdded("unsubscribe")||(o=Breinify.UTL._jquery(),Breinify.plugins._overload(),r={tokenCodeValidation:null,tokenCodeUnsubscribe:null,check:function(e,n,i){return"string"!=typeof e?(i(new Error("token not configured")),!1):"string"==typeof n||(i(new Error("unsubscribe code not specified or found")),!1)},getValidationToken:function(e){return null===this.tokenCodeValidation&&(this.tokenCodeValidation=this._determineValidationToken(e)),this.tokenCodeValidation},getUnsubscribeToken:function(e){return null===this.tokenCodeUnsubscribe&&(this.tokenCodeUnsubscribe=this._determineUnsubscribeToken(e)),this.tokenCodeUnsubscribe},getCode:function(e){return null===(e=null!==e&&"string"==typeof e?e:Breinify.UTL.loc.param("c"))||"string"!=typeof e?null:e},_determineValidationToken:function(e){return this._determineToken("tokenCodeValidation","testTokenCodeValidation",e)},_determineUnsubscribeToken:function(e){return this._determineToken("tokenCodeUnsubscribe","testTokenCodeUnsubscribe",e)},_determineToken:function(e,n,i){var t=null;return t=null===(t=Breinify.plugins._isAdded("api")&&"prod"!==Breinify.plugins.api.determineMode()?i.getConfig(n,null):t)?i.getConfig(e,null):t}},Breinify.plugins._add("unsubscribe",{code:function(){return r.getCode()},validate:function(t,e){var n=r.getValidationToken(this);e=r.getCode(e),r.check(n,e,t)&&o.ajax({url:"https://api.breinify.com/res/"+n,type:"GET",crossDomain:!0,data:{code:e},success:function(e){o.isPlainObject(e)&&o.isPlainObject(e.payload)&&"string"==typeof e.payload.email&&""!==e.payload.email.trim()?(delete e.payload.dynamicPermissions,t(null,e.payload)):t(new Error("failed to validate the specified code"))},error:function(e,n,i){t(new Error("failed to validate the specified code: "+n))},timeout:6e4})},change:function(e,t,n){var i=r.getUnsubscribeToken(this);n=r.getCode(n),r.check(i,n,t)&&o.ajax({url:"https://api.breinify.com/res/"+i,type:"GET",crossDomain:!0,data:{code:n,status:e},success:function(e){o.isPlainObject(e)&&o.isPlainObject(e.payload)&&"string"==typeof e.payload.email&&""!==e.payload.email.trim()?(delete e.payload.dynamicPermissions,t(null,e.payload)):t(new Error("failed to unsubscribe"))},error:function(e,n,i){t(new Error("failed to unsubscribe: "+n))},timeout:6e4})}}))}();
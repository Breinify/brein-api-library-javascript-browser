(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiRecommendations")){let l=Breinify.UTL._jquery(),i=["before","after","prepend","append","replace","externalRender"],p={_rendered:new Set,handle:async function(n,i,e,t){"onLoad"===Breinify.UTL.isNonEmptyString(t.type)&&this._rendered.has(i)||(t=await Promise.all(e.map(e=>Promise.resolve().then(()=>p._handle(n,i,e)).catch(e=>(console.error(e),null)))),Breinify.plugins.recommendations.render(t),this._rendered.add(i))},_handle:async function(e,n,i){var t={};if(l.isPlainObject(i))return t.recommender=await this._createPayload(i.recommender),t.activity=this._createActivitySettings(i),t.splitTests=this._createSplitTestsSettings(i.splitTestControl),t.position=this._createPosition(i.position),t.placeholders=this._createPlaceholders(i.placeholders),t.templates=this._createTemplates(i.templates),t.process=this._createProcess(e,n,i.process),this._applyStyle(i.style),t},_applyStyle:function(e){l.isPlainObject(e)&&null!==(e=Breinify.UTL.isNonEmptyString(e.snippet))&&Breinify.plugins.snippetManager.injectSnippet(e,"body","prepend")},_createProcess:function(e,i,n,t){let r,a=(r=l.isPlainObject(n)?Object.fromEntries(Object.entries(n).flatMap(([e,n])=>{n=Breinify.plugins.snippetManager.getSnippet(n);return null==n?[]:[[e,n]]})):{},null);return l.isFunction(r.createActivity)&&(a=r.createActivity),r.createActivity=function(e,n){l.isFunction(a)&&a.call(this,e,n),n.activityTags.campaignWebExId=i},r},_createPosition:function(e){if(!l.isPlainObject(e))return{};let n=Breinify.UTL.isNonEmptyString(e.operation);return null!==n&&(n=n.toLowerCase(),-1!==i.indexOf(n))&&(e=this._createPositionSelector(e),l.isFunction(e))?{[n]:e}:{}},_createPositionSelector:function(n){if(!l.isPlainObject(n))return null;if(!l.isFunction(n._func)){let e=Breinify.UTL.isNonEmptyString(n.selector);var i=Breinify.UTL.isNonEmptyString(n.snippet);if(null===e&&null===i)return null;null!==e?n._func=function(){return l(e)}:n._func=Breinify.plugins.snippetManager.getSnippet(i)}return n._func},_createTemplates:function(e){var n;return l.isPlainObject(e)?(n=Breinify.UTL.isNonEmptyString(e.container),e=Breinify.UTL.isNonEmptyString(e.item),{container:Breinify.plugins.snippetManager.getSnippet(n),item:Breinify.plugins.snippetManager.getSnippet(e)}):{}},_createSplitTestsSettings:function(e){return!l.isPlainObject(e)||null===(e=Breinify.UTL.isNonEmptyString(e.selector))?{}:{control:{containerSelector:e}}},_createPlaceholders:function(e){return l.isPlainObject(e)?Object.fromEntries(Object.entries(e).flatMap(([e,n])=>{n=Breinify.plugins.snippetManager.getSnippet(n);return null==n?[]:[[e,n]]})):{}},_createActivitySettings:function(e){e=l.isPlainObject(e)?Breinify.UTL.isNonEmptyString(e.activityType):null;return{clickedType:null===e?"clickedRecommendation":e}},_createPayload:async function(e){if(!l.isPlainObject(e))return{};var n=Breinify.UTL.isNonEmptyString(e.preconfiguredRecommendation),i=null===(i=Breinify.UTL.isNonEmptyString(e.queryLabel))?n:i;let t=null;var e=Breinify.UTL.isNonEmptyString(e.itemsForRecommendation);return null!==e&&(e=Breinify.plugins.snippetManager.getSnippet(e),t=await e()),{payload:{recommendationQueryName:i,namedRecommendations:[n],recommendationForItems:t=l.isArray(t)?t:null}}},_recommenderName:function(e){return Breinify.UTL.isNonEmptyString(e?.recommender?.preconfiguredRecommendation)},_findRequirements:function(e,n,i,t){if(!l.isPlainObject(t)||"attribute-change"===t.type||"removed-element"===t.type)return!1;var r,a=[];for(r of n){var o=this._createPositionSelector(r.position)(this._recommenderName(r));o&&o.jquery&&(0===o.length||0<o.find("."+Breinify.plugins.recommendations.marker.container).length||o.hasClass(Breinify.plugins.recommendations.marker.container)||"true"===o.data("br-marked-for-"+e)||!i.is(o)&&0===i.has(o).length||(o.data("br-marked-for-"+e,"true"),a.push(r)))}return 0<a.length&&a}};Breinify.plugins._add("uiRecommendations",{register:function(e,i,n,t){let r=this,a=[],o=[];var s;for(s of l.isPlainObject(t)&&l.isArray(t.recommendations)?t.recommendations:[]){var c=l.isPlainObject(s)&&l.isPlainObject(s.position)?s.position:{};let e=Breinify.UTL.isNonEmptyString(c.renderingBehavior);("onchange"===(e=null===e?null:e.toLowerCase())||"on_change"===e?o:a).push(s)}0<o.length&&0<a.length||(0<a.length?e.onChange=function(){r.handle(i,n,{activationLogic:t.activationLogic,recommendations:a,type:"onLoad"})}:(e.findRequirements=function(e,n){e=p._findRequirements(i,o,e,n);return!(!l.isArray(e)||0===e.length)&&{activationLogic:t.activationLogic,recommendations:e,type:"onChange"}},e.onChange=function(e){r.handle(i,n,e)}))},handle:function(e,n,i){let t=l.isArray(i.recommendations)?i.recommendations:[];0!==t.length&&Promise.resolve().then(()=>p.handle(e,n,t,i)).catch(e=>{})}})}})();
(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("uiRecommendations")){let l=Breinify.UTL._jquery(),t=["before","after","prepend","append","replace","externalRender"],c={handle:async function(n,e){e=await Promise.all(e.map(e=>Promise.resolve().then(()=>c._handle(n,e)).catch(e=>(console.error(e),null))));Breinify.plugins.recommendations.render(e)},_handle:async function(e,n){var t={};if(l.isPlainObject(n))return t.recommender=await this._createPayload(n.recommender),t.activity=this._createActivitySettings(n),t.splitTests=this._createSplitTestsSettings(n.splitTestControl),t.position=this._createPosition(n.position),t.placeholders=this._createPlaceholders(n.placeholders),t.templates=this._createTemplates(n.templates),t.process=this._createProcess(e,n.process),t},_createProcess:function(t,e){let n,i=(n=l.isPlainObject(e)?Object.fromEntries(Object.entries(e).flatMap(([e,n])=>{n=Breinify.plugins.snippetManager.getSnippet(n);return null==n?[]:[[e,n]]})):{},null);return l.isFunction(n.createActivity)&&(i=n.createActivity),n.createActivity=function(e,n){l.isFunction(i)&&i.call(this,e,n),n.activityTags.campaignWebExId=t},n},_createPosition:function(e){if(!l.isPlainObject(e))return{};let n=Breinify.UTL.isNonEmptyString(e.operation);return null!==n&&(n=n.toLowerCase(),-1!==t.indexOf(n))&&(e=this._createPositionSelector(e),l.isFunction(e))?{[n]:e}:{}},_createPositionSelector:function(e){if(!l.isPlainObject(e))return null;let n=Breinify.UTL.isNonEmptyString(e.selector);e=Breinify.UTL.isNonEmptyString(e.snippet);let t=null;return null===n&&null===e?null:t=null!==n?function(){return l(n)}:Breinify.plugins.snippetManager.getSnippet(e)},_createTemplates:function(e){var n;return l.isPlainObject(e)?(n=Breinify.UTL.isNonEmptyString(e.container),e=Breinify.UTL.isNonEmptyString(e.item),{container:Breinify.plugins.snippetManager.getSnippet(n),item:Breinify.plugins.snippetManager.getSnippet(e)}):{}},_createSplitTestsSettings:function(e){return!l.isPlainObject(e)||null===(e=Breinify.UTL.isNonEmptyString(e.selector))?{}:{control:{containerSelector:e}}},_createPlaceholders:function(e){return l.isPlainObject(e)?Object.fromEntries(Object.entries(e).flatMap(([e,n])=>{n=Breinify.plugins.snippetManager.getSnippet(n);return null==n?[]:[[e,n]]})):{}},_createActivitySettings:function(e){e=l.isPlainObject(e)?Breinify.UTL.isNonEmptyString(e.activityType):null;return{type:null===e?"clickedRecommendation":e}},_createPayload:async function(e){if(!l.isPlainObject(e))return{};var n=Breinify.UTL.isNonEmptyString(e.preconfiguredRecommendation),t=null===(t=Breinify.UTL.isNonEmptyString(e.queryLabel))?n:t;let i=null;var e=Breinify.UTL.isNonEmptyString(e.itemsForRecommendation);return null!==e&&(e=Breinify.plugins.snippetManager.getSnippet(e),i=await e()),{payload:{recommendationQueryName:t,namedRecommendations:[n],recommendationForItems:i=l.isArray(i)?i:null}}},_findRequirements:function(e,n,t,i){if(!l.isPlainObject(i)||"attribute-change"===i.type||"removed-element"===i.type)return!1;var r,o=[];for(r of n){var a=this._createPositionSelector(r.position)();0===a.length||"true"===a.data("br-marked-for-"+e)||!t.is(a)&&0===t.has(a).length||(a.data("br-marked-for-"+e,"true"),o.push(r))}return console.log(t),console.log(i),console.log(o),o}};Breinify.plugins._add("uiRecommendations",{register:function(e,t,i){let n=this,r=[],o=[];var a;for(a of l.isPlainObject(i)&&l.isArray(i.recommendations)?i.recommendations:[]){var s=l.isPlainObject(a)&&l.isPlainObject(a.position)?a.position:{};let e=Breinify.UTL.isNonEmptyString(s.renderingBehavior);("onchange"===(e=null===e?null:e.toLowerCase())||"on_change"===e?o:r).push(a)}0<o.length&&0<r.length||(0<r.length?e.onChange=function(){n.handle(t,r)}:(e.findRequirements=function(e,n){e=c._findRequirements(t,o,e,n);return!(!l.isArray(e)||0===e.length)&&(console.log(e),{activityLogic:i.activityLogic,recommenders:e})},e.onChange=function(e){console.log("passed data",e),n.handle(t,e)}))},handle:function(e,n){let t=l.isArray(n.recommendations)?n.recommendations:[];0!==t.length&&Promise.resolve().then(()=>c.handle(e,t)).catch(e=>{})}})}})();
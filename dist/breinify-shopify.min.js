(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("shopify")){let u=Breinify.UTL._jquery(),s={isSetup:!1,loadedToken:null,lookUpToken:null,currentCart:null,originalFetch:null,additionalData:[],additionalItemData:[],observers:[],setup:function(i){if(!0!==this.isSetup){let t=this;if(u.isArray(i.observers))for(let t=0;t<i.observers.length;t++)this.addObserver(i.observers[t]);!0===i.enableCartRequests&&(t._loadCart(),"number"==typeof i.refreshRateInMs)&&10<=i.refreshRateInMs&&window.setInterval(function(){t._loadCart()},i.refreshRateInMs),!0===i.captureCartFetchEvents&&(this._bindFetch(),this._bindJQuery()),u.isArray(i.additionalData)&&(this.additionalData=i.additionalData),u.isArray(i.additionalItemData)&&(this.additionalItemData=i.additionalItemData),this.isSetup=!0}},_bindJQuery:function(t,i){let e=this;u.isFunction(window.jQuery)&&u.isFunction(window.jQuery.ajax)?(this.originalAjax=window.jQuery.ajax,window.jQuery.ajax=function(t){var i="string"==typeof t?t:t.url;return"string"==typeof i&&i.startsWith("/cart/")?e.originalAjax.call(this,t).done(function(){e._loadCart()}):e.originalAjax.apply(this,arguments)}):(i=i||0,setTimeout(function(){e._bindJQuery(t,i+50)},50))},_bindFetch:function(){let e=this;this.originalFetch=window.fetch,window.fetch=function(){var t=arguments,i=t[0];return"string"==typeof i&&i.startsWith("/cart/")?e.originalFetch.apply(this,t).then(t=>(e._loadCart(),t)):e.originalFetch.apply(this,t)}},getToken:function(){let t=u.isFunction(this.lookUpToken)?this.lookUpToken():null;return t="string"==typeof t&&""!==t.trim()?t:this.loadedToken},parseToken:function(t){return"string"==typeof t&&""!==t.trim()?"shopify::cart::"+t.replace(/\?key=[a-z\d]+$/,""):null},addObserver:function(t){u.isFunction(t)&&this.observers.push(t)},_loadCart:function(){let i=this;var t=u.isPlainObject(window.Shopify)&&u.isPlainObject(window.Shopify.routes)&&"string"==typeof window.Shopify.routes.root?window.Shopify.routes.root:"/";u.getJSON(t+"cart.js",function(t){i.loadedToken=i.parseToken(t.token),i._checkCartChanges(t)})},_checkCartChanges:function(t){var i=this.currentCart,e=this._updateCart(t);if(null!==i&&!(null===e||i.isEmpty&&e.isEmpty)){var t=Object.keys(i.items),n=Object.keys(e.items),a=[...new Set([...t,...n])],r=[],s=[];for(let t=0;t<a.length;t++){var o=a[t],l=i.items[o],o=e.items[o];if(u.isPlainObject(l)&&u.isPlainObject(o)){if(l.quantity>o.quantity){let{keys:t,...i}=l;r.push(u.extend(!0,{},i,{quantity:i.quantity-o.quantity}))}else if(l.quantity<o.quantity){let{keys:t,...i}=o;s.push(u.extend(!0,{},i,{quantity:i.quantity-l.quantity}))}}else if(u.isPlainObject(l)){let{keys:t,...i}=l;r.push(i)}else{let{keys:t,...i}=o;s.push(i)}}if(0<r.length||0<s.length)for(let t=0;t<this.observers.length;t++)(0,this.observers[t])(s,r,e)}},_updateCart:function(i){if(u.isPlainObject(i)){var t=i.item_count;if("number"==typeof t)if(0===t)this.currentCart={isEmpty:!0,size:0,quantity:0,items:{},additionalData:{}};else if(u.isArray(i.items)){this.currentCart={isEmpty:!0,size:0,quantity:0,items:{},additionalData:{}};for(let t=0;t<i.items.length;t++){var e=i.items[t],n=null===(n=Breinify.UTL.toInteger(e.id))?null:""+n;if(null!==n){var a=Breinify.UTL.toInteger(e.quantity);this.currentCart.isEmpty=!1,this.currentCart.size++,this.currentCart.quantity+=null===a?0:a;let i=this.currentCart.items[n];u.isPlainObject(i)||(i={additionalData:{},quantity:0,keys:[]},this.currentCart.items[n]=i),i.id=n,i.name=Breinify.UTL.isNonEmptyString(e.product_title),i.quantity+=a,i.keys.push(e.key);for(let t=0;t<this.additionalItemData.length;t++){var r=this.additionalItemData[t];i.additionalData[r]=e[r]}}}}for(let t=0;t<this.additionalData.length;t++){var s=this.additionalData[t];this.currentCart.additionalData[s]=i[s]}}return this.currentCart}};Breinify.plugins._add("shopify",{setup:function(){var t="boolean"!=typeof(t=this.getConfig("cart::enableRequests",null))||t,i="boolean"!=typeof(i=this.getConfig("cart::captureCartFetchEvents",null))||i,e="number"==typeof(e=this.getConfig("cart::refreshRateInMs",null))?e:2500,n=this.getConfig("cart::observers",null),n=u.isFunction(n)?[n]:n,a=(n=u.isArray(n)?n:null,this.getConfig("cart::additionalData",null)),a=u.isArray(a)?a:[],r=this.getConfig("cart::additionalItemData",null),r=u.isArray(r)?r:[];s.setup({enableCartRequests:t,captureCartFetchEvents:i,refreshRateInMs:e,additionalData:a,additionalItemData:r,observers:n})},cart:{onCartChange:function(t){s.addObserver(t)},bindLookUpToken:function(t){s.lookUpToken=u.isFunction(t)?function(){return s.parseToken(t())}:null},getToken:function(){return s.getToken()}}})}})();
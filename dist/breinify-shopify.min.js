(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("shopify")){let l=Breinify.UTL._jquery(),s={isSetup:!1,loadedToken:null,lookUpToken:null,currentCart:null,originalFetch:null,additionalData:[],additionalItemData:[],cartObservers:[],beforeCartObservers:[],afterCartObservers:[],setup:function(e){if(!0!==this.isSetup){let t=this;if(l.isArray(e.beforeCartObservers))for(let t=0;t<e.beforeCartObservers.length;t++)this.addBeforeCartObserver(e.beforeCartObservers[t]);if(l.isArray(e.cartObservers))for(let t=0;t<e.cartObservers.length;t++)this.addCartObserver(e.cartObservers[t]);if(l.isArray(e.afterCartObservers))for(let t=0;t<e.afterCartObservers.length;t++)this.addAfterCartObserver(e.afterCartObservers[t]);!0===e.enableCartRequests&&(t._loadCart(),"number"==typeof e.refreshRateInMs)&&10<=e.refreshRateInMs&&window.setInterval(function(){t._loadCart()},e.refreshRateInMs),!0===e.captureCartFetchEvents&&(this._bindFetch(),this._bindJQuery()),l.isArray(e.additionalData)&&(this.additionalData=e.additionalData),l.isArray(e.additionalItemData)&&(this.additionalItemData=e.additionalItemData),this.isSetup=!0}},_bindJQuery:function(t,e){let r=this;l.isFunction(window.jQuery)&&l.isFunction(window.jQuery.ajax)?(this.originalAjax=window.jQuery.ajax,window.jQuery.ajax=function(t){let e="string"==typeof t?t:t.url;return"string"==typeof e&&e.startsWith("/cart/")?(r.beforeCartRequest(e),r.originalAjax.call(this,t).done(function(){var t=r._loadCart();t&&"function"==typeof t.then?t.then(t=>{r.afterCartRequest(e,null,t)}).catch(t=>{r.afterCartRequest(e,t,null)}):r.afterCartRequest(e,null,t)})):r.originalAjax.apply(this,arguments)}):(e=e||0,setTimeout(function(){r._bindJQuery(t,e+50)},50))},_bindFetch:function(){let r=this;this.originalFetch=window.fetch,window.fetch=function(){var t=arguments;let e=t[0];return"string"==typeof e&&e.startsWith("/cart/")?(r.beforeCartRequest(e),r.originalFetch.apply(this,t).then(t=>(r._loadCart().then(t=>{r.afterCartRequest(e,null,t)}).catch(t=>{r.afterCartRequest(e,t,null)}),t))):r.originalFetch.apply(this,t)}},getToken:function(){let t=l.isFunction(this.lookUpToken)?this.lookUpToken():null;return t="string"==typeof t&&""!==t.trim()?t:this.loadedToken},parseToken:function(t){return"string"==typeof t&&""!==t.trim()?"shopify::cart::"+t.replace(/\?key=[a-z\d]+$/,""):null},addCartObserver:function(t){l.isFunction(t)&&this.cartObservers.push(t)},addBeforeCartObserver:function(t){l.isFunction(t)&&this.beforeCartObservers.push(t)},addAfterCartObserver:function(t){l.isFunction(t)&&this.afterCartObservers.push(t)},beforeCartRequest:function(e){for(let t=0;t<this.beforeCartObservers.length;t++)(0,this.beforeCartObservers[t])(e)},afterCartRequest:function(e){for(let t=0;t<this.afterCartObservers.length;t++)(0,this.afterCartObservers[t])(e)},_loadCart:function(){let r=this,t=l.isPlainObject(window.Shopify)&&l.isPlainObject(window.Shopify.routes)&&"string"==typeof window.Shopify.routes.root?window.Shopify.routes.root:"/";return new Promise((e,i)=>{l.getJSON(t+"cart.js").done(function(t){r.loadedToken=r.parseToken(t.token);t=r._checkCartChanges(t);e(t)}).fail(function(t,e,r){i(r)})})},_checkCartChanges:function(t){var e=this.currentCart,r=this._updateCart(t);if(null!==e&&!(null===r||e.isEmpty&&r.isEmpty)){var t=Object.keys(e.items),i=Object.keys(r.items),a=[...new Set([...t,...i])],n=[],s=[];for(let t=0;t<a.length;t++){var o=a[t],u=e.items[o],o=r.items[o];if(l.isPlainObject(u)&&l.isPlainObject(o)){if(u.quantity>o.quantity){let{keys:t,...e}=u;n.push(l.extend(!0,{},e,{quantity:e.quantity-o.quantity}))}else if(u.quantity<o.quantity){let{keys:t,...e}=o;s.push(l.extend(!0,{},e,{quantity:e.quantity-u.quantity}))}}else if(l.isPlainObject(u)){let{keys:t,...e}=u;n.push(e)}else{let{keys:t,...e}=o;s.push(e)}}if(0<n.length||0<s.length)for(let t=0;t<this.cartObservers.length;t++)(0,this.cartObservers[t])(s,n,r);return{addedItems:s,removedItems:n,cart:r}}},_updateCart:function(e){if(l.isPlainObject(e)){var t=e.item_count;if("number"==typeof t)if(0===t)this.currentCart={isEmpty:!0,size:0,quantity:0,subTotal:0,items:{},additionalData:{}};else if(l.isArray(e.items)){this.currentCart={isEmpty:!0,size:0,quantity:0,subTotal:0,items:{},additionalData:{}};for(let t=0;t<e.items.length;t++){var r=e.items[t],i=null===(i=Breinify.UTL.toInteger(r.id))?null:""+i;if(null!==i){var a=Breinify.UTL.toInteger(r.quantity);this.currentCart.isEmpty=!1,this.currentCart.size++,this.currentCart.quantity+=null===a?0:a;let e=this.currentCart.items[i];l.isPlainObject(e)||(e={additionalData:{},quantity:0,keys:[]},this.currentCart.items[i]=e),e.id=i,e.name=Breinify.UTL.isNonEmptyString(r.product_title),e.quantity+=a,e.keys.push(r.key);for(let t=0;t<this.additionalItemData.length;t++){var n=this.additionalItemData[t];e.additionalData[n]=r[n]}}}}for(let t=0;t<this.additionalData.length;t++){var s=this.additionalData[t];this.currentCart.additionalData[s]=e[s]}t=Number(e?.items_subtotal_price);this.currentCart.subTotal=Number.isFinite(t)?Math.round(t)/100:0}return this.currentCart}};Breinify.plugins._add("shopify",{setup:function(){var t="boolean"!=typeof(t=this.getConfig("cart::enableRequests",null))||t,e="boolean"!=typeof(e=this.getConfig("cart::captureCartFetchEvents",null))||e,r="number"==typeof(r=this.getConfig("cart::refreshRateInMs",null))?r:2500,i=this.getConfig("cart::observers",null),i=l.isFunction(i)?[i]:i,a=(i=l.isArray(i)?i:null,this.getConfig("cart::additionalData",null)),a=l.isArray(a)?a:[],n=this.getConfig("cart::additionalItemData",null),n=l.isArray(n)?n:[];s.setup({enableCartRequests:t,captureCartFetchEvents:e,refreshRateInMs:r,additionalData:a,additionalItemData:n,cartObservers:i})},cart:{onCartChange:function(t){s.addCartObserver(t)},beforeCartRequest:function(t){s.addBeforeCartObserver(t)},afterCartRequest:function(t){s.addAfterCartObserver(t)},bindLookUpToken:function(t){s.lookUpToken=l.isFunction(t)?function(){return s.parseToken(t())}:null},getToken:function(){return s.getToken()},getCurrentCart:function(){return l.extend(!0,{},s.currentCart)}}})}})();
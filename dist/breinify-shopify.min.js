(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("shopify")){let c=Breinify.UTL._jquery(),r={isSetup:!1,loadedToken:null,lookUpToken:null,currentCart:null,originalFetch:null,observers:[],setup:function(e){if(!0!==this.isSetup){let n=this;if(c.isArray(e.observers))for(let t=0;t<e.observers.length;t++)this.addObserver(e.observers[t]);!0===e.enableCartRequests&&(n._loadCart(),"number"==typeof e.refreshRateInMs)&&10<=e.refreshRateInMs&&window.setInterval(function(){n._loadCart()},e.refreshRateInMs),!0===e.captureCartFetchEvents&&(this.originalFetch=window.fetch,window.fetch=function(){var t=arguments,e=t[0];return"string"==typeof e&&e.startsWith("/cart/")?n.originalFetch.apply(this,t).then(t=>(n._loadCart(),t)):n.originalFetch.apply(this,t)}),this.isSetup=!0}},getToken:function(){let t=c.isFunction(this.lookUpToken)?this.lookUpToken():null;return t="string"==typeof t&&""!==t.trim()?t:this.loadedToken},parseToken:function(t){return"string"==typeof t&&""!==t.trim()?"shopify::cart::"+t.replace(/\?key=[a-z\d]+$/,""):null},addObserver:function(t){c.isFunction(t)&&this.observers.push(t)},_loadCart:function(){let e=this;var t=c.isPlainObject(window.Shopify)&&c.isPlainObject(window.Shopify.routes)&&"string"==typeof window.Shopify.routes.root?window.Shopify.routes.root:"/";c.getJSON(t+"cart.js",function(t){e.loadedToken=e.parseToken(t.token),e._checkCartChanges(t)})},_checkCartChanges:function(t){var s=this.currentCart,o=this._updateCart(t);if(null!==s&&!(null===o||s.isEmpty&&o.isEmpty)){var t=Object.keys(s.items),e=Object.keys(o.items),a=[...new Set([...t,...e])],u=[],l=[];for(let r=0;r<a.length;r++){var h=a[r];let{keys:t,...e}=s.items[h],{keys:n,...i}=o.items[h];c.isPlainObject(e)&&c.isPlainObject(i)?e.quantity>i.quantity?u.push(c.extend(!0,{},e,{quantity:e.quantity-i.quantity})):e.quantity<i.quantity&&l.push(c.extend(!0,{},i,{quantity:i.quantity-e.quantity})):c.isPlainObject(e)?u.push(e):l.push(i)}if(0<u.length||0<l.length)for(let t=0;t<this.observers.length;t++)(0,this.observers[t])(l,u,o)}},_updateCart:function(e){if(c.isPlainObject(e)){var t=e.item_count;if("number"==typeof t)if(0===t)this.currentCart={isEmpty:!0,size:0,quantity:0,items:{}};else if(c.isArray(e.items)){this.currentCart={isEmpty:!0,size:0,quantity:0,items:{}};for(let t=0;t<e.items.length;t++){var n=e.items[t],i=null===(i=Breinify.UTL.toInteger(n.id))?null:""+i;if(null!==i){var r=Breinify.UTL.toInteger(n.quantity);this.currentCart.isEmpty=!1,this.currentCart.size++,this.currentCart.quantity+=null===r?0:r;let t=this.currentCart.items[i];c.isPlainObject(t)||(t={quantity:0,keys:[]},this.currentCart.items[i]=t),t.id=i,t.name=Breinify.UTL.isNonEmptyString(n.product_title),t.quantity+=r,t.keys.push(n.key)}}}}return this.currentCart}};Breinify.plugins._add("shopify",{setup:function(){var t="boolean"!=typeof(t=this.getConfig("cart::enableRequests",null))||t,e="boolean"!=typeof(e=this.getConfig("cart::captureCartFetchEvents",null))||e,n="number"==typeof(n=this.getConfig("cart::refreshRateInMs",null))?n:2500,i=this.getConfig("cart::observers",null),i=c.isFunction(i)?[i]:i;i=c.isArray(i)?i:null,r.setup({enableCartRequests:t,captureCartFetchEvents:e,refreshRateInMs:n,observers:i})},cart:{onCartChange:function(t){r.addObserver(t)},bindLookUpToken:function(t){r.lookUpToken=c.isFunction(t)?function(){return r.parseToken(t())}:null},getToken:function(){return r.getToken()}}})}})();
(()=>{var s,t;"object"!=typeof Breinify||Breinify.plugins._isAdded("recommendations")||(s=Breinify.UTL._jquery(),t=Breinify.plugins._overload(),Breinify.plugins._add("recommendations",{get:function(){t.overload({"Object,Function":function(t,e){this._retrieveRecommendations([t],e)},"Array,Function":function(t,e){this._retrieveRecommendations(null,t,e)},"String,Function":function(t,e){this._retrieveRecommendations([{namedRecommendations:[t]}],e)},"String,Object,Function":function(t,e,n){this._retrieveRecommendations([s.extend({namedRecommendations:[t]},e)],n)}},arguments,this)},_retrieveRecommendations:function(n,i){var a=this;Breinify.recommendation({},n,function(t,e){console.log(t),"string"==typeof e?i(new Error(e)):s.isArray(t.results)?(e=a._mapResults(n,t.results),i(null,e)):i(new Error("Invalid response received."))})},_mapResults:function(t,e){for(var n={},i=0;i<e.length;i++){var a=i<t.length&&s.isPlainObject(t[i])?t[i]:{},r=e[i],o={};this._determineErrorResponse(r,o)||this._determineSplitTestData(r,o)||this._determineRecommendationData(r,o),this._determineAdditionalData(r,o),this._determineMetaData(r,o),r=s.isArray(a.namedRecommendations)&&1===a.namedRecommendations.length?a.namedRecommendations[0]:"response["+i+"]",a="number"==typeof a.numRecommendations&&0<a.numRecommendations?a.numRecommendations:null,o.payload={name:r,expectedNumberOfRecommendations:a},n[r]=o}return n},_determineErrorResponse:function(t,e){return s.isPlainObject(t)?(200===t.statusCode||7120===t.statusCode?e.status={code:t.statusCode,message:t.message,error:!1}:e.status={error:!0,code:t.statusCode,message:t.message},e.status.error):(e.status={error:!0,code:500,message:"invalid result type received"},!0)},_determineRecommendationData:function(t,e){var n="com.brein.common.dto.CustomerProductDto";s.isPlainObject(t)&&s.isPlainObject(t._breinMetaData)&&"string"==typeof t._breinMetaData.dataType&&""!==t._breinMetaData.dataType.trim()&&(n=t._breinMetaData.dataType.trim()),e.recommendations="com.brein.common.dto.CustomerProductDto"===n?this._mapProducts(t):this._mapAny(t)},_determineAdditionalData:function(t,e){},_determineMetaData:function(t,e){},_determineSplitTestData:function(t,e){return s.isPlainObject(t)&&s.isPlainObject(t.additionalData)&&s.isPlainObject(t.additionalData.splitTestData)?e.splitTestData=s.extend({active:!0,isTest:200===t.statusCode,isControl:7120===t.statusCode},t.additionalData.splitTestData):7120===e.statusCode?e.splitTestData={active:!0,isTest:!1,isControl:!1}:e.splitTestData={active:!1,isTest:!1,isControl:!1},e.active},_mapProducts:function(t){if(!s.isArray(t.result))return[];for(var e=[],n=0;n<t.result.length;n++){var i=t.result[n],i=this._mapProduct(i);e.push(i)}return e},_mapProduct:function(t){var e;return s.isPlainObject(t)&&"string"==typeof t.dataIdExternal&&s.isPlainObject(t.additionalData)?(e=null===(e=this._getValue(t,"inventory::productPrice"))?this._getValue(t,"product::productPrice"):e,{_recommenderWeight:t.weight,id:t.dataIdExternal,inventory:this._getValue(t,"inventory::inventoryQuantity"),name:this._getValue(t,"product::productName"),url:this._getValue(t,"product::productUrl"),image:this._getValue(t,"product::productImageUrl"),categories:this._getValue(t,"product::productCategories"),description:this._getValue(t,"product::productDescription"),price:e,additionalData:t.additionalData}):null},_mapAny:function(t){if(!s.isArray(t.result))return[];for(var e=[],n=0;n<t.result.length;n++){var i=t.result[n],i={_recommenderWeight:i.weight,id:i.dataIdExternal,additionalData:i.additionalData};e.push(i)}return e},_getValue:function(t,e){t=t.additionalData[e];return null==t?null:t}}))})();
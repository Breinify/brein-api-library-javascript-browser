"use strict";!function(){if("object"==typeof Breinify){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=(Breinify.UTL.constants.errors.prefix.validation,Breinify.UTL.constants.errors.prefix.api,{get:function(){b.overload({"String,Number,Function":function(a,b,c){this._retrieveRecommendations([a],{},b,{},c)},"Array,Number,Function":function(a,b,c){this._retrieveRecommendations(a,{},b,{},c)},"String,Number,Object,Function":function(a,b,c,d){this._retrieveRecommendations([a],{},b,c,d)},"Array,Number,Object,Function":function(a,b,c,d){this._retrieveRecommendations(a,{},b,c,d)},"String,Object,Number,Function":function(a,b,c,d){this._retrieveRecommendations([a],b,c,{},d)},"Array,Object,Number,Function":function(a,b,c,d){this._retrieveRecommendations(a,b,c,{},d)},"String,Object,Number,Object,Function":function(a,b,c,d,e){this._retrieveRecommendations([a],b,c,d,e)},"Array,Object,Number,Object,Function":function(a,b,c,d,e){this._retrieveRecommendations(a,b,c,d,e)}},arguments,this)},_retrieveRecommendations:function(b,c,d,e,f){var g=this,h=this._createUser(c,e),i=this._createRecommendations(b,d);return a.isPlainObject(i)&&a.isArray(i.payload)&&0!==i.payload.length?void Breinify.recommendation(h,i.payload,function(b,c){if("string"==typeof c)f(new Error(c));else if(a.isArray(b.results)){var e=g._mapResults(i,b.results);e=g._applyRecommendationSettings(d,i,e),f(null,e)}else f(new Error("Invalid response received."))}):void f(null,{})},_getSettings:function(b){var c=this.getConfig("recommendationSettings",{}),d=c[b];return a.isPlainObject(d)?d:{}},_getPayload:function(b){var c=this.getConfig("recommendationPayloads",{}),d=c[b];return a.isPlainObject(d)?d:{}},_applyRecommendationSettings:function(b,c,d){for(var e={},f=[],g=0;g<c.recommendationIds.length;g++){var h=c.recommendationIds[g],i=this._getSettings(h),j=i.filter,k=i.recommendationPayloadId,l=d[k];if(a.isArray(l)){l=this._removeUsedProducts(f,l),a.isFunction(j)&&(l=j(l)),l=l.slice(0,b);for(var m=0;m<l.length;m++)f.push(l[m].dataIdExternal);e[h]=l}else e[h]=[]}return e},_removeUsedProducts:function(b,c){if(!a.isArray(c))return[];for(var d=[],e=0;e<c.length;e++){var f=c[e];a.inArray(f.dataIdExternal,b)===-1&&d.push(f)}return d},_createRecommendations:function(b,c){var d={payload:[],recommendationsPayloadIds:[],payloadIdToRecommendationIds:{},recommendationIds:{}};if(!a.isArray(b))return d;for(var e=[],f={},g=[],h=0;h<b.length;h++){var i=b[h],j=this._getSettings(i);if(a.isPlainObject(j)){var k=j.recommendationPayloadId;a.inArray(k,e)===-1&&e.push(k);var l=f[k];a.isArray(l)||(l=[],f[k]=l),a.inArray(i,l)===-1&&l.push(i),a.inArray(i,g)===-1&&g.push(i)}}if(0===e.length)return d;for(var h=0;h<e.length;h++){var m=e[h],n=this._getPayload(m);if(a.isPlainObject(n)){n=a.extend({},n);var o=n.multiplier;o="number"==typeof o?Math.max(o,1):1,n.numRecommendations=o*c,d.recommendationsPayloadIds.push(m),d.payload.push(n)}}return d.payloadIdToRecommendationIds=f,d.recommendationIds=g,d},_createUser:function(b,c){var d={additional:{}};return a.isPlainObject(b)&&(d.userId="string"==typeof b.userId&&""!==b.userId.trim()?b.userId:null,d.email="string"==typeof b.email&&""!==b.email.trim()?b.email.toLowerCase():null),a.isPlainObject(c)&&(d.additional.location={storeId:"string"==typeof c.storeId&&""!==c.storeId.trim()?c.storeId:null}),d},_mapResults:function(b,c){for(var d={},e=0;e<c.length;e++){var f=c[e].result,g=[];if(a.isArray(f))for(var h=0;h<f.length;h++){var i=this._mapProduct(f[h]);a.isPlainObject(i)&&g.push(i)}var j=b.recommendationsPayloadIds[e];d[j]=g}return d},_mapProduct:function(b){if(!a.isPlainObject(b)||"string"!=typeof b.dataIdExternal)return null;if(!a.isPlainObject(b.additionalData))return null;var c=this.getConfig("mapProduct",function(a){return{dataIdExternal:a.dataIdExternal,sku:a.dataIdExternal,inventory:a.additionalData["inventory::inventoryQuantity"],price:a.additionalData["inventory::productPrice"],name:a.additionalData["product::productName"],url:a.additionalData["product::productUrl"],image:a.additionalData["product::productImageUrl"],description:a.additionalData["product::productDescription"]}});return c(b)}});Breinify.plugins._add("recommendations",c)}}();
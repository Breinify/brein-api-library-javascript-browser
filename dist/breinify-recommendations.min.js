(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("recommendations")){let l=Breinify.UTL._jquery(),e=Breinify.plugins._overload(),i={splitTests:{control:{itemSelector:null,containerSelector:null}},position:{before:null,after:null,prepend:null,append:null,replace:null},placeholders:{"random::uuid":function(){return Breinify.UTL.uuid()}},templates:{container:null,item:null},process:{error:function(e){},init:function(e){},pre:function(e,t){},attachedItem:function(e,t,n,i){},attached:function(e,t,n,i){},post:function(e,t,n,i){}}},s={_process:function(e,...t){return!!l.isFunction(e)&&(e(...t),!0)},_determineSelector:function(e){return"string"==typeof(e=l.isFunction(e)?e():e)?l(e):e instanceof l?e:null},_appendContainer:function(e,t){if(!l.isPlainObject(e)||!l.isPlainObject(e.position))return null;let n=null,i=null;null!==e.position.before?(i=e.position.before,n="before"):null!==e.position.after?(i=options.position.after,n="after"):null!==e.position.append?(i=e.position.append,n="append"):null!==e.position.prepend?(i=e.position.prepend,n="prepend"):null!==e.position.replace&&(i=e.position.replace,n="replace");var r,o=this._determineSelector(i);return null===o||null===(r=this._determineSelector(e.templates.container))?null:(this._replacePlaceholders(r,t,e),l.isFunction(o[n])&&o[n](r),r)},_appendItems:function(i,e,r){let o=this,a=this._determineSelector(r.templates.item);if(null===a)return null;l.each(e.recommendations,function(e,t){var n=o._replacePlaceholders(a.clone(),t,r);i.append(n),s._process(r.process.attachedItem,i,n,t,r)})},_replacePlaceholders:function(i,r,o){let a=this;i.contents().filter(function(){return 3===this.nodeType}).each(function(){var e=l(this),t=a._replace(e.text(),r,o);null!==t&&e.replaceWith(t)});var e=i.get(0).attributes;return l.each(e,function(e,t){var n=a._replace(t.value,r,o);null!==n&&i.attr(t.name,n)}),i.children().each(function(){a._replacePlaceholders(l(this),r,o)}),i},_replace:function(e,a,s){if("string"!=typeof e||""===e.trim())return null;let c={_counter:0};e=e.replace(/%%([a-zA-Z][a-zA-Z0-9_-]*(?:::[a-zA-Z][a-zA-Z0-9_-]*)?)%%/g,function(e,t){var n=s.placeholders[t],i=l.isFunction(n)||"string"==typeof n,t=a[t],r=void 0!==t;let o;return null===(o=i?"string"===n?n:l.isFunction(n)?n.call(s.placeholders,a,r?t:null):null:r?t:null)?e:(c._counter++,o)});return 0<c._counter?e:null}};Breinify.plugins._add("recommendations",{render:function(){let i=this;e.overload({"Object,Object":function(e,n){n=this._preRenderRecommendations(n),this._retrieveRecommendations([e],function(e,t){i._renderRecommendations(n,e,t)})},"Array,Object":function(e,n){n=this._preRenderRecommendations(n),this._retrieveRecommendations(null,e,function(e,t){i._renderRecommendations(n,e,t)})},"String,Object":function(e,n){n=this._preRenderRecommendations(n),this._retrieveRecommendations([{namedRecommendations:[e]}],function(e,t){i._renderRecommendations(n,e,t)})},"String,Object,Object":function(e,t,n){n=this._preRenderRecommendations(n),this._retrieveRecommendations([l.extend({namedRecommendations:[e]},t)],function(e,t){i._renderRecommendations(n,e,t)})}},arguments,this)},get:function(){e.overload({"Object,Function":function(e,t){this._retrieveRecommendations([e],t)},"Array,Function":function(e,t){this._retrieveRecommendations(null,e,t)},"String,Function":function(e,t){this._retrieveRecommendations([{namedRecommendations:[e]}],t)},"String,Object,Function":function(e,t,n){this._retrieveRecommendations([l.extend({namedRecommendations:[e]},t)],n)}},arguments,this)},_preRenderRecommendations:function(e){let n={};return l.each(e,function(e,t){t=l.extend(!0,{},i,t);s._process(t.process.init,t),n[e]=t}),n},_renderRecommendations:function(e,n,i){let r=this;null!==n?l.each(e,function(e,t){s._process(t.process.error,n)}):l.each(e,function(e,t){var n=i[e];l.isPlainObject(n)?!0===n.error?s._process(t.process.error,l.extend({name:e,result:n},n.status)):(!0!==n.splitTestData.isControl&&r._renderRecommendation(t,n),r._applyBindings(t,n)):s._process(t.process.error,{code:-1,error:!0,message:"unexpected result-type received",name:e,result:n})})},_applyBindings:function(e,t){},_renderRecommendation:function(e,t){s._process(e.process.pre,t,e);var n=s._appendContainer(e,t);let i=n.find(".br-rec-item-container");0===i.length&&(i=n),s._appendItems(i,t,e),s._process(e.process.attached,n,i,t,e),s._process(e.process.post,n,i,t,e)},_retrieveRecommendations:function(n,i){let r=this;Breinify.recommendation({},n,function(e,t){"string"==typeof t?i(new Error(t)):l.isArray(e.results)?(t=r._mapResults(n,e.results),i(null,t)):i(new Error("Invalid response received."))})},_mapResults:function(i,r){var o={};for(let n=0;n<r.length;n++){var a=n<i.length&&l.isPlainObject(i[n])?i[n]:{},s=r[n],c={};this._determineErrorResponse(s,c)||this._determineSplitTestData(s,c)||this._determineRecommendationData(s,c),this._determineAdditionalData(s,c),this._determineMetaData(s,c);let e;e=l.isArray(a.namedRecommendations)&&1===a.namedRecommendations.length?a.namedRecommendations[0]:"response["+n+"]";let t;t="number"==typeof a.numRecommendations&&0<a.numRecommendations?a.numRecommendations:null,c.payload={name:e,expectedNumberOfRecommendations:t},o[e]=c}return o},_determineErrorResponse:function(e,t){return l.isPlainObject(e)?(200===e.statusCode||7120===e.statusCode?t.status={code:e.statusCode,message:e.message,error:!1}:t.status={error:!0,code:e.statusCode,message:e.message},t.status.error):(t.status={error:!0,code:500,message:"invalid result type received"},!0)},_determineRecommendationData:function(e,t){let n="com.brein.common.dto.CustomerProductDto";"com.brein.common.dto.CustomerProductDto"===(n=l.isPlainObject(e)&&l.isPlainObject(e._breinMetaData)&&"string"==typeof e._breinMetaData.dataType&&""!==e._breinMetaData.dataType.trim()?e._breinMetaData.dataType.trim():n)?t.recommendations=this._mapProducts(e):t.recommendations=this._mapAny(e)},_determineAdditionalData:function(e,t){},_determineMetaData:function(e,t){},_determineSplitTestData:function(e,t){return l.isPlainObject(e)&&l.isPlainObject(e.additionalData)&&l.isPlainObject(e.additionalData.splitTestData)?t.splitTestData=l.extend({active:!0,isTest:200===e.statusCode,isControl:7120===e.statusCode},e.additionalData.splitTestData):7120===t.statusCode?t.splitTestData={active:!0,isTest:!1,isControl:!1}:t.splitTestData={active:!1,isTest:!1,isControl:!1},t.active},_mapProducts:function(e){if(!l.isArray(e.result))return[];for(var t=[],n=0;n<e.result.length;n++){var i=e.result[n],i=this._mapProduct(i);t.push(i)}return t},_mapProduct:function(e){var t;return l.isPlainObject(e)&&"string"==typeof e.dataIdExternal&&l.isPlainObject(e.additionalData)?(t=null===(t=this._getValue(e,"inventory::productPrice"))?this._getValue(e,"product::productPrice"):t,{_recommenderWeight:e.weight,id:e.dataIdExternal,inventory:this._getValue(e,"inventory::inventoryQuantity"),name:this._getValue(e,"product::productName"),url:this._getValue(e,"product::productUrl"),image:this._getValue(e,"product::productImageUrl"),categories:this._getValue(e,"product::productCategories"),description:this._getValue(e,"product::productDescription"),price:t,additionalData:e.additionalData}):null},_mapAny:function(e){if(!l.isArray(e.result))return[];for(var t=[],n=0;n<e.result.length;n++){var i=e.result[n],i={_recommenderWeight:i.weight,id:i.dataIdExternal,additionalData:i.additionalData};t.push(i)}return t},_getValue:function(e,t){e=e.additionalData[t];return null==e?null:e}})}})();
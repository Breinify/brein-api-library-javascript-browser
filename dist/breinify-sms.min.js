"use strict";!function(){if("object"==typeof Breinify){var a=(Breinify.UTL._jquery(),Breinify.plugins._overload()),b=Breinify.UTL.constants.errors.prefix.validation,c=Breinify.UTL.constants.errors.prefix.api,d={phoneNumberChange:function(){var b=this;a.overload({"String,String,Object,Function":function(a,c,d,e){var f=b.getConfig("source",null),g=b.getConfig("replyMessageKey",null);b._phoneNumberChange(f,g,a,c,d,e)},"String,String,Function":function(a,c,d){var e=b.getConfig("source",null),f=b.getConfig("replyMessageKey",null);b._phoneNumberChange(e,f,a,c,{},d)},"String,String,String,Function":function(a,c,d,e){var f=b.getConfig("replyMessageKey",null);d=Breinify.UTL.isEmpty(d)?b.getConfig("source",null):d,b._phoneNumberChange(d,f,a,c,{},e)},"String,String,Object,String,Function":function(a,c,d,e,f){var g=b.getConfig("replyMessageKey",null);e=Breinify.UTL.isEmpty(e)?b.getConfig("source",null):e,b._phoneNumberChange(e,g,a,c,d,f)},"String,String,String,String,Function":function(a,c,d,e,f){d=Breinify.UTL.isEmpty(d)?b.getConfig("source",null):d,e=Breinify.UTL.isEmpty(e)?b.getConfig("replyMessageKey",null):e,b._phoneNumberChange(d,e,a,c,{},f)},"String,String,Object,String,String,Function":function(a,c,d,e,f,g){e=Breinify.UTL.isEmpty(e)?b.getConfig("source",null):e,f=Breinify.UTL.isEmpty(f)?b.getConfig("replyMessageKey",null):f,b._phoneNumberChange(e,f,a,c,d,g)}},arguments,this)},_phoneNumberChange:function(a,b,c,d,e,f){var g=this,h=Breinify.UTL.internal.cbCollector({_callback:function(a,c){if(null===a)g._phoneNumberChangeValidated(c.source,b,c.from,c.oldPhoneNumber,c.newPhoneNumber,e,f);else for(var d in a)if(a.hasOwnProperty(d)){var h=a[d];f(h);break}},from:function(a,b){h._set("from",a,b)},oldPhoneNumber:function(a,b){h._set("oldPhoneNumber",a,b)},newPhoneNumber:function(a,b){h._set("newPhoneNumber",a,b)},source:function(a,b){h._set("source",a,b)}});this._validatePhoneNumber(this.getConfig("from",null),!0,h.from),this._validatePhoneNumber(c,!1,h.oldPhoneNumber),this._validatePhoneNumber(d,!1,h.newPhoneNumber),this._validateSource(a,h.source)},_phoneNumberChangeValidated:function(a,d,e,f,g,h,i){if(null===e)return void i(new Error(b+"The from-number must be configured (see configuration)."));if(null===f)return void i(new Error(b+"The previous phone-number must be specified."));if(null===a)return void i(new Error(b+"The source must be valid or configured (see configuration)."));Breinify.UTL.isEmpty(g)&&(g=null),Breinify.UTL.isEmpty(d)&&(d=null),h=Breinify.UTL.user.create(h),h.phone=f;var j={source:a,messageServiceIdentifier:e,messageServiceUserIdentifier:h.phone,messageContext:"default",_replyMessageKey:d};Breinify.activity(h,"stopSms",null,null,j,function(a,b){"string"==typeof b?i(new Error(c+b)):i(null,{user:h,tags:j})})},optIn:function(){var b=this;a.overload({"String,Function":function(a,c){var d=b.getConfig("source",null),e=b.getConfig("replyMessageKey",null);b._optIn(d,e,a,{},c)},"String,Object,Function":function(a,c,d){var e=b.getConfig("source",null),f=b.getConfig("replyMessageKey",null);b._optIn(e,f,a,c,d)},"String,Object,String,Function":function(a,c,d,e){var f=b.getConfig("replyMessageKey",null);d=Breinify.UTL.isEmpty(d)?b.getConfig("source",null):d,b._optIn(d,f,a,c,e)},"String,String,Function":function(a,c,d){var e=b.getConfig("replyMessageKey",null);c=Breinify.UTL.isEmpty(c)?b.getConfig("source",null):c,b._optIn(c,e,a,{},d)},"String,String,String,Function":function(a,c,d,e){c=Breinify.UTL.isEmpty(c)?b.getConfig("source",null):c,d=Breinify.UTL.isEmpty(d)?b.getConfig("replyMessageKey",null):d,b._optIn(c,d,a,{},e)}},arguments,this)},_optIn:function(a,b,c,d,e){var f=this,g=Breinify.UTL.internal.cbCollector({_callback:function(a,c){if(null===a)f._optInValidated(c.source,b,c.from,c.phoneNumber,d,e);else for(var g in a)if(a.hasOwnProperty(g)){var h=a[g];e(h);break}},from:function(a,b){g._set("from",a,b)},phoneNumber:function(a,b){g._set("phoneNumber",a,b)},source:function(a,b){g._set("source",a,b)}});this._validatePhoneNumber(this.getConfig("from",null),!0,g.from),this._validatePhoneNumber(c,!1,g.phoneNumber),this._validateSource(a,g.source)},_optInValidated:function(a,d,e,f,g,h){if(null===e)return void h(new Error(b+"The from-number must be configured (see configuration)."));if(null===a)return void h(new Error(b+"The source must be valid or configured (see configuration)."));if(null===f)return void h(new Error(b+"The phone-number must be specified."));Breinify.UTL.isEmpty(d)&&(d=null),g=Breinify.UTL.user.create(g),g.phone=f;var i={source:a,messageServiceIdentifier:e,messageServiceUserIdentifier:g.phone,messageContext:"default",_replyMessageKey:d};Breinify.activity(g,"joinSms",null,null,i,function(a,b){"string"==typeof b?h(new Error(c+b)):h(null,{user:g,tags:i})})},_validateSource:function(a,b){Breinify.UTL.isEmpty(a)?b(null,null):b(null,a)},_validatePhoneNumber:function(a,c,d){return null===a?void d(null,null):("number"==typeof a&&(a=""+a),"string"!=typeof a?void d(new Error(b+"Invalid phone-number defined: "+a)):(a=a.trim(),/\+?\d+/.test(a)?c||0===a.indexOf("+")?void d(null,a):void d(new Error(b+"Phone-number must include the country-code (e.g., +1): "+a)):void d(new Error(b+"Invalid phone-number defined: "+a))))}};Breinify.plugins._add("sms",d)}}();
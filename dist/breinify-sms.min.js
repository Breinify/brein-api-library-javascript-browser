"use strict";!function(){var e,s,f;"object"==typeof Breinify&&(Breinify.plugins._isAdded("sms")||(Breinify.UTL._jquery(),e=Breinify.plugins._overload(),s=Breinify.UTL.constants.errors.prefix.validation,f=Breinify.UTL.constants.errors.prefix.api,Breinify.plugins._add("sms",{phoneNumberChange:function(){var u=this;e.overload({"String,String,Object,Function":function(e,n,i,r){var t=u.getConfig("source",null),o=u.getConfig("replyMessageKey",null);u._phoneNumberChange(t,o,e,n,i,r)},"String,String,Function":function(e,n,i){var r=u.getConfig("source",null),t=u.getConfig("replyMessageKey",null);u._phoneNumberChange(r,t,e,n,{},i)},"String,String,String,Function":function(e,n,i,r){var t=u.getConfig("replyMessageKey",null);i=Breinify.UTL.isEmpty(i)?u.getConfig("source",null):i,u._phoneNumberChange(i,t,e,n,{},r)},"String,String,Object,String,Function":function(e,n,i,r,t){var o=u.getConfig("replyMessageKey",null);r=Breinify.UTL.isEmpty(r)?u.getConfig("source",null):r,u._phoneNumberChange(r,o,e,n,i,t)},"String,String,String,String,Function":function(e,n,i,r,t){i=Breinify.UTL.isEmpty(i)?u.getConfig("source",null):i,r=Breinify.UTL.isEmpty(r)?u.getConfig("replyMessageKey",null):r,u._phoneNumberChange(i,r,e,n,{},t)},"String,String,Object,String,String,Function":function(e,n,i,r,t,o){r=Breinify.UTL.isEmpty(r)?u.getConfig("source",null):r,t=Breinify.UTL.isEmpty(t)?u.getConfig("replyMessageKey",null):t,u._phoneNumberChange(r,t,e,n,i,o)}},arguments,this)},_phoneNumberChange:function(e,r,n,i,t,o){var u=this,l=Breinify.UTL.internal.cbCollector({_callback:function(e,n){if(null===e)u._phoneNumberChangeValidated(n.source,r,n.from,n.oldPhoneNumber,n.newPhoneNumber,t,o);else for(var i in e)if(e.hasOwnProperty(i)){i=e[i];o(i);break}},from:function(e,n){l._set("from",e,n)},oldPhoneNumber:function(e,n){l._set("oldPhoneNumber",e,n)},newPhoneNumber:function(e,n){l._set("newPhoneNumber",e,n)},source:function(e,n){l._set("source",e,n)}});this._validatePhoneNumber(this.getConfig("from",null),!0,l.from),this._validatePhoneNumber(n,!1,l.oldPhoneNumber),this._validatePhoneNumber(i,!1,l.newPhoneNumber),this._validateSource(e,l.source)},_phoneNumberChangeValidated:function(e,n,i,r,t,o,u){var l;null!==i?null!==r?null!==e?(Breinify.UTL.isEmpty(t)&&(t=null),Breinify.UTL.isEmpty(n)&&(n=null),(o=Breinify.UTL.user.create(o)).phone=r,l={source:e,messageServiceIdentifier:i,messageServiceUserIdentifier:o.phone,messageContext:"default",_replyMessageKey:n},Breinify.activity(o,"stopSms",null,null,l,function(e,n){"string"==typeof n?u(new Error(f+n)):u(null,{user:o,tags:l})})):u(new Error(s+"The source must be valid or configured (see configuration).")):u(new Error(s+"The previous phone-number must be specified.")):u(new Error(s+"The from-number must be configured (see configuration)."))},optIn:function(){var o=this;e.overload({"String,Function":function(e,n){var i=o.getConfig("source",null),r=o.getConfig("replyMessageKey",null);o._optIn(i,r,e,{},n)},"String,Object,Function":function(e,n,i){var r=o.getConfig("source",null),t=o.getConfig("replyMessageKey",null);o._optIn(r,t,e,n,i)},"String,Object,String,Function":function(e,n,i,r){var t=o.getConfig("replyMessageKey",null);i=Breinify.UTL.isEmpty(i)?o.getConfig("source",null):i,o._optIn(i,t,e,n,r)},"String,String,Function":function(e,n,i){var r=o.getConfig("replyMessageKey",null);n=Breinify.UTL.isEmpty(n)?o.getConfig("source",null):n,o._optIn(n,r,e,{},i)},"String,String,String,Function":function(e,n,i,r){n=Breinify.UTL.isEmpty(n)?o.getConfig("source",null):n,i=Breinify.UTL.isEmpty(i)?o.getConfig("replyMessageKey",null):i,o._optIn(n,i,e,{},r)}},arguments,this)},_optIn:function(e,r,n,t,o){var u=this,i=Breinify.UTL.internal.cbCollector({_callback:function(e,n){if(null===e)u._optInValidated(n.source,r,n.from,n.phoneNumber,t,o);else for(var i in e)if(e.hasOwnProperty(i)){i=e[i];o(i);break}},from:function(e,n){i._set("from",e,n)},phoneNumber:function(e,n){i._set("phoneNumber",e,n)},source:function(e,n){i._set("source",e,n)}});this._validatePhoneNumber(this.getConfig("from",null),!0,i.from),this._validatePhoneNumber(n,!1,i.phoneNumber),this._validateSource(e,i.source)},_optInValidated:function(e,n,i,r,t,o){var u;null!==i?null!==e?null!==r?(Breinify.UTL.isEmpty(n)&&(n=null),(t=Breinify.UTL.user.create(t)).phone=r,u={source:e,messageServiceIdentifier:i,messageServiceUserIdentifier:t.phone,messageContext:"default",_replyMessageKey:n},Breinify.activity(t,"joinSms",null,null,u,function(e,n){"string"==typeof n?o(new Error(f+n)):o(null,{user:t,tags:u})})):o(new Error(s+"The phone-number must be specified.")):o(new Error(s+"The source must be valid or configured (see configuration).")):o(new Error(s+"The from-number must be configured (see configuration)."))},_validateSource:function(e,n){Breinify.UTL.isEmpty(e)?n(null,null):n(null,e)},_validatePhoneNumber:function(e,n,i){null!==e?"string"==typeof(e="number"==typeof e?""+e:e)?(e=e.trim(),/\+?\d+/.test(e)?n||0===e.indexOf("+")?i(null,e):i(new Error(s+"Phone-number must include the country-code (e.g., +1): "+e)):i(new Error(s+"Invalid phone-number defined: "+e))):i(new Error(s+"Invalid phone-number defined: "+e)):i(null,null)}})))}();
"use strict";!function(){var T,t,y,o,r,a,s,n;"object"==typeof Breinify&&(Breinify.plugins._isAdded("activities")||(T=Breinify.UTL._jquery(),t=Breinify.plugins._overload(),y=Breinify.UTL.constants.errors.prefix.validation,o=Breinify.UTL.constants.errors.prefix.api,r=Breinify.UTL.uuid(),s={initialized:!(a=function(t,n){if("ga"!==t.type)throw new Error("Using currently unavailable type: "+t.type);return{hitType:"event",eventCategory:"breinify",eventAction:n.type,eventLabel:n.tags.id,eventValue:1}}),type:null,instance:null,mapper:null,init:function(n,e){var i=this;if(!0!==this.initialized){var c=this._determineType(n.type);switch(c){case"ga":this._waitForInstance("ga",function(t){ga(function(){i.type=c,i.instance=i._determineGaInstance(ga.getAll(),n.trackerId),i.mapper=T.isFunction(n.mapper)?n.mapper:a,i.initialized=!0,e(i.initialized)})});break;case"gtag":i.type=c;default:throw new Error("Using currently unavailable type: "+c)}}else e(!0)},handle:function(t,n){var e=this;this.init(t,function(t){if(!1!==t){t=e.mapper(e,n);if(null!==t){if("ga"!==e.type)throw new Error("Using currently unavailable type: "+gaType);e.instance.send(t)}}})},_waitForInstance:function(t,n,e){var i,c=window[t];null!=c?n(c):5e3<=e?console.error(t+" enabled but not available (waited "+e+" [ms])."):(i=this,setTimeout(function(){i._waitForInstance(t,n,("number"==typeof e?e:0)+50)},50))},_determineGaInstance:function(t,n){var e="string"==typeof n?n:null;if(!T.isArray(t)||t.length<0)throw new Error("Unable to determine instance.");if(1===t.length&&null===e)return t[0];for(var i=0;i<t.length;i++)if(t[i].get("trackingId")===e)return t[i];throw null===e?new Error("Please specify trackingId of trackers to be used, found: "+t.length):new Error("Unable to determine instance with trackingId: "+e)},_determineType:function(t){t="string"==typeof t?t.toLowerCase():null;if("ga"===t||"gtag"===t)return t;if("function"==typeof ga)return"ga";if("function"==typeof gtag)return"gtag";throw new Error("Unable to determine type, please specify.")},_applyDefaultMapping:function(t){return a(this,t)}},n=Breinify.plugins._add("activities",{generic:function(){var c=this;t.overload({"String,Object":function(t,n){c._send(t,n,{},null)},"String,Object,Object":function(t,n,e){c._send(t,n,e,null)},"String,Object,Object,Function":function(t,n,e,i){c._send(t,n,e,i)}},arguments,this)},pageVisit:function(){var i="pageVisit",c=this;t.overload({"":function(){c._send(i,{},{pageId:window.location.pathname},null)},Function:function(t){c._send(i,{},{pageId:window.location.pathname},t)},"String,Function":function(t,n){c._send(i,{},{pageId:t},n)},String:function(t){c._send(i,{},{pageId:t},null)},"String,Object,Function":function(t,n,e){c._send(i,n,{pageId:t},e)},"String,Object":function(t,n){c._send(i,n,{pageId:t},null)},"Object,Function":function(t,n){c._send(i,{},t,n)},Object:function(t){c._send(i,{},t,null)},"Object,Object,Function":function(t,n,e){c._send(i,t,n,e)},"Object,Object":function(t,n){c._send(i,t,n,null)}},arguments,this)},identify:function(){var i="identify",c=this;t.overload({"Object,Function":function(t,n){c._send(i,t,{},n)},"Object,Object,Function":function(t,n,e){c._send(i,t,n,e)},Object:function(t){c._send(i,t,{},null)},"Object,Object":function(t,n){c._send(i,t,n,null)}},arguments,this)},viewedProduct:function(){t.overload(this._productMethods("viewedProduct"),arguments,this)},addToCart:function(){t.overload(this._productMethods("addToCart"),arguments,this)},removeFromCart:function(){t.overload(this._productMethods("removeFromCart"),arguments,this)},checkOut:function(){var a="checkOut",s=this;t.overload({"String,Array,Object,Object,Array,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Object,Object,Object,Array,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,String,Object,Object,Array,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Array,Object,Object,Object,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Object,Object,Object,Object,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,String,Object,Object,Object,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Array,Object,Object,String,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Object,Object,Object,String,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,String,Object,Object,String,Object,Function":function(t,n,e,i,c,o,r){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o,r)},"String,Array,Object,Array,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Object,Object,Array,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,String,Object,Array,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Array,Object,Object,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Object,Object,Object,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,String,Object,Object,Object,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Array,Object,Object,String,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Object,Object,Object,String,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,String,Object,Object,String,Object":function(t,n,e,i,c,o){o=s._mapCheckOutToTags(t,n,e,i,o),s._send(a,c,o)},"String,Array,Object,Object,Array,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Object,Object,Object,Array,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,String,Object,Object,Array,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Array,Object,Object,Object,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Object,Object,Object,Object,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,String,Object,Object,Object,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Array,Object,Object,String,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Array,Object,Array,Object,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Object,Object,Object,String,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,String,Object,Object,String,Function":function(t,n,e,i,c,o){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t,o)},"String,Array,Object,Array,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,Object,Object,Array,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,String,Object,Array,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,Array,Object,Object,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,Object,Object,Object,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,String,Object,Object,Object":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,Array,Object,Object,String":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,Object,Object,Object,String":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)},"String,String,Object,Object,String":function(t,n,e,i,c){t=s._mapCheckOutToTags(t,n,e,i,{});s._send(a,c,t)}},arguments,this)},scheduleDelayedActivity:function(t,n,e,i,c,o){t={user:t,tags:e,type:n,maxAgeInMs:i,filter:c,timestamp:(new Date).getTime()},e=Breinify.UTL.cookies.delayedActivities,n={},Breinify.UTL.cookie.check(e)&&(n=Breinify.UTL.cookie.getJson(e)),i="string"==typeof o?o:Breinify.UTL.uuid(),n[i]=t,c=Breinify.UTL.cookie.domain();return Breinify.UTL.cookie.setJson(e,n,null,!0,c),i},readDelayedActivityData:function(t){var n=Breinify.UTL.cookies.delayedActivities,n=Breinify.UTL.cookie.getJson(n);return T.isPlainObject(n)&&T.isPlainObject(n[t])?n[t]:null},hasDelayedActivityData:function(n){var t="string"==typeof n?function(t){return t===n}:T.isFunction(n)?n:n instanceof RegExp?function(t){return n.test(t)}:function(){return!1},e=Breinify.UTL.cookies.delayedActivities,e=Breinify.UTL.cookie.getJson(e);return!(null===e||!T.isPlainObject(e))&&0<T.grep(e,t).length},removeDelayedActivityData:function(t){var n=Breinify.UTL.cookie.domain(),e=Breinify.UTL.cookies.delayedActivities,i=Breinify.UTL.cookie.getJson(e);delete i[t],Breinify.UTL.cookie.setJson(e,i,null,!0,n)},checkDelayedActivityData:function(){var t=Breinify.UTL.cookies.delayedActivities,t=Breinify.UTL.cookie.getJson(t),e=this;T.each(t,function(t,n){e._checkDelayedActivityData(t,n)})},_checkDelayedActivityData:function(t,n){if("string"==typeof n.type&&(T.isPlainObject(n.tags)||void 0===n.tags||null===n.tags)&&(T.isPlainObject(n.user)||void 0===n.user||null===n.user)){var e=(new Date).getTime();if(("number"==typeof n.maxAgeInMs&&0<n.maxAgeInMs?n.timestamp+n.maxAgeInMs:e)<e)this.removeDelayedActivityData(t);else{var c,e=n.filter,i="string"==typeof e?e.split("::"):[],e=null,o=null;if(2<=i.length){for(var o=Breinify.plugins[i[0]],r=1;r<i.length-1;r++)o=T.isPlainObject(o)?o[i[r]]:null;e=i[i.length-1]}else e=1===i.length?(o=window,i[0]):o=null;"object"!=typeof o||"string"!=typeof e||null===o?(this._send(n.type,n.user,n.tags),this.removeDelayedActivityData(t)):T.isFunction(o[e])&&(c=this,o[e].apply(o,[t,n,function(t,n,e,i){!0===e?(c._send(n.type,n.user,n.tags),c.removeDelayedActivityData(t)):!0===i&&c.removeDelayedActivityData(t)}]))}}},_productMethods:function(c){var o=this;return{"Array,Function":function(t,n){t=o._mapProductsToTags(t);o._send(c,{},t,n)},"Object,Function":function(t,n){t=o._mapProductsToTags(t);o._send(c,{},t,n)},"String,Function":function(t,n){t=o._mapProductsToTags(t);o._send(c,{},t,n)},String:function(t){t=o._mapProductsToTags(t);o._send(c,{},t,null)},Array:function(t){t=o._mapProductsToTags(t);o._send(c,{},t,null)},Object:function(t){t=o._mapProductsToTags(t);o._send(c,{},t,null)},"String,Object,Function":function(t,n,e){t=o._mapProductsToTags(t);o._send(c,n,t,e)},"Array,Object,Function":function(t,n,e){t=o._mapProductsToTags(t);o._send(c,n,t,e)},"Object,Object,Function":function(t,n,e){t=o._mapProductsToTags(t);o._send(c,n,t,e)},"String,Object":function(t,n){t=o._mapProductsToTags(t);o._send(c,n,t,null)},"Array,Object":function(t,n){t=o._mapProductsToTags(t);o._send(c,n,t,null)},"Object,Object":function(t,n){t=o._mapProductsToTags(t);o._send(c,n,t,null)},"String,Object,Object,Function":function(t,n,e,i){e=o._mapProductsToTags(t,e),o._send(c,n,e,i)},"Array,Object,Object,Function":function(t,n,e,i){e=o._mapProductsToTags(t,e),o._send(c,n,e,i)},"Object,Object,Object,Function":function(t,n,e,i){e=o._mapProductsToTags(t,e),o._send(c,n,e,i)},"String,Object,Object":function(t,n,e){e=o._mapProductsToTags(t,e),o._send(c,n,e,null)},"Array,Object,Object":function(t,n,e){e=o._mapProductsToTags(t,e),o._send(c,n,e,null)},"Object,Object,Object":function(t,n,e){e=o._mapProductsToTags(t,e),o._send(c,n,e,null)}}},_mapCheckOutToTags:function(t,n,e,i,c){return c=this._mapProductsToTags(n,c),c=this._mapPromotionsToTags(i,c),T.isPlainObject(e)&&(c.transactionPriceTotal="number"==typeof e.priceTotal?e.priceTotal:0,c.transactionTaxTotal="number"==typeof e.taxTotal?e.taxTotal:0,c.transactionDiscountTotal="number"==typeof e.discountTotal?e.discountTotal:0,c.transactionMiscTotal="number"==typeof e.miscTotal?e.miscTotal:0,c.transactionTotal="number"==typeof e.total?e.total:c.transactionPriceTotal+c.transactionTaxTotal+c.transactionMiscTotal-c.transactionDiscountTotal),c.transactionId=t,c},_mapProductsToTags:function(t,n){if(T.isPlainObject(t))return this._mapProductsToTags([t],n);if("string"==typeof t)return this._mapProductsToTags([{id:t}],n);if(null==t)return n;if(!T.isArray(t))throw new Error(y+"The defined `products` are invalid: "+JSON.stringify(t));for(var e=t.length,i=0<e,c=0<e,o=0<e,r=0<e,l=[],g=[],d=[],f=[],a=0;a<e;a++){var s=t[a],u=null,O=null,b=null,p=null;"string"==typeof s?u=s:T.isPlainObject(s)&&(u="string"==typeof s.id?s.id.trim():null,O="number"==typeof s.quantity?s.quantity:null,b="number"==typeof s.price?s.price:null,p="string"==typeof s.category?s.category.trim():null),o=o&&!Breinify.UTL.isEmpty(u),i=i&&!Breinify.UTL.isEmpty(O),c=c&&!Breinify.UTL.isEmpty(b),r=r&&!Breinify.UTL.isEmpty(p),d.push(u),g.push(b),l.push(O),f.push(p)}if(o)return T.extend(!0,{},n,{productQuantities:i?l:null,productPrices:c?g:null,productIds:o?d:null,productCategories:r?f:null});throw new Error("Products must have an identifier: "+JSON.stringify(t))},_mapPromotionsToTags:function(t,n){if(T.isPlainObject(t))return this._mapPromotionsToTags([t],n);if("string"==typeof t)return this._mapPromotionsToTags([{id:t}],n);if(null==t)return n;if(!T.isArray(t))throw new Error(y+"The defined `promotions` are invalid: "+JSON.stringify(t));if(0===t.length)return n;for(var e=t.length,i=0<e,c=0<e,o=[],l=[],r=0;r<e;r++){var a=t[r],s=null,u=null;"string"==typeof a?s=a:T.isPlainObject(a)&&(s="string"==typeof a.id?a.id.trim():null,u="number"==typeof a.amount?a.amount:null),i=i&&!Breinify.UTL.isEmpty(s),c=c&&!Breinify.UTL.isEmpty(u),l.push(s),o.push(u)}if(i)return T.extend(!0,{},n,{promotionIds:i?l:null,promotionAmounts:c?o:null});throw new Error("Promotions must have an identifier: "+JSON.stringify(t))},_extendTags:function(t,n){var e=this.getConfig("tagsExtender",function(t){return{}});return T.isPlainObject(n)||(n={}),null!==e&&T.isFunction(e)?T.extend({pageId:window.location.pathname,title:document.title},e(t),n):T.extend({pageId:window.location.pathname,title:document.title},n)},_send:function(t,e,i,c){e=Breinify.UTL.user.create(e),(i=this._extendTags(t,i)).id="string"==typeof i.id?i.id:Breinify.UTL.uuid(),i.originId=r,Breinify.activity(e,t,null,null,i,function(t,n){"function"!=typeof c||("string"==typeof n?c(new Error(o+n)):c(null,{user:e,tags:i}))});var n=this.getConfig("googleAnalytics",{enabled:!1});T.isPlainObject(n)&&!0===n.enabled&&s.handle(n,{user:e,type:t,tags:i})}}),Breinify.onReady(function(){n.checkDelayedActivityData()})))}();
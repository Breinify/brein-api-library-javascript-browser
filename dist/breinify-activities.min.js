"use strict";!function(){if("object"==typeof Breinify&&!Breinify.plugins._isAdded("activities")){var a=Breinify.UTL._jquery(),b=Breinify.plugins._overload(),c=Breinify.UTL.constants.errors.prefix.validation,d=Breinify.UTL.constants.errors.prefix.api,e=function(a,b){switch(a.type){case"ga":return{hitType:"event",eventCategory:"breinify",eventAction:b.type,eventLabel:b.tags.id,eventValue:1};case"gtag":default:throw new Error("Using currently unavailable type: "+a.type)}},f={initialized:!1,type:null,instance:null,mapper:null,init:function(b,c){var d=this;if(this.initialized===!0)return void c(!0);var f=this._determineType(b.type);switch(f){case"ga":ga(function(){d.type=f,d.instance=d._determineGaInstance(ga.getAll(),b.trackerId),d.mapper=a.isFunction(b.mapper)?b.mapper:e,d.initialized=!0,c(d.initialized)});break;case"gtag":d.type=f;default:throw new Error("Using currently unavailable type: "+f)}},handle:function(a,b){var c=this;this.init(a,function(a){if(a!==!1){var d=c.mapper(c,b);switch(c.type){case"ga":c.instance.send(d);break;default:throw new Error("Using currently unavailable type: "+gaType)}}})},_determineGaInstance:function(b,c){var d="string"==typeof c?c:null;if(!a.isArray(b)||b.length<0)throw new Error("Unable to determine instance.");if(1===b.length&&null===d)return b[0];for(var e=0;e<b.length;e++)if(b[e].get("trackingId")===d)return b[e];throw null===d?new Error("Please specify trackingId of trackers to be used, found: "+b.length):new Error("Unable to determine instance with trackingId: "+d)},_determineType:function(a){var b="string"==typeof a?a.toLowerCase():null;if("ga"===b||"gtag"===b)return b;if("function"==typeof ga)return"ga";if("function"==typeof gtag)return"gtag";throw new Error("Unable to determine type, please specify.")},_applyDefaultMapping:function(a){return e(this,a)}},g={generic:function(){var a=this;b.overload({"String,Object":function(b,c){a._send(b,c,{},null)},"String,Object,Object":function(b,c,d){a._send(b,c,d,null)},"String,Object,Object,Function":function(b,c,d,e){a._send(b,c,d,e)}},arguments,this)},pageVisit:function(){var a="pageVisit",c=this;b.overload({"":function(){c._send(a,{},{pageId:window.location.pathname},null)},Function:function(b){c._send(a,{},{pageId:window.location.pathname},b)},"String,Function":function(b,d){c._send(a,{},{pageId:b},d)},String:function(b){c._send(a,{},{pageId:b},null)},"String,Object,Function":function(b,d,e){c._send(a,d,{pageId:b},e)},"String,Object":function(b,d){c._send(a,d,{pageId:b},null)},"Object,Function":function(b,d){c._send(a,{},b,d)},Object:function(b){c._send(a,{},b,null)},"Object,Object,Function":function(b,d,e){c._send(a,b,d,e)},"Object,Object":function(b,d){c._send(a,b,d,null)}},arguments,this)},identify:function(){var a="identify",c=this;b.overload({"Object,Function":function(b,d){c._send(a,b,{},d)},"Object,Object,Function":function(b,d,e){c._send(a,b,d,e)},Object:function(b){c._send(a,b,{},null)},"Object,Object":function(b,d){c._send(a,b,d,null)}},arguments,this)},viewedProduct:function(){b.overload(this._productMethods("viewedProduct"),arguments,this)},addToCart:function(){b.overload(this._productMethods("addToCart"),arguments,this)},removeFromCart:function(){b.overload(this._productMethods("removeFromCart"),arguments,this)},checkOut:function(){var a="checkOut",c=this;b.overload({"String,Array,Object,Object,Array,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Object,Object,Object,Array,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,String,Object,Object,Array,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Array,Object,Object,Object,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Object,Object,Object,Object,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,String,Object,Object,Object,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Array,Object,Object,String,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Object,Object,Object,String,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,String,Object,Object,String,Object,Function":function(b,d,e,f,g,h,i){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h,i)},"String,Array,Object,Array,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Object,Object,Array,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,String,Object,Array,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Array,Object,Object,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Object,Object,Object,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,String,Object,Object,Object,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Array,Object,Object,String,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Object,Object,Object,String,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,String,Object,Object,String,Object":function(b,d,e,f,g,h){h=c._mapCheckOutToTags(b,d,e,f,h),c._send(a,g,h)},"String,Array,Object,Object,Array,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Object,Object,Object,Array,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,String,Object,Object,Array,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Array,Object,Object,Object,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Object,Object,Object,Object,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,String,Object,Object,Object,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Array,Object,Object,String,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Object,Object,Object,String,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,String,Object,Object,String,Function":function(b,d,e,f,g,h){var i=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,i,h)},"String,Array,Object,Array,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,Object,Object,Array,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,String,Object,Array,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,Array,Object,Object,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,Object,Object,Object,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,String,Object,Object,Object":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,Array,Object,Object,String":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,Object,Object,Object,String":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)},"String,String,Object,Object,String":function(b,d,e,f,g){var h=c._mapCheckOutToTags(b,d,e,f,{});c._send(a,g,h)}},arguments,this)},scheduleDelayedActivity:function(a,b,c,d,e,f){var g={user:a,tags:c,type:b,maxAgeInMs:d,filter:e,timestamp:(new Date).getTime()},h=Breinify.UTL.cookies.delayedActivities,i={};Breinify.UTL.cookie.check(h)&&(i=Breinify.UTL.cookie.getJson(h));var j="string"==typeof f?f:Breinify.UTL.uuid();i[j]=g;var k=Breinify.UTL.cookie.domain();return Breinify.UTL.cookie.setJson(h,i,null,!0,k),j},readDelayedActivityData:function(b){var c=Breinify.UTL.cookies.delayedActivities,d=Breinify.UTL.cookie.getJson(c);return a.isPlainObject(d)&&a.isPlainObject(d[b])?d[b]:null},hasDelayedActivityData:function(b){var c;c="string"==typeof b?function(a){return a===b}:a.isFunction(b)?b:b instanceof RegExp?function(a){return b.test(a)}:function(){return!1};var d=Breinify.UTL.cookies.delayedActivities,e=Breinify.UTL.cookie.getJson(d);return!(null===e||!a.isPlainObject(e))&&a.grep(e,c).length>0},removeDelayedActivityData:function(a){var b=Breinify.UTL.cookie.domain(),c=Breinify.UTL.cookies.delayedActivities,d=Breinify.UTL.cookie.getJson(c);delete d[a],Breinify.UTL.cookie.setJson(c,d,null,!0,b)},checkDelayedActivityData:function(){var b=Breinify.UTL.cookies.delayedActivities,c=Breinify.UTL.cookie.getJson(b),d=this;a.each(c,function(a,b){d._checkDelayedActivityData(a,b)})},_checkDelayedActivityData:function(b,c){if("string"==typeof c.type&&(a.isPlainObject(c.tags)||"undefined"==typeof c.tags||null===c.tags)&&(a.isPlainObject(c.user)||"undefined"==typeof c.user||null===c.user)){var d=(new Date).getTime(),e="number"==typeof c.maxAgeInMs&&c.maxAgeInMs>0?c.timestamp+c.maxAgeInMs:d;if(e<d)return void this.removeDelayedActivityData(b);var f=c.filter,g="string"==typeof f?f.split("::"):[],h=null,i=null;if(g.length>=2){i=Breinify.plugins[g[0]];for(var j=1;j<g.length-1;j++)i=a.isPlainObject(i)?i[g[j]]:null;h=g[g.length-1]}else 1===g.length?(i=window,h=g[0]):(i=null,h=null);if("object"!=typeof i||"string"!=typeof h||null===i)this._send(c.type,c.user,c.tags);else if(a.isFunction(i[h])){var k=this;i[h].apply(i,[b,c,function(a,b,c,d){c===!0?(k._send(b.type,b.user,b.tags),k.removeDelayedActivityData(a)):d===!0&&k.removeDelayedActivityData(a)}])}}},_productMethods:function(a){var b=this;return{"Array,Function":function(c,d){var e=b._mapProductsToTags(c);b._send(a,{},e,d)},"Object,Function":function(c,d){var e=b._mapProductsToTags(c);b._send(a,{},e,d)},"String,Function":function(c,d){var e=b._mapProductsToTags(c);b._send(a,{},e,d)},String:function(c){var d=b._mapProductsToTags(c);b._send(a,{},d,null)},Array:function(c){var d=b._mapProductsToTags(c);b._send(a,{},d,null)},Object:function(c){var d=b._mapProductsToTags(c);b._send(a,{},d,null)},"String,Object,Function":function(c,d,e){var f=b._mapProductsToTags(c);b._send(a,d,f,e)},"Array,Object,Function":function(c,d,e){var f=b._mapProductsToTags(c);b._send(a,d,f,e)},"Object,Object,Function":function(c,d,e){var f=b._mapProductsToTags(c);b._send(a,d,f,e)},"String,Object":function(c,d){var e=b._mapProductsToTags(c);b._send(a,d,e,null)},"Array,Object":function(c,d){var e=b._mapProductsToTags(c);b._send(a,d,e,null)},"Object,Object":function(c,d){var e=b._mapProductsToTags(c);b._send(a,d,e,null)},"String,Object,Object,Function":function(c,d,e,f){e=b._mapProductsToTags(c,e),b._send(a,d,e,f)},"Array,Object,Object,Function":function(c,d,e,f){e=b._mapProductsToTags(c,e),b._send(a,d,e,f)},"Object,Object,Object,Function":function(c,d,e,f){e=b._mapProductsToTags(c,e),b._send(a,d,e,f)},"String,Object,Object":function(c,d,e){e=b._mapProductsToTags(c,e),b._send(a,d,e,null)},"Array,Object,Object":function(c,d,e){e=b._mapProductsToTags(c,e),b._send(a,d,e,null)},"Object,Object,Object":function(c,d,e){e=b._mapProductsToTags(c,e),b._send(a,d,e,null)}}},_mapCheckOutToTags:function(b,c,d,e,f){return f=this._mapProductsToTags(c,f),f=this._mapPromotionsToTags(e,f),a.isPlainObject(d)&&(f.transactionPriceTotal="number"==typeof d.priceTotal?d.priceTotal:0,f.transactionTaxTotal="number"==typeof d.taxTotal?d.taxTotal:0,f.transactionDiscountTotal="number"==typeof d.discountTotal?d.discountTotal:0,f.transactionMiscTotal="number"==typeof d.miscTotal?d.miscTotal:0,f.transactionTotal="number"==typeof d.total?d.total:f.transactionPriceTotal+f.transactionTaxTotal+f.transactionMiscTotal-f.transactionDiscountTotal),f.transactionId=b,f},_mapProductsToTags:function(b,d){if(a.isPlainObject(b))return this._mapProductsToTags([b],d);if("string"==typeof b)return this._mapProductsToTags([{id:b}],d);if("undefined"==typeof b||null===b)return d;if(!a.isArray(b))throw new Error(c+"The defined `products` are invalid: "+JSON.stringify(b));for(var e=b.length,f=e>0,g=e>0,h=e>0,i=e>0,j=[],k=[],l=[],m=[],n=0;n<e;n++){var o=b[n],p=null,q=null,r=null,s=null;"string"==typeof o?p=o:a.isPlainObject(o)&&(p="string"==typeof o.id?o.id.trim():null,q="number"==typeof o.quantity?o.quantity:null,r="number"==typeof o.price?o.price:null,s="string"==typeof o.category?o.category.trim():null),h=h&&!Breinify.UTL.isEmpty(p),f=f&&!Breinify.UTL.isEmpty(q),g=g&&!Breinify.UTL.isEmpty(r),i=i&&!Breinify.UTL.isEmpty(s),l.push(p),k.push(r),j.push(q),m.push(s)}if(h)return a.extend(!0,{},d,{productQuantities:f?j:null,productPrices:g?k:null,productIds:h?l:null,productCategories:i?m:null});throw new Error("Products must have an identifier: "+JSON.stringify(b))},_mapPromotionsToTags:function(b,d){if(a.isPlainObject(b))return this._mapPromotionsToTags([b],d);if("string"==typeof b)return this._mapPromotionsToTags([{id:b}],d);if("undefined"==typeof b||null===b)return d;if(!a.isArray(b))throw new Error(c+"The defined `promotions` are invalid: "+JSON.stringify(b));for(var e=b.length,f=e>0,g=[],h=[],i=0;i<e;i++){var j=b[i],k=null,l=null;"string"==typeof j?k=j:a.isPlainObject(j)&&(k="string"==typeof j.id?j.id.trim():null,l="number"==typeof j.amount?j.amount:null),f=f&&!Breinify.UTL.isEmpty(k),h.push(k),g.push(l)}if(f)return a.extend(!0,{},d,{promotionIds:f?h:null,promotionAmounts:f?g:null});throw new Error("Promotions must have an identifier: "+JSON.stringify(b))},_send:function(b,c,e,g){c=Breinify.UTL.user.create(c),e=a.isPlainObject(e)?e:{},e.id="string"==typeof e.id?e.id:Breinify.UTL.uuid(),Breinify.activity(c,b,null,null,e,function(a,b){"function"!=typeof g||("string"==typeof b?g(new Error(d+b)):g(null,{user:c,tags:e}))});var h=this.getConfig("googleAnalytics",{enabled:!1});a.isPlainObject(h)&&h.enabled===!0&&f.handle(h,{user:c,type:b,tags:e})}};Breinify.onReady(function(){g.checkDelayedActivityData()}),Breinify.plugins._add("activities",g)}}();
(()=>{if("object"==typeof Breinify&&!Breinify.plugins._isAdded("splitTests")){let a=Breinify.UTL._jquery(),r={status:"setup",testName:null,error:null,timing:{expirationAfterMs:36e5,intervalInMs:50,maxTimeInMs:15e3,durationInMs:0},storageKey:{live:null,test:null},tokens:{live:null,test:null},payload:null,cachedResult:null,init:function(t){let i=this,s=(t=a.isPlainObject(t)?t:{},this.testName=t.testName,this.tokens=a.extend(!0,{},this.tokens,a.isPlainObject(t.tokens)?t.tokens:{}),this.storageKey=a.extend(!0,{},this.storageKey,a.isPlainObject(t.storageKey)?t.storageKey:{}),this.timing=a.extend(!0,{},this.timing,a.isPlainObject(t.timing)?t.timing:{}),this.payload=a.isPlainObject(t.payload)||a.isFunction(t.payload)?t.payload:null,function(t,e){null!==t?(i.status="error",i.error=t):!0===e?(i.status="done",i.error=null):i.timing.durationInMs>=i.timing.maxTimeInMs?(i.status="timed-out",i.error=new Error("call timed out after "+i.timing.maxTimeInMs+"ms"),i.setSplitTestData({},null)):(i.status="loading",i.error=null,setTimeout(function(){i.timing.durationInMs+=i.timing.intervalInMs,i.resolveSplitTest(s)},i.timing.intervalInMs))});i.status="loading",this.resolveSplitTest(s)},resolveSplitTest:function(i){let s=this,n;var t;n=a.isFunction(this.payload)?this.payload(this.checkForUserInfo()):a.isPlainObject(this.payload)?this.payload:this.checkForUserInfo(),a.isPlainObject(n)?(t=this.getSplitTestData(),a.isPlainObject(t)&&"number"==typeof t.lastUpdated&&(new Date).getTime()-t.lastUpdated<=this.timing.expirationAfterMs?i(null,!0):(t=Breinify.UTL.internal.isDevMode()?this.tokens.test:this.tokens.live,Breinify.UTL.internal.token(t,n,function(t,e){null==t?(s.setSplitTestData(n,e),i(null,!0)):i(t,!1)},3e4))):i(null,!1)},determineSplitTestData:function(t){let e=this;var i;a.isFunction(t)&&("setup"===this.status||"loading"===this.status?setTimeout(function(){e.determineSplitTestData(t)},50):"error"===this.status||null!==this.error?(i=a.extend({status:this.status},this.getSplitTestData()),t(this.error,i)):(i=a.extend({status:this.status},this.getSplitTestData()),t(null,i)))},getSplitTestData:function(){if(null!==this.cachedResult)return this.cachedResult;var t=this.determineStorageKey();if(null===t)return null;try{var e=window.localStorage.getItem(t);return"string"==typeof e?JSON.parse(e):null}catch(t){return null}},setSplitTestData:function(t,e){var i=this.determineStorageKey();if(null===e&&(e={}),this.cachedResult=a.extend(!0,{},{lastUpdated:(new Date).getTime()},e),null!==i)try{window.localStorage.setItem(i,JSON.stringify(this.cachedResult))}catch(t){}let s=null;if(a.isPlainObject(this.cachedResult.splitTestData))s=this.cachedResult.splitTestData;else{if("string"!=typeof this.cachedResult.group)return;s={groupDecision:this.cachedResult.group,testName:this.testName}}Breinify.UTL.user.replaceSplitTestData(this.testName,s)},determineStorageKey:function(){return Breinify.UTL.internal.isDevMode()?this.storageKey.test:this.storageKey.live},checkForUserInfo:function(){var t=Breinify.UTL.user.create();return a.isPlainObject(t)?t:null}},o={initSplitTest:function(t,e,i,s,n){var l;return"string"==typeof e&&""!==e.trim()&&(e={live:e,test:e}),"string"==typeof s&&""!==s.trim()&&(s={live:s,test:s}),!a.isPlainObject(e)||("string"!=typeof e.test&&(e.test=e.live),a.isPlainObject(s)&&"string"!=typeof s.test&&(s.test=s.live),"string"!=typeof e.live)?null:((l=Object.create(r)).init({testName:"string"==typeof t&&""!==t.trim()?t.trim():null,payload:i,timing:n,storageKey:a.extend(!0,{live:null,test:null},a.isPlainObject(s)?s:{}),tokens:a.extend(!0,{live:null,test:null},a.isPlainObject(e)?e:{})}),l)}};Breinify.plugins._add("splitTests",{splitTests:{},retrieveSplitTest(t,e,i,s,n,l){let a=this.splitTests[t];null==a&&(a=o.initSplitTest(t,e,i,s,l),this.splitTests[t]=a),null===a?n(new Error("unable to initialize or find split-test: "+t)):a.determineSplitTestData(n)}})}})();